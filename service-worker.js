const Ei=""+new URL("automerge.wasm",import.meta.url).href;let Rt;const Ai=new Uint8Array(16);function Ci(){if(!Rt&&(Rt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Rt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Rt(Ai)}const Ii=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Qt(n){return typeof n=="string"&&Ii.test(n)}const re=[];for(let n=0;n<256;++n)re.push((n+256).toString(16).slice(1));function ts(n,e=0){return re[n[e+0]]+re[n[e+1]]+re[n[e+2]]+re[n[e+3]]+"-"+re[n[e+4]]+re[n[e+5]]+"-"+re[n[e+6]]+re[n[e+7]]+"-"+re[n[e+8]]+re[n[e+9]]+"-"+re[n[e+10]]+re[n[e+11]]+re[n[e+12]]+re[n[e+13]]+re[n[e+14]]+re[n[e+15]]}function Ri(n,e=0){const t=ts(n,e);if(!Qt(t))throw TypeError("Stringified UUID is invalid");return t}function Oi(n){if(!Qt(n))throw TypeError("Invalid UUID");let e;const t=new Uint8Array(16);return t[0]=(e=parseInt(n.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(n.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(n.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(n.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(n.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}const Ti=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Sr={randomUUID:Ti};function ns(n,e,t){if(Sr.randomUUID&&!e&&!n)return Sr.randomUUID();n=n||{};const r=n.random||(n.rng||Ci)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let s=0;s<16;++s)e[t+s]=r[s];return e}return ts(r)}const Te=Symbol.for("_am_meta"),tt=Symbol.for("_am_trace"),nt=Symbol.for("_am_objectId"),en=Symbol.for("_am_isProxy"),Nn=Symbol.for("_am_clearCache"),rs=Symbol.for("_am_uint"),ss=Symbol.for("_am_int"),is=Symbol.for("_am_f64"),os=Symbol.for("_am_counter"),ji=Symbol.for("_am_text");class je{constructor(e){if(typeof e=="string")this.elems=[...e];else if(Array.isArray(e))this.elems=e;else if(e===void 0)this.elems=[];else throw new TypeError(`Unsupported initial value for Text: ${e}`);Reflect.defineProperty(this,ji,{value:!0})}get length(){return this.elems.length}get(e){return this.elems[e]}[Symbol.iterator](){const e=this.elems;let t=-1;return{next(){return t+=1,t<e.length?{done:!1,value:e[t]}:{done:!0}}}}toString(){if(!this.str){this.str="";for(const e of this.elems)typeof e=="string"?this.str+=e:this.str+="￼"}return this.str}toSpans(){if(!this.spans){this.spans=[];let e="";for(const t of this.elems)typeof t=="string"?e+=t:(e.length>0&&(this.spans.push(e),e=""),this.spans.push(t));e.length>0&&this.spans.push(e)}return this.spans}toJSON(){return this.toString()}set(e,t){if(this[Te])throw new RangeError("object cannot be modified outside of a change block");this.elems[e]=t}insertAt(e,...t){if(this[Te])throw new RangeError("object cannot be modified outside of a change block");t.every(r=>typeof r=="string")?this.elems.splice(e,0,...t.join("")):this.elems.splice(e,0,...t)}deleteAt(e,t=1){if(this[Te])throw new RangeError("object cannot be modified outside of a change block");this.elems.splice(e,t)}map(e){this.elems.map(e)}lastIndexOf(e,t){this.elems.lastIndexOf(e,t)}concat(e){return new je(this.elems.concat(e.elems))}every(e){return this.elems.every(e)}filter(e){return new je(this.elems.filter(e))}find(e){return this.elems.find(e)}findIndex(e){return this.elems.findIndex(e)}forEach(e){this.elems.forEach(e)}includes(e){return this.elems.includes(e)}indexOf(e){return this.elems.indexOf(e)}join(e){return this.elems.join(e)}reduce(e){this.elems.reduce(e)}reduceRight(e){this.elems.reduceRight(e)}slice(e,t){return new je(this.elems.slice(e,t))}some(e){return this.elems.some(e)}toLocaleString(){this.toString()}}class yt{constructor(e){this.value=e||0,Reflect.defineProperty(this,os,{value:!0})}valueOf(){return this.value}toString(){return this.valueOf().toString()}toJSON(){return this.value}increment(e){throw new Error("Counters should not be incremented outside of a change callback")}decrement(e){throw new Error("Counters should not be decremented outside of a change callback")}}class Mi extends yt{constructor(e,t,r,s,i){super(e),this.context=t,this.path=r,this.objectId=s,this.key=i}increment(e){return e=typeof e=="number"?e:1,this.context.increment(this.objectId,this.key,e),this.value+=e,this.value}decrement(e){return this.increment(typeof e=="number"?-e:-1)}}function Di(n,e,t,r,s){return new Mi(n,e,t,r,s)}class Nt{constructor(e){this.val=e}toString(){return this.val}toJSON(){return this.val}}function ke(n){if(typeof n=="string"&&/^[0-9]+$/.test(n)&&(n=parseInt(n,10)),typeof n!="number")return n;if(n<0||isNaN(n)||n===1/0||n===-1/0)throw new RangeError("A list index must be positive, but you passed "+n);return n}function pe(n,e){const{context:t,objectId:r,path:s,textV2:i}=n,o=t.getWithType(r,e);if(o===null)return;const a=o[0],c=o[1];switch(a){case void 0:return;case"map":return at(t,c,i,[...s,e]);case"list":return Et(t,c,i,[...s,e]);case"text":return i?t.text(c):bt(t,c,[...s,e]);case"str":return c;case"uint":return c;case"int":return c;case"f64":return c;case"boolean":return c;case"null":return null;case"bytes":return c;case"timestamp":return c;case"counter":return Di(c,t,s,r,e);default:throw RangeError(`datatype ${a} unimplemented`)}}function Vt(n,e,t,r){const s=typeof n;switch(s){case"object":if(n==null)return[null,"null"];if(n[rs])return[n.value,"uint"];if(n[ss])return[n.value,"int"];if(n[is])return[n.value,"f64"];if(n[os])return[n.value,"counter"];if(n instanceof Date)return[n.getTime(),"timestamp"];if(n instanceof Nt)return[n.toString(),"str"];if(n instanceof je)return[n,"text"];if(n instanceof Uint8Array)return[n,"bytes"];if(n instanceof Array)return[n,"list"];if(Object.prototype.toString.call(n)==="[object Object]")return[n,"map"];throw tn(n,r)?new RangeError("Cannot create a reference to an existing document object"):new RangeError(`Cannot assign unknown object: ${n}`);case"boolean":return[n,"boolean"];case"number":return Number.isInteger(n)?[n,"int"]:[n,"f64"];case"string":return e?[n,"text"]:[n,"str"];case"undefined":throw new RangeError([`Cannot assign undefined value at ${kr(t)}, `,"because `undefined` is not a valid JSON data type. ","You might consider setting the property's value to `null`, ","or using `delete` to remove it altogether."].join(""));default:throw new RangeError([`Cannot assign ${s} value at ${kr(t)}. `,"All JSON primitive datatypes (object, array, string, number, boolean, null) ",`are supported in an Automerge document; ${s} values are not. `].join(""))}}function tn(n,e){var t,r;return n instanceof Date?!1:!!(n&&((r=(t=n[Te])===null||t===void 0?void 0:t.handle)===null||r===void 0?void 0:r.__wbg_ptr)===e.__wbg_ptr)}const Ui={get(n,e){const{context:t,objectId:r,cache:s}=n;return e===Symbol.toStringTag?n[Symbol.toStringTag]:e===nt?r:e===en?!0:e===tt?n.trace:e===Te?{handle:t,textV2:n.textV2}:(s[e]||(s[e]=pe(n,e)),s[e])},set(n,e,t){const{context:r,objectId:s,path:i,textV2:o}=n;if(n.cache={},tn(t,r))throw new RangeError("Cannot create a reference to an existing document object");if(e===tt)return n.trace=t,!0;if(e===Nn)return!0;const[a,c]=Vt(t,o,[...i,e],r);switch(c){case"list":{const u=r.putObject(s,e,[]),l=Et(r,u,o,[...i,e]);for(let f=0;f<a.length;f++)l[f]=a[f];break}case"text":{if(o)Wt(a),r.putObject(s,e,a);else{Wn(a);const u=r.putObject(s,e,"");bt(r,u,[...i,e]).splice(0,0,...a)}break}case"map":{const u=r.putObject(s,e,{}),l=at(r,u,o,[...i,e]);for(const f in a)l[f]=a[f];break}default:r.put(s,e,a,c)}return!0},deleteProperty(n,e){const{context:t,objectId:r}=n;return n.cache={},t.delete(r,e),!0},has(n,e){return this.get(n,e)!==void 0},getOwnPropertyDescriptor(n,e){const t=this.get(n,e);if(typeof t<"u")return{configurable:!0,enumerable:!0,value:t}},ownKeys(n){const{context:e,objectId:t}=n,r=e.keys(t);return[...new Set(r)]}},as={get(n,e){const{context:t,objectId:r}=n;return e=ke(e),e===Symbol.hasInstance?s=>Array.isArray(s):e===Symbol.toStringTag?n[Symbol.toStringTag]:e===nt?r:e===en?!0:e===tt?n.trace:e===Te?{handle:t}:e==="length"?t.length(r):typeof e=="number"?pe(n,e):Vn(n)[e]},set(n,e,t){const{context:r,objectId:s,path:i,textV2:o}=n;if(e=ke(e),tn(t,r))throw new RangeError("Cannot create a reference to an existing document object");if(e===Nn)return!0;if(e===tt)return n.trace=t,!0;if(typeof e=="string")throw new RangeError("list index must be a number");const[a,c]=Vt(t,o,[...i,e],r);switch(c){case"list":{let u;e>=r.length(s)?u=r.insertObject(s,e,[]):u=r.putObject(s,e,[]),Et(r,u,o,[...i,e]).splice(0,0,...a);break}case"text":{if(o)Wt(a),e>=r.length(s)?r.insertObject(s,e,a):r.putObject(s,e,a);else{let u;Wn(a),e>=r.length(s)?u=r.insertObject(s,e,""):u=r.putObject(s,e,""),bt(r,u,[...i,e]).splice(0,0,...a)}break}case"map":{let u;e>=r.length(s)?u=r.insertObject(s,e,{}):u=r.putObject(s,e,{});const l=at(r,u,o,[...i,e]);for(const f in a)l[f]=a[f];break}default:e>=r.length(s)?r.insert(s,e,a,c):r.put(s,e,a,c)}return!0},deleteProperty(n,e){const{context:t,objectId:r}=n;e=ke(e);const s=t.get(r,e);if(s!=null&&s[0]=="counter")throw new TypeError("Unsupported operation: deleting a counter from a list");return t.delete(r,e),!0},has(n,e){const{context:t,objectId:r}=n;return e=ke(e),typeof e=="number"?e<t.length(r):e==="length"},getOwnPropertyDescriptor(n,e){const{context:t,objectId:r}=n;return e==="length"?{writable:!0,value:t.length(r)}:e===nt?{configurable:!1,enumerable:!1,value:r}:(e=ke(e),{configurable:!0,enumerable:!0,value:pe(n,e)})},getPrototypeOf(n){return Object.getPrototypeOf(n)},ownKeys(){const n=[];return n.push("length"),n}},Pi=Object.assign({},as,{get(n,e){const{context:t,objectId:r}=n;return e=ke(e),e===Symbol.hasInstance?s=>Array.isArray(s):e===Symbol.toStringTag?n[Symbol.toStringTag]:e===nt?r:e===en?!0:e===tt?n.trace:e===Te?{handle:t}:e==="length"?t.length(r):typeof e=="number"?pe(n,e):Li(n)[e]||Vn(n)[e]},getPrototypeOf(){return Object.getPrototypeOf(new je)}});function at(n,e,t,r){const s={context:n,objectId:e,path:r||[],cache:{},textV2:t},i={};return Object.assign(i,s),new Proxy(i,Ui)}function Et(n,e,t,r){const s={context:n,objectId:e,path:r||[],cache:{},textV2:t},i=[];return Object.assign(i,s),new Proxy(i,as)}function bt(n,e,t){const r={context:n,objectId:e,path:t||[],cache:{},textV2:!1},s={};return Object.assign(s,r),new Proxy(s,Pi)}function $i(n,e){return at(n,"_root",e,[])}function Vn(n){const{context:e,objectId:t,path:r,textV2:s}=n;return{deleteAt(o,a){return typeof a=="number"?e.splice(t,o,a):e.delete(t,o),this},fill(o,a,c){const[u,l]=Vt(o,s,[...r,a],e),f=e.length(t);a=ke(a||0),c=ke(c||f);for(let g=a;g<Math.min(c,f);g++)if(l==="list"||l==="map")e.putObject(t,g,u);else if(l==="text")if(s)Wt(u),e.putObject(t,g,u);else{Wn(u);const h=e.putObject(t,g,""),y=bt(e,h,[...r,g]);for(let v=0;v<u.length;v++)y[v]=u.get(v)}else e.put(t,g,u,l);return this},indexOf(o,a=0){const c=e.length(t);for(let u=a;u<c;u++){const l=e.getWithType(t,u);if(l&&(l[1]===o[nt]||l[1]===o))return u}return-1},insertAt(o,...a){return this.splice(o,0,...a),this},pop(){const o=e.length(t);if(o==0)return;const a=pe(n,o-1);return e.delete(t,o-1),a},push(...o){const a=e.length(t);return this.splice(a,0,...o),e.length(t)},shift(){if(e.length(t)==0)return;const o=pe(n,0);return e.delete(t,0),o},splice(o,a,...c){o=ke(o),typeof a!="number"&&(a=e.length(t)-o),a=ke(a);for(const f of c)if(tn(f,e))throw new RangeError("Cannot create a reference to an existing document object");const u=[];for(let f=0;f<a;f++){const g=pe(n,o);g!==void 0&&u.push(g),e.delete(t,o)}const l=c.map((f,g)=>{try{return Vt(f,s,[...r],e)}catch(h){throw h instanceof RangeError?new RangeError(`${h.message} (at index ${g} in the input)`):h}});for(const[f,g]of l){switch(g){case"list":{const h=e.insertObject(t,o,[]);Et(e,h,s,[...r,o]).splice(0,0,...f);break}case"text":{if(s)Wt(f),e.insertObject(t,o,f);else{const h=e.insertObject(t,o,"");bt(e,h,[...r,o]).splice(0,0,...f)}break}case"map":{const h=e.insertObject(t,o,{}),y=at(e,h,s,[...r,o]);for(const v in f)y[v]=f[v];break}default:e.insert(t,o,f,g)}o+=1}return u},unshift(...o){return this.splice(0,0,...o),e.length(t)},entries(){let o=0;return{next:()=>{const c=pe(n,o);return c===void 0?{value:void 0,done:!0}:{value:[o++,c],done:!1}},[Symbol.iterator](){return this}}},keys(){let o=0;const a=e.length(t);return{next:()=>o<a?{value:o++,done:!1}:{value:void 0,done:!0},[Symbol.iterator](){return this}}},values(){let o=0;return{next:()=>{const c=pe(n,o++);return c===void 0?{value:void 0,done:!0}:{value:c,done:!1}},[Symbol.iterator](){return this}}},toArray(){const o=[];let a;do a=pe(n,o.length),a!==void 0&&o.push(a);while(a!==void 0);return o},map(o){return this.toArray().map(o)},toString(){return this.toArray().toString()},toLocaleString(){return this.toArray().toLocaleString()},forEach(o){return this.toArray().forEach(o)},concat(o){return this.toArray().concat(o)},every(o){return this.toArray().every(o)},filter(o){return this.toArray().filter(o)},find(o){let a=0;for(const c of this){if(o(c,a))return c;a+=1}},findIndex(o){let a=0;for(const c of this){if(o(c,a))return a;a+=1}return-1},includes(o){return this.find(a=>a===o)!==void 0},join(o){return this.toArray().join(o)},reduce(o,a){return this.toArray().reduce(o,a)},reduceRight(o,a){return this.toArray().reduceRight(o,a)},lastIndexOf(o,a=1/0){return this.toArray().lastIndexOf(o,a)},slice(o,a){return this.toArray().slice(o,a)},some(o){let a=0;for(const c of this){if(o(c,a))return!0;a+=1}return!1},[Symbol.iterator]:function*(){let o=0,a=pe(n,o);for(;a!==void 0;)yield a,o+=1,a=pe(n,o)}}}function Li(n){const{context:e,objectId:t}=n;return{set(s,i){return this[s]=i},get(s){return this[s]},toString(){return e.text(t).replace(/￼/g,"")},toSpans(){const s=[];let i="";const o=e.length(t);for(let a=0;a<o;a++){const c=this[a];typeof c=="string"?i+=c:(i.length>0&&(s.push(i),i=""),s.push(c))}return i.length>0&&s.push(i),s},toJSON(){return this.toString()},indexOf(s,i=0){return e.text(t).indexOf(s,i)},insertAt(s,...i){i.every(o=>typeof o=="string")?e.splice(t,s,0,i.join("")):Vn(n).insertAt(s,...i)}}}function Wn(n){if(!(n instanceof je))throw new Error("value was not a Text instance")}function Wt(n){if(typeof n!="string")throw new Error("value was not a string")}function kr(n){const e=n.map(t=>{if(typeof t=="number")return t.toString();if(typeof t=="string")return t.replace(/~/g,"~0").replace(/\//g,"~1")});return n.length===0?"":"/"+e.join("/")}class Bi{constructor(e){if(!(Number.isInteger(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER))throw new RangeError(`Value ${e} cannot be a uint`);this.value=e,Reflect.defineProperty(this,ss,{value:!0}),Object.freeze(this)}}class Fi{constructor(e){if(!(Number.isInteger(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=0))throw new RangeError(`Value ${e} cannot be a uint`);this.value=e,Reflect.defineProperty(this,rs,{value:!0}),Object.freeze(this)}}class zi{constructor(e){if(typeof e!="number")throw new RangeError(`Value ${e} cannot be a float64`);this.value=e||0,Reflect.defineProperty(this,is,{value:!0}),Object.freeze(this)}}let d;const Re=new Array(128).fill(void 0);Re.push(void 0,null,!0,!1);function R(n){return Re[n]}let pt=Re.length;function Hi(n){n<132||(Re[n]=pt,pt=n)}function k(n){const e=R(n);return Hi(n),e}let be=0,dt=null;function Dt(){return(dt===null||dt.byteLength===0)&&(dt=new Uint8Array(d.memory.buffer)),dt}const Ut=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Ni=typeof Ut.encodeInto=="function"?function(n,e){return Ut.encodeInto(n,e)}:function(n,e){const t=Ut.encode(n);return e.set(t),{read:n.length,written:t.length}};function Ee(n,e,t){if(t===void 0){const a=Ut.encode(n),c=e(a.length,1)>>>0;return Dt().subarray(c,c+a.length).set(a),be=a.length,c}let r=n.length,s=e(r,1)>>>0;const i=Dt();let o=0;for(;o<r;o++){const a=n.charCodeAt(o);if(a>127)break;i[s+o]=a}if(o!==r){o!==0&&(n=n.slice(o)),s=t(s,r,r=o+n.length*3,1)>>>0;const a=Dt().subarray(s+o,s+r),c=Ni(n,a);o+=c.written,s=t(s,r,o,1)>>>0}return be=o,s}function G(n){return n==null}let ht=null;function p(){return(ht===null||ht.byteLength===0)&&(ht=new Int32Array(d.memory.buffer)),ht}const cs=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&cs.decode();function he(n,e){return n=n>>>0,cs.decode(Dt().subarray(n,n+e))}function w(n){pt===Re.length&&Re.push(Re.length+1);const e=pt;return pt=Re[e],Re[e]=n,e}let gt=null;function Pt(){return(gt===null||gt.byteLength===0)&&(gt=new Float64Array(d.memory.buffer)),gt}function Sn(n){const e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){const s=n.description;return s==null?"Symbol":`Symbol(${s})`}if(e=="function"){const s=n.name;return typeof s=="string"&&s.length>0?`Function(${s})`:"Function"}if(Array.isArray(n)){const s=n.length;let i="[";s>0&&(i+=Sn(n[0]));for(let o=1;o<s;o++)i+=", "+Sn(n[o]);return i+="]",i}const t=/\[object ([^\]]+)\]/.exec(toString.call(n));let r;if(t.length>1)r=t[1];else return toString.call(n);if(r=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:r}function ze(n,e){if(!(n instanceof e))throw new Error(`expected instance of ${e.name}`);return n.ptr}function Vi(n){try{const s=d.__wbindgen_add_to_stack_pointer(-16);d.create(s,w(n));var e=p()[s/4+0],t=p()[s/4+1],r=p()[s/4+2];if(r)throw k(t);return Jn.__wrap(e)}finally{d.__wbindgen_add_to_stack_pointer(16)}}function Wi(n,e){try{const i=d.__wbindgen_add_to_stack_pointer(-16);d.load(i,w(n),w(e));var t=p()[i/4+0],r=p()[i/4+1],s=p()[i/4+2];if(s)throw k(r);return Jn.__wrap(t)}finally{d.__wbindgen_add_to_stack_pointer(16)}}function Ji(n){try{const s=d.__wbindgen_add_to_stack_pointer(-16);d.encodeChange(s,w(n));var e=p()[s/4+0],t=p()[s/4+1],r=p()[s/4+2];if(r)throw k(t);return k(e)}finally{d.__wbindgen_add_to_stack_pointer(16)}}function Ki(n){try{const s=d.__wbindgen_add_to_stack_pointer(-16);d.decodeChange(s,w(n));var e=p()[s/4+0],t=p()[s/4+1],r=p()[s/4+2];if(r)throw k(t);return k(e)}finally{d.__wbindgen_add_to_stack_pointer(16)}}function qi(){const n=d.initSyncState();return we.__wrap(n)}function Gi(n){try{const s=d.__wbindgen_add_to_stack_pointer(-16);d.importSyncState(s,w(n));var e=p()[s/4+0],t=p()[s/4+1],r=p()[s/4+2];if(r)throw k(t);return we.__wrap(e)}finally{d.__wbindgen_add_to_stack_pointer(16)}}function Yi(n){ze(n,we);const e=d.exportSyncState(n.__wbg_ptr);return k(e)}function Xi(n){try{const s=d.__wbindgen_add_to_stack_pointer(-16);d.encodeSyncMessage(s,w(n));var e=p()[s/4+0],t=p()[s/4+1],r=p()[s/4+2];if(r)throw k(t);return k(e)}finally{d.__wbindgen_add_to_stack_pointer(16)}}function Zi(n){try{const s=d.__wbindgen_add_to_stack_pointer(-16);d.decodeSyncMessage(s,w(n));var e=p()[s/4+0],t=p()[s/4+1],r=p()[s/4+2];if(r)throw k(t);return k(e)}finally{d.__wbindgen_add_to_stack_pointer(16)}}function Qi(n){ze(n,we);const e=d.encodeSyncState(n.__wbg_ptr);return k(e)}function eo(n){try{const s=d.__wbindgen_add_to_stack_pointer(-16);d.decodeSyncState(s,w(n));var e=p()[s/4+0],t=p()[s/4+1],r=p()[s/4+2];if(r)throw k(t);return we.__wrap(e)}finally{d.__wbindgen_add_to_stack_pointer(16)}}function ie(n,e){try{return n.apply(this,e)}catch(t){d.__wbindgen_exn_store(w(t))}}const to=Object.freeze({Array:0,0:"Array",String:1,1:"String"}),Er=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>d.__wbg_automerge_free(n>>>0));let Jn=class Be{static __wrap(e){e=e>>>0;const t=Object.create(Be.prototype);return t.__wbg_ptr=e,Er.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Er.unregister(this),e}free(){const e=this.__destroy_into_raw();d.__wbg_automerge_free(e)}static new(e,t){try{const c=d.__wbindgen_add_to_stack_pointer(-16);var r=G(e)?0:Ee(e,d.__wbindgen_malloc,d.__wbindgen_realloc),s=be;d.automerge_new(c,r,s,t);var i=p()[c/4+0],o=p()[c/4+1],a=p()[c/4+2];if(a)throw k(o);return Be.__wrap(i)}finally{d.__wbindgen_add_to_stack_pointer(16)}}clone(e){try{const a=d.__wbindgen_add_to_stack_pointer(-16);var t=G(e)?0:Ee(e,d.__wbindgen_malloc,d.__wbindgen_realloc),r=be;d.automerge_clone(a,this.__wbg_ptr,t,r);var s=p()[a/4+0],i=p()[a/4+1],o=p()[a/4+2];if(o)throw k(i);return Be.__wrap(s)}finally{d.__wbindgen_add_to_stack_pointer(16)}}fork(e,t){try{const c=d.__wbindgen_add_to_stack_pointer(-16);var r=G(e)?0:Ee(e,d.__wbindgen_malloc,d.__wbindgen_realloc),s=be;d.automerge_fork(c,this.__wbg_ptr,r,s,w(t));var i=p()[c/4+0],o=p()[c/4+1],a=p()[c/4+2];if(a)throw k(o);return Be.__wrap(i)}finally{d.__wbindgen_add_to_stack_pointer(16)}}pendingOps(){const e=d.automerge_pendingOps(this.__wbg_ptr);return k(e)}commit(e,t){var r=G(e)?0:Ee(e,d.__wbindgen_malloc,d.__wbindgen_realloc),s=be;const i=d.automerge_commit(this.__wbg_ptr,r,s,!G(t),G(t)?0:t);return k(i)}merge(e){try{const i=d.__wbindgen_add_to_stack_pointer(-16);ze(e,Be),d.automerge_merge(i,this.__wbg_ptr,e.__wbg_ptr);var t=p()[i/4+0],r=p()[i/4+1],s=p()[i/4+2];if(s)throw k(r);return k(t)}finally{d.__wbindgen_add_to_stack_pointer(16)}}rollback(){return d.automerge_rollback(this.__wbg_ptr)}keys(e,t){try{const o=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_keys(o,this.__wbg_ptr,w(e),G(t)?0:w(t));var r=p()[o/4+0],s=p()[o/4+1],i=p()[o/4+2];if(i)throw k(s);return k(r)}finally{d.__wbindgen_add_to_stack_pointer(16)}}text(e,t){let r,s;try{const f=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_text(f,this.__wbg_ptr,w(e),G(t)?0:w(t));var i=p()[f/4+0],o=p()[f/4+1],a=p()[f/4+2],c=p()[f/4+3],u=i,l=o;if(c)throw u=0,l=0,k(a);return r=u,s=l,he(u,l)}finally{d.__wbindgen_add_to_stack_pointer(16),d.__wbindgen_free(r,s,1)}}spans(e,t){try{const o=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_spans(o,this.__wbg_ptr,w(e),G(t)?0:w(t));var r=p()[o/4+0],s=p()[o/4+1],i=p()[o/4+2];if(i)throw k(s);return k(r)}finally{d.__wbindgen_add_to_stack_pointer(16)}}splice(e,t,r,s){try{const a=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_splice(a,this.__wbg_ptr,w(e),t,r,w(s));var i=p()[a/4+0],o=p()[a/4+1];if(o)throw k(i)}finally{d.__wbindgen_add_to_stack_pointer(16)}}updateText(e,t){try{const i=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_updateText(i,this.__wbg_ptr,w(e),w(t));var r=p()[i/4+0],s=p()[i/4+1];if(s)throw k(r)}finally{d.__wbindgen_add_to_stack_pointer(16)}}updateSpans(e,t){try{const i=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_updateSpans(i,this.__wbg_ptr,w(e),w(t));var r=p()[i/4+0],s=p()[i/4+1];if(s)throw k(r)}finally{d.__wbindgen_add_to_stack_pointer(16)}}push(e,t,r){try{const o=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_push(o,this.__wbg_ptr,w(e),w(t),w(r));var s=p()[o/4+0],i=p()[o/4+1];if(i)throw k(s)}finally{d.__wbindgen_add_to_stack_pointer(16)}}pushObject(e,t){try{const a=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_pushObject(a,this.__wbg_ptr,w(e),w(t));var r=p()[a/4+0],s=p()[a/4+1],i=p()[a/4+2],o=p()[a/4+3];if(o)throw k(i);let c;return r!==0&&(c=he(r,s).slice(),d.__wbindgen_free(r,s*1,1)),c}finally{d.__wbindgen_add_to_stack_pointer(16)}}insert(e,t,r,s){try{const a=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_insert(a,this.__wbg_ptr,w(e),t,w(r),w(s));var i=p()[a/4+0],o=p()[a/4+1];if(o)throw k(i)}finally{d.__wbindgen_add_to_stack_pointer(16)}}splitBlock(e,t,r){try{const o=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_splitBlock(o,this.__wbg_ptr,w(e),t,w(r));var s=p()[o/4+0],i=p()[o/4+1];if(i)throw k(s)}finally{d.__wbindgen_add_to_stack_pointer(16)}}joinBlock(e,t){try{const i=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_joinBlock(i,this.__wbg_ptr,w(e),t);var r=p()[i/4+0],s=p()[i/4+1];if(s)throw k(r)}finally{d.__wbindgen_add_to_stack_pointer(16)}}updateBlock(e,t,r){try{const o=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_updateBlock(o,this.__wbg_ptr,w(e),t,w(r));var s=p()[o/4+0],i=p()[o/4+1];if(i)throw k(s)}finally{d.__wbindgen_add_to_stack_pointer(16)}}getBlock(e,t,r){try{const a=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_getBlock(a,this.__wbg_ptr,w(e),t,G(r)?0:w(r));var s=p()[a/4+0],i=p()[a/4+1],o=p()[a/4+2];if(o)throw k(i);return k(s)}finally{d.__wbindgen_add_to_stack_pointer(16)}}insertObject(e,t,r){try{const c=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_insertObject(c,this.__wbg_ptr,w(e),t,w(r));var s=p()[c/4+0],i=p()[c/4+1],o=p()[c/4+2],a=p()[c/4+3];if(a)throw k(o);let u;return s!==0&&(u=he(s,i).slice(),d.__wbindgen_free(s,i*1,1)),u}finally{d.__wbindgen_add_to_stack_pointer(16)}}put(e,t,r,s){try{const a=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_put(a,this.__wbg_ptr,w(e),w(t),w(r),w(s));var i=p()[a/4+0],o=p()[a/4+1];if(o)throw k(i)}finally{d.__wbindgen_add_to_stack_pointer(16)}}putObject(e,t,r){try{const a=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_putObject(a,this.__wbg_ptr,w(e),w(t),w(r));var s=p()[a/4+0],i=p()[a/4+1],o=p()[a/4+2];if(o)throw k(i);return k(s)}finally{d.__wbindgen_add_to_stack_pointer(16)}}increment(e,t,r){try{const o=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_increment(o,this.__wbg_ptr,w(e),w(t),w(r));var s=p()[o/4+0],i=p()[o/4+1];if(i)throw k(s)}finally{d.__wbindgen_add_to_stack_pointer(16)}}get(e,t,r){try{const a=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_get(a,this.__wbg_ptr,w(e),w(t),G(r)?0:w(r));var s=p()[a/4+0],i=p()[a/4+1],o=p()[a/4+2];if(o)throw k(i);return k(s)}finally{d.__wbindgen_add_to_stack_pointer(16)}}getWithType(e,t,r){try{const a=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_getWithType(a,this.__wbg_ptr,w(e),w(t),G(r)?0:w(r));var s=p()[a/4+0],i=p()[a/4+1],o=p()[a/4+2];if(o)throw k(i);return k(s)}finally{d.__wbindgen_add_to_stack_pointer(16)}}objInfo(e,t){try{const o=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_objInfo(o,this.__wbg_ptr,w(e),G(t)?0:w(t));var r=p()[o/4+0],s=p()[o/4+1],i=p()[o/4+2];if(i)throw k(s);return k(r)}finally{d.__wbindgen_add_to_stack_pointer(16)}}getAll(e,t,r){try{const a=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_getAll(a,this.__wbg_ptr,w(e),w(t),G(r)?0:w(r));var s=p()[a/4+0],i=p()[a/4+1],o=p()[a/4+2];if(o)throw k(i);return k(s)}finally{d.__wbindgen_add_to_stack_pointer(16)}}enableFreeze(e){try{const i=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_enableFreeze(i,this.__wbg_ptr,w(e));var t=p()[i/4+0],r=p()[i/4+1],s=p()[i/4+2];if(s)throw k(r);return k(t)}finally{d.__wbindgen_add_to_stack_pointer(16)}}registerDatatype(e,t,r){try{const o=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_registerDatatype(o,this.__wbg_ptr,w(e),w(t),w(r));var s=p()[o/4+0],i=p()[o/4+1];if(i)throw k(s)}finally{d.__wbindgen_add_to_stack_pointer(16)}}applyPatches(e,t){try{const o=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_applyPatches(o,this.__wbg_ptr,w(e),w(t));var r=p()[o/4+0],s=p()[o/4+1],i=p()[o/4+2];if(i)throw k(s);return k(r)}finally{d.__wbindgen_add_to_stack_pointer(16)}}applyAndReturnPatches(e,t){try{const o=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_applyAndReturnPatches(o,this.__wbg_ptr,w(e),w(t));var r=p()[o/4+0],s=p()[o/4+1],i=p()[o/4+2];if(i)throw k(s);return k(r)}finally{d.__wbindgen_add_to_stack_pointer(16)}}diffIncremental(){try{const s=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_diffIncremental(s,this.__wbg_ptr);var e=p()[s/4+0],t=p()[s/4+1],r=p()[s/4+2];if(r)throw k(t);return k(e)}finally{d.__wbindgen_add_to_stack_pointer(16)}}updateDiffCursor(){d.automerge_updateDiffCursor(this.__wbg_ptr)}resetDiffCursor(){d.automerge_resetDiffCursor(this.__wbg_ptr)}diff(e,t){try{const o=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_diff(o,this.__wbg_ptr,w(e),w(t));var r=p()[o/4+0],s=p()[o/4+1],i=p()[o/4+2];if(i)throw k(s);return k(r)}finally{d.__wbindgen_add_to_stack_pointer(16)}}isolate(e){try{const s=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_isolate(s,this.__wbg_ptr,w(e));var t=p()[s/4+0],r=p()[s/4+1];if(r)throw k(t)}finally{d.__wbindgen_add_to_stack_pointer(16)}}integrate(){d.automerge_integrate(this.__wbg_ptr)}length(e,t){try{const o=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_length(o,this.__wbg_ptr,w(e),G(t)?0:w(t));var r=Pt()[o/8+0],s=p()[o/4+2],i=p()[o/4+3];if(i)throw k(s);return r}finally{d.__wbindgen_add_to_stack_pointer(16)}}delete(e,t){try{const i=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_delete(i,this.__wbg_ptr,w(e),w(t));var r=p()[i/4+0],s=p()[i/4+1];if(s)throw k(r)}finally{d.__wbindgen_add_to_stack_pointer(16)}}save(){const e=d.automerge_save(this.__wbg_ptr);return k(e)}saveIncremental(){const e=d.automerge_saveIncremental(this.__wbg_ptr);return k(e)}saveSince(e){try{const i=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_saveSince(i,this.__wbg_ptr,w(e));var t=p()[i/4+0],r=p()[i/4+1],s=p()[i/4+2];if(s)throw k(r);return k(t)}finally{d.__wbindgen_add_to_stack_pointer(16)}}saveNoCompress(){const e=d.automerge_saveNoCompress(this.__wbg_ptr);return k(e)}saveAndVerify(){try{const s=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_saveAndVerify(s,this.__wbg_ptr);var e=p()[s/4+0],t=p()[s/4+1],r=p()[s/4+2];if(r)throw k(t);return k(e)}finally{d.__wbindgen_add_to_stack_pointer(16)}}loadIncremental(e){try{const i=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_loadIncremental(i,this.__wbg_ptr,w(e));var t=Pt()[i/8+0],r=p()[i/4+2],s=p()[i/4+3];if(s)throw k(r);return t}finally{d.__wbindgen_add_to_stack_pointer(16)}}applyChanges(e){try{const s=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_applyChanges(s,this.__wbg_ptr,w(e));var t=p()[s/4+0],r=p()[s/4+1];if(r)throw k(t)}finally{d.__wbindgen_add_to_stack_pointer(16)}}getChanges(e){try{const i=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_getChanges(i,this.__wbg_ptr,w(e));var t=p()[i/4+0],r=p()[i/4+1],s=p()[i/4+2];if(s)throw k(r);return k(t)}finally{d.__wbindgen_add_to_stack_pointer(16)}}getChangeByHash(e){try{const i=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_getChangeByHash(i,this.__wbg_ptr,w(e));var t=p()[i/4+0],r=p()[i/4+1],s=p()[i/4+2];if(s)throw k(r);return k(t)}finally{d.__wbindgen_add_to_stack_pointer(16)}}getDecodedChangeByHash(e){try{const i=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_getDecodedChangeByHash(i,this.__wbg_ptr,w(e));var t=p()[i/4+0],r=p()[i/4+1],s=p()[i/4+2];if(s)throw k(r);return k(t)}finally{d.__wbindgen_add_to_stack_pointer(16)}}getChangesAdded(e){ze(e,Be);const t=d.automerge_getChangesAdded(this.__wbg_ptr,e.__wbg_ptr);return k(t)}getHeads(){const e=d.automerge_getHeads(this.__wbg_ptr);return k(e)}getActorId(){let e,t;try{const i=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_getActorId(i,this.__wbg_ptr);var r=p()[i/4+0],s=p()[i/4+1];return e=r,t=s,he(r,s)}finally{d.__wbindgen_add_to_stack_pointer(16),d.__wbindgen_free(e,t,1)}}getLastLocalChange(){const e=d.automerge_getLastLocalChange(this.__wbg_ptr);return k(e)}dump(){d.automerge_dump(this.__wbg_ptr)}getMissingDeps(e){try{const i=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_getMissingDeps(i,this.__wbg_ptr,G(e)?0:w(e));var t=p()[i/4+0],r=p()[i/4+1],s=p()[i/4+2];if(s)throw k(r);return k(t)}finally{d.__wbindgen_add_to_stack_pointer(16)}}receiveSyncMessage(e,t){try{const i=d.__wbindgen_add_to_stack_pointer(-16);ze(e,we),d.automerge_receiveSyncMessage(i,this.__wbg_ptr,e.__wbg_ptr,w(t));var r=p()[i/4+0],s=p()[i/4+1];if(s)throw k(r)}finally{d.__wbindgen_add_to_stack_pointer(16)}}generateSyncMessage(e){ze(e,we);const t=d.automerge_generateSyncMessage(this.__wbg_ptr,e.__wbg_ptr);return k(t)}toJS(e){try{const i=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_toJS(i,this.__wbg_ptr,w(e));var t=p()[i/4+0],r=p()[i/4+1],s=p()[i/4+2];if(s)throw k(r);return k(t)}finally{d.__wbindgen_add_to_stack_pointer(16)}}materialize(e,t,r){try{const a=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_materialize(a,this.__wbg_ptr,w(e),G(t)?0:w(t),w(r));var s=p()[a/4+0],i=p()[a/4+1],o=p()[a/4+2];if(o)throw k(i);return k(s)}finally{d.__wbindgen_add_to_stack_pointer(16)}}getCursor(e,t,r){let s,i;try{const g=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_getCursor(g,this.__wbg_ptr,w(e),t,G(r)?0:w(r));var o=p()[g/4+0],a=p()[g/4+1],c=p()[g/4+2],u=p()[g/4+3],l=o,f=a;if(u)throw l=0,f=0,k(c);return s=l,i=f,he(l,f)}finally{d.__wbindgen_add_to_stack_pointer(16),d.__wbindgen_free(s,i,1)}}getCursorPosition(e,t,r){try{const a=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_getCursorPosition(a,this.__wbg_ptr,w(e),w(t),G(r)?0:w(r));var s=Pt()[a/8+0],i=p()[a/4+2],o=p()[a/4+3];if(o)throw k(i);return s}finally{d.__wbindgen_add_to_stack_pointer(16)}}emptyChange(e,t){var r=G(e)?0:Ee(e,d.__wbindgen_malloc,d.__wbindgen_realloc),s=be;const i=d.automerge_emptyChange(this.__wbg_ptr,r,s,!G(t),G(t)?0:t);return k(i)}mark(e,t,r,s,i){try{const c=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_mark(c,this.__wbg_ptr,w(e),w(t),w(r),w(s),w(i));var o=p()[c/4+0],a=p()[c/4+1];if(a)throw k(o)}finally{d.__wbindgen_add_to_stack_pointer(16)}}unmark(e,t,r){try{const o=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_unmark(o,this.__wbg_ptr,w(e),w(t),w(r));var s=p()[o/4+0],i=p()[o/4+1];if(i)throw k(s)}finally{d.__wbindgen_add_to_stack_pointer(16)}}marks(e,t){try{const o=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_marks(o,this.__wbg_ptr,w(e),G(t)?0:w(t));var r=p()[o/4+0],s=p()[o/4+1],i=p()[o/4+2];if(i)throw k(s);return k(r)}finally{d.__wbindgen_add_to_stack_pointer(16)}}marksAt(e,t,r){try{const a=d.__wbindgen_add_to_stack_pointer(-16);d.automerge_marksAt(a,this.__wbg_ptr,w(e),t,G(r)?0:w(r));var s=p()[a/4+0],i=p()[a/4+1],o=p()[a/4+2];if(o)throw k(i);return k(s)}finally{d.__wbindgen_add_to_stack_pointer(16)}}hasOurChanges(e){ze(e,we);const t=d.automerge_hasOurChanges(this.__wbg_ptr,e.__wbg_ptr);return k(t)}topoHistoryTraversal(){const e=d.automerge_topoHistoryTraversal(this.__wbg_ptr);return k(e)}stats(){const e=d.automerge_stats(this.__wbg_ptr);return k(e)}};const Ar=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>d.__wbg_syncstate_free(n>>>0));class we{static __wrap(e){e=e>>>0;const t=Object.create(we.prototype);return t.__wbg_ptr=e,Ar.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ar.unregister(this),e}free(){const e=this.__destroy_into_raw();d.__wbg_syncstate_free(e)}get sharedHeads(){const e=d.syncstate_sharedHeads(this.__wbg_ptr);return k(e)}get lastSentHeads(){const e=d.syncstate_lastSentHeads(this.__wbg_ptr);return k(e)}set lastSentHeads(e){try{const s=d.__wbindgen_add_to_stack_pointer(-16);d.syncstate_set_lastSentHeads(s,this.__wbg_ptr,w(e));var t=p()[s/4+0],r=p()[s/4+1];if(r)throw k(t)}finally{d.__wbindgen_add_to_stack_pointer(16)}}set sentHashes(e){try{const s=d.__wbindgen_add_to_stack_pointer(-16);d.syncstate_set_sentHashes(s,this.__wbg_ptr,w(e));var t=p()[s/4+0],r=p()[s/4+1];if(r)throw k(t)}finally{d.__wbindgen_add_to_stack_pointer(16)}}clone(){const e=d.syncstate_clone(this.__wbg_ptr);return we.__wrap(e)}}async function no(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function fs(){const n={};return n.wbg={},n.wbg.__wbindgen_object_drop_ref=function(e){k(e)},n.wbg.__wbindgen_string_get=function(e,t){const r=R(t),s=typeof r=="string"?r:void 0;var i=G(s)?0:Ee(s,d.__wbindgen_malloc,d.__wbindgen_realloc),o=be;p()[e/4+1]=o,p()[e/4+0]=i},n.wbg.__wbindgen_error_new=function(e,t){const r=new Error(he(e,t));return w(r)},n.wbg.__wbindgen_string_new=function(e,t){const r=he(e,t);return w(r)},n.wbg.__wbindgen_number_new=function(e){return w(e)},n.wbg.__wbindgen_object_clone_ref=function(e){const t=R(e);return w(t)},n.wbg.__wbindgen_number_get=function(e,t){const r=R(t),s=typeof r=="number"?r:void 0;Pt()[e/8+1]=G(s)?0:s,p()[e/4+0]=!G(s)},n.wbg.__wbindgen_is_undefined=function(e){return R(e)===void 0},n.wbg.__wbindgen_boolean_get=function(e){const t=R(e);return typeof t=="boolean"?t?1:0:2},n.wbg.__wbindgen_is_null=function(e){return R(e)===null},n.wbg.__wbindgen_is_string=function(e){return typeof R(e)=="string"},n.wbg.__wbindgen_is_function=function(e){return typeof R(e)=="function"},n.wbg.__wbindgen_is_object=function(e){const t=R(e);return typeof t=="object"&&t!==null},n.wbg.__wbindgen_is_array=function(e){return Array.isArray(R(e))},n.wbg.__wbindgen_json_serialize=function(e,t){const r=R(t),s=JSON.stringify(r===void 0?null:r),i=Ee(s,d.__wbindgen_malloc,d.__wbindgen_realloc),o=be;p()[e/4+1]=o,p()[e/4+0]=i},n.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return w(e)},n.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const r=R(t).stack,s=Ee(r,d.__wbindgen_malloc,d.__wbindgen_realloc),i=be;p()[e/4+1]=i,p()[e/4+0]=s},n.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let r,s;try{r=e,s=t,console.error(he(e,t))}finally{d.__wbindgen_free(r,s,1)}},n.wbg.__wbindgen_jsval_loose_eq=function(e,t){return R(e)==R(t)},n.wbg.__wbg_String_91fba7ded13ba54c=function(e,t){const r=String(R(t)),s=Ee(r,d.__wbindgen_malloc,d.__wbindgen_realloc),i=be;p()[e/4+1]=i,p()[e/4+0]=s},n.wbg.__wbindgen_bigint_from_i64=function(e){return w(e)},n.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return w(t)},n.wbg.__wbg_set_20cbc34131e76824=function(e,t,r){R(e)[k(t)]=k(r)},n.wbg.__wbg_getRandomValues_3aa56aa6edec874c=function(){return ie(function(e,t){R(e).getRandomValues(R(t))},arguments)},n.wbg.__wbg_randomFillSync_5c9c955aa56b6049=function(){return ie(function(e,t){R(e).randomFillSync(k(t))},arguments)},n.wbg.__wbg_crypto_1d1f22824a6a080c=function(e){const t=R(e).crypto;return w(t)},n.wbg.__wbg_process_4a72847cc503995b=function(e){const t=R(e).process;return w(t)},n.wbg.__wbg_versions_f686565e586dd935=function(e){const t=R(e).versions;return w(t)},n.wbg.__wbg_node_104a2ff8d6ea03a2=function(e){const t=R(e).node;return w(t)},n.wbg.__wbg_require_cca90b1a94a0255b=function(){return ie(function(){const e=module.require;return w(e)},arguments)},n.wbg.__wbg_msCrypto_eb05e62b530a1508=function(e){const t=R(e).msCrypto;return w(t)},n.wbg.__wbg_log_5bb5f88f245d7762=function(e){console.log(R(e))},n.wbg.__wbg_log_1746d5c75ec89963=function(e,t){console.log(R(e),R(t))},n.wbg.__wbg_get_bd8e338fbd5f5cc8=function(e,t){const r=R(e)[t>>>0];return w(r)},n.wbg.__wbg_length_cd7af8117672b8b8=function(e){return R(e).length},n.wbg.__wbg_new_16b304a2cfa7ff4a=function(){const e=new Array;return w(e)},n.wbg.__wbg_newnoargs_e258087cd0daa0ea=function(e,t){const r=new Function(he(e,t));return w(r)},n.wbg.__wbg_next_40fc327bfc8770e6=function(e){const t=R(e).next;return w(t)},n.wbg.__wbg_next_196c84450b364254=function(){return ie(function(e){const t=R(e).next();return w(t)},arguments)},n.wbg.__wbg_done_298b57d23c0fc80c=function(e){return R(e).done},n.wbg.__wbg_value_d93c65011f51a456=function(e){const t=R(e).value;return w(t)},n.wbg.__wbg_iterator_2cee6dadfd956dfa=function(){return w(Symbol.iterator)},n.wbg.__wbg_get_e3c254076557e348=function(){return ie(function(e,t){const r=Reflect.get(R(e),R(t));return w(r)},arguments)},n.wbg.__wbg_call_27c0f87801dedf93=function(){return ie(function(e,t){const r=R(e).call(R(t));return w(r)},arguments)},n.wbg.__wbg_new_72fb9a18b5ae2624=function(){const e=new Object;return w(e)},n.wbg.__wbg_length_dee433d4c85c9387=function(e){return R(e).length},n.wbg.__wbg_set_d4638f722068f043=function(e,t,r){R(e)[t>>>0]=k(r)},n.wbg.__wbg_from_89e3fc3ba5e6fb48=function(e){const t=Array.from(R(e));return w(t)},n.wbg.__wbg_isArray_2ab64d95e09ea0ae=function(e){return Array.isArray(R(e))},n.wbg.__wbg_push_a5b05aedc7234f9f=function(e,t){return R(e).push(R(t))},n.wbg.__wbg_unshift_e22df4b34bcf5070=function(e,t){return R(e).unshift(R(t))},n.wbg.__wbg_instanceof_ArrayBuffer_836825be07d4c9d2=function(e){let t;try{t=R(e)instanceof ArrayBuffer}catch{t=!1}return t},n.wbg.__wbg_new_28c511d9baebfa89=function(e,t){const r=new Error(he(e,t));return w(r)},n.wbg.__wbg_call_b3ca7c6051f9bec1=function(){return ie(function(e,t,r){const s=R(e).call(R(t),R(r));return w(s)},arguments)},n.wbg.__wbg_instanceof_Date_f65cf97fb83fc369=function(e){let t;try{t=R(e)instanceof Date}catch{t=!1}return t},n.wbg.__wbg_getTime_2bc4375165f02d15=function(e){return R(e).getTime()},n.wbg.__wbg_new_cf3ec55744a78578=function(e){const t=new Date(R(e));return w(t)},n.wbg.__wbg_instanceof_Object_71ca3c0a59266746=function(e){let t;try{t=R(e)instanceof Object}catch{t=!1}return t},n.wbg.__wbg_assign_496d2d14fecafbcf=function(e,t){const r=Object.assign(R(e),R(t));return w(r)},n.wbg.__wbg_defineProperty_cc00e2de8a0f5141=function(e,t,r){const s=Object.defineProperty(R(e),R(t),R(r));return w(s)},n.wbg.__wbg_entries_95cc2c823b285a09=function(e){const t=Object.entries(R(e));return w(t)},n.wbg.__wbg_freeze_cc6bc19f75299986=function(e){const t=Object.freeze(R(e));return w(t)},n.wbg.__wbg_keys_91e412b4b222659f=function(e){const t=Object.keys(R(e));return w(t)},n.wbg.__wbg_values_9c75e6e2bfbdb70d=function(e){const t=Object.values(R(e));return w(t)},n.wbg.__wbg_new_dd6a5dd7b538af21=function(e,t){const r=new RangeError(he(e,t));return w(r)},n.wbg.__wbg_apply_0a5aa603881e6d79=function(){return ie(function(e,t,r){const s=Reflect.apply(R(e),R(t),R(r));return w(s)},arguments)},n.wbg.__wbg_deleteProperty_13e721a56f19e842=function(){return ie(function(e,t){return Reflect.deleteProperty(R(e),R(t))},arguments)},n.wbg.__wbg_ownKeys_658942b7f28d1fe9=function(){return ie(function(e){const t=Reflect.ownKeys(R(e));return w(t)},arguments)},n.wbg.__wbg_set_1f9b04f170055d33=function(){return ie(function(e,t,r){return Reflect.set(R(e),R(t),R(r))},arguments)},n.wbg.__wbg_buffer_12d079cc21e14bdb=function(e){const t=R(e).buffer;return w(t)},n.wbg.__wbg_concat_3de229fe4fe90fea=function(e,t){const r=R(e).concat(R(t));return w(r)},n.wbg.__wbg_slice_52fb626ffdc8da8f=function(e,t,r){const s=R(e).slice(t>>>0,r>>>0);return w(s)},n.wbg.__wbg_for_27c67e2dbdce22f6=function(e,t){const r=Symbol.for(he(e,t));return w(r)},n.wbg.__wbg_toString_7df3c77999517c20=function(e){const t=R(e).toString();return w(t)},n.wbg.__wbg_self_ce0dbfc45cf2f5be=function(){return ie(function(){const e=self.self;return w(e)},arguments)},n.wbg.__wbg_window_c6fb939a7f436783=function(){return ie(function(){const e=window.window;return w(e)},arguments)},n.wbg.__wbg_globalThis_d1e6af4856ba331b=function(){return ie(function(){const e=globalThis.globalThis;return w(e)},arguments)},n.wbg.__wbg_global_207b558942527489=function(){return ie(function(){const e=global.global;return w(e)},arguments)},n.wbg.__wbg_newwithbyteoffsetandlength_aa4a17c33a06e5cb=function(e,t,r){const s=new Uint8Array(R(e),t>>>0,r>>>0);return w(s)},n.wbg.__wbg_new_63b92bc8671ed464=function(e){const t=new Uint8Array(R(e));return w(t)},n.wbg.__wbg_set_a47bac70306a19a7=function(e,t,r){R(e).set(R(t),r>>>0)},n.wbg.__wbg_length_c20a40f15020d68a=function(e){return R(e).length},n.wbg.__wbg_instanceof_Uint8Array_2b3bbecd033d19f6=function(e){let t;try{t=R(e)instanceof Uint8Array}catch{t=!1}return t},n.wbg.__wbg_newwithlength_e9b4878cebadb3d3=function(e){const t=new Uint8Array(e>>>0);return w(t)},n.wbg.__wbg_subarray_a1f73cd4b5b42fe1=function(e,t,r){const s=R(e).subarray(t>>>0,r>>>0);return w(s)},n.wbg.__wbindgen_debug_string=function(e,t){const r=Sn(R(t)),s=Ee(r,d.__wbindgen_malloc,d.__wbindgen_realloc),i=be;p()[e/4+1]=i,p()[e/4+0]=s},n.wbg.__wbindgen_throw=function(e,t){throw new Error(he(e,t))},n.wbg.__wbindgen_memory=function(){const e=d.memory;return w(e)},n}function us(n,e){return d=n.exports,Kn.__wbindgen_wasm_module=e,gt=null,ht=null,dt=null,d}function ro(n){if(d!==void 0)return d;const e=fs();n instanceof WebAssembly.Module||(n=new WebAssembly.Module(n));const t=new WebAssembly.Instance(n,e);return us(t,n)}async function Kn(n){if(d!==void 0)return d;typeof n>"u"&&(n=new URL(""+new URL("automerge.wasm",import.meta.url).href,import.meta.url));const e=fs();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:t,module:r}=await no(await n,e);return us(t,r)}const so=Object.freeze(Object.defineProperty({__proto__:null,Automerge:Jn,SyncState:we,TextRepresentation:to,create:Vi,decodeChange:Ki,decodeSyncMessage:Zi,decodeSyncState:eo,default:Kn,encodeChange:Ji,encodeSyncMessage:Xi,encodeSyncState:Qi,exportSyncState:Yi,importSyncState:Gi,initSync:ro,initSyncState:qi,load:Wi},Symbol.toStringTag,{value:"Module"}));let qn=!1,ls=[];function io(n){for(const e in n)ne[e]=n[e];qn=!0;for(const e of ls)e()}const ne={create(n){throw new RangeError("Automerge.use() not called")},load(n,e){throw new RangeError("Automerge.use() not called (load)")},encodeChange(n){throw new RangeError("Automerge.use() not called (encodeChange)")},decodeChange(n){throw new RangeError("Automerge.use() not called (decodeChange)")},initSyncState(){throw new RangeError("Automerge.use() not called (initSyncState)")},encodeSyncMessage(n){throw new RangeError("Automerge.use() not called (encodeSyncMessage)")},decodeSyncMessage(n){throw new RangeError("Automerge.use() not called (decodeSyncMessage)")},encodeSyncState(n){throw new RangeError("Automerge.use() not called (encodeSyncState)")},decodeSyncState(n){throw new RangeError("Automerge.use() not called (decodeSyncState)")},exportSyncState(n){throw new RangeError("Automerge.use() not called (exportSyncState)")},importSyncState(n){throw new RangeError("Automerge.use() not called (importSyncState)")}};function Gn(n){return Kn(n).then(e=>{io(so)})}function oo(n){return Gn(Uint8Array.from(atob(n),e=>e.charCodeAt(0)))}function ao(){return qn?Promise.resolve():new Promise(n=>{ls.push(n)})}function co(){return qn}function $(n,e=!0){if(typeof n!="object")throw new RangeError("must be the document root");const t=Reflect.get(n,Te);if(t===void 0||t==null||e&&wt(n)!=="_root")throw new RangeError("must be the document root");return t}function ct(n){Reflect.set(n,Nn,!0)}function Yn(n){return Reflect.get(n,tt)}function wt(n){return typeof n!="object"||n===null?null:Reflect.get(n,nt)}function se(n){return!!Reflect.get(n,en)}function fo(n,e,t){return uo(n,e,t,!0,(r,s)=>r.text(s))}function uo(n,e,t,r,s){const i=n.getAll(e,t);if(i.length<=1)return;const o={};for(const a of i)switch(a[0]){case"map":o[a[1]]=at(n,a[1],r,[t]);break;case"list":o[a[1]]=Et(n,a[1],r,[t]);break;case"text":o[a[1]]=s(n,a[1]);break;case"str":case"uint":case"int":case"f64":case"boolean":case"bytes":case"null":o[a[2]]=a[1];break;case"counter":o[a[2]]=new yt(a[1]);break;case"timestamp":o[a[2]]=new Date(a[1]);break;default:throw RangeError(`datatype ${a[0]} unimplemented`)}return o}var lo=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};function ho(n,e,...t){if(!se(n))throw new RangeError("object cannot be modified outside of a change block");n.insertAt(e,...t)}function go(n,e,t){if(!se(n))throw new RangeError("object cannot be modified outside of a change block");n.deleteAt(e,t)}function _o(n){return $(n).handle}function Xn(n){return typeof n=="object"?n:{actor:n}}function nn(n){const e=Xn(n),t=!!e.freeze,r=e.patchCallback,s=!e.enableTextV2,i=e.actor,o=ne.create({actor:i,text_v1:s});o.enableFreeze(!!e.freeze);const a=e.enableTextV2||!1;return As(o,a),o.materialize("/",void 0,{handle:o,heads:void 0,freeze:t,patchCallback:r,textV2:a})}function ds(n,e){const t=$(n),r=t.handle;return t.handle.materialize("/",e,Object.assign(Object.assign({},t),{handle:r,heads:e}))}function po(n,e){const t=$(n),r=t.heads,s=Xn(e),i=t.handle.fork(s.actor,r);i.updateDiffCursor();const o=lo(t,["heads"]);return o.patchCallback=s.patchCallback,i.applyPatches(n,Object.assign(Object.assign({},o),{handle:i}))}function yo(n){return $(n).handle.free()}function bo(n,e){return mt(nn(e),"from",{},t=>Object.assign(t,n)).newDoc}function hs(n,e,t){if(typeof e=="function")return mt(n,"change",{},e).newDoc;if(typeof t=="function")return typeof e=="string"&&(e={message:e}),mt(n,"change",e,t).newDoc;throw RangeError("Invalid args for change")}function gs(n,e,t,r){if(typeof t=="function")return mt(n,"changeAt",{},t,e);if(typeof r=="function")return typeof t=="string"&&(t={message:t}),mt(n,"changeAt",t,r,e);throw RangeError("Invalid args for changeAt")}function ft(n,e,t,r){if(t==null)return n;const s=$(n),i=Object.assign(Object.assign({},s),{heads:void 0}),{value:o,patches:a}=s.handle.applyAndReturnPatches(n,i);if(a.length>0){r?.(a,{before:n,after:o,source:e});const c=$(o);c.mostRecentPatch={before:$(n).heads,after:c.handle.getHeads(),patches:a}}return s.heads=t,o}function mt(n,e,t,r,s){if(typeof r!="function")throw new RangeError("invalid change function");const i=$(n);if(n===void 0||i===void 0)throw new RangeError("must be the document root");if(i.heads)throw new RangeError("Attempting to change an outdated document.  Use Automerge.clone() if you wish to make a writable copy.");if(se(n))throw new RangeError("Calls to Automerge.change cannot be nested");let o=i.handle.getHeads();s&&Eo(s,o)&&(s=void 0),s&&(i.handle.isolate(s),o=s),"time"in t||(t.time=Math.floor(Date.now()/1e3));try{i.heads=o;const a=$i(i.handle,i.textV2);if(r(a),i.handle.pendingOps()===0)return i.heads=void 0,s&&i.handle.integrate(),{newDoc:n,newHeads:null};{const c=i.handle.commit(t.message,t.time);return i.handle.integrate(),{newDoc:ft(n,e,o,t.patchCallback||i.patchCallback),newHeads:c!=null?[c]:null}}}catch(a){throw i.heads=void 0,i.handle.rollback(),a}}function _s(n,e){e===void 0&&(e={}),typeof e=="string"&&(e={message:e}),"time"in e||(e.time=Math.floor(Date.now()/1e3));const t=$(n);if(t.heads)throw new RangeError("Attempting to change an outdated document.  Use Automerge.clone() if you wish to make a writable copy.");if(se(n))throw new RangeError("Calls to Automerge.change cannot be nested");const r=t.handle.getHeads();return t.handle.emptyChange(e.message,e.time),ft(n,"emptyChange",r)}function wo(n,e){const t=Xn(e),r=t.actor,s=t.patchCallback,i=!t.enableTextV2,o=t.unchecked||!1,a=t.allowMissingChanges||!1,c=t.convertRawStringsToText||!1,u=ne.load(n,{text_v1:i,actor:r,unchecked:o,allowMissingDeps:a,convertRawStringsToText:c});u.enableFreeze(!!t.freeze);const l=t.enableTextV2||!1;return As(u,l),u.materialize("/",void 0,{handle:u,heads:void 0,patchCallback:s,textV2:l})}function Zn(n,e,t){t||(t={});const r=$(n);if(r.heads)throw new RangeError("Attempting to change an out of date document - set at: "+Yn(n));if(se(n))throw new RangeError("Calls to Automerge.change cannot be nested");const s=r.handle.getHeads();return r.handle.loadIncremental(e),ft(n,"loadIncremental",s,t.patchCallback||r.patchCallback)}function mo(n){const e=$(n);if(e.heads)throw new RangeError("Attempting to change an out of date document - set at: "+Yn(n));if(se(n))throw new RangeError("Calls to Automerge.change cannot be nested");return e.handle.saveIncremental()}function Qn(n){return $(n).handle.save()}function ps(n,e){const t=$(n);if(t.heads)throw new RangeError("Attempting to change an out of date document - set at: "+Yn(n));const r=t.handle.getHeads(),s=$(e),i=t.handle.getChangesAdded(s.handle);return t.handle.applyChanges(i),ft(n,"merge",r,t.patchCallback)}function vo(n){return $(n).handle.getActorId()}function xo(n){return $(n).handle.getLastLocalChange()||void 0}function ys(n,e){if(e){const t=$(n,!1),r=wt(n);return!t||!r?null:t.handle.get(r,e)}else return wt(n)}function So(n,e){return $(e).handle.getChanges(me(n))}function bs(n){return $(n).handle.getChanges([])}function ws(n,e,t){const r=$(n);if(t||(t={}),r.heads)throw new RangeError("Attempting to change an outdated document.  Use Automerge.clone() if you wish to make a writable copy.");if(se(n))throw new RangeError("Calls to Automerge.change cannot be nested");const s=r.handle.getHeads();return r.handle.applyChanges(e),r.heads=s,[ft(n,"applyChanges",s,t.patchCallback||r.patchCallback)]}function ko(n){const e=$(n).textV2,t=bs(n);return t.map((r,s)=>({get change(){return Ss(r)},get snapshot(){const[i]=ws(nn({enableTextV2:e}),t.slice(0,s+1));return i}}))}function kn(n,e,t){Cr(e,"before"),Cr(t,"after");const r=$(n);return r.mostRecentPatch&&Jt(r.mostRecentPatch.before,e)&&Jt(r.mostRecentPatch.after,t)?r.mostRecentPatch.patches:r.handle.diff(e,t)}function Eo(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Cr(n,e){if(!Array.isArray(n))throw new Error(`${e} must be an array`)}function Jt(n,e){if(!Ir(n)||!Ir(e))return n===e;const t=Object.keys(n).sort(),r=Object.keys(e).sort();if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s]!==r[s]||!Jt(n[t[s]],e[r[s]]))return!1;return!0}function er(n){const e=ne.importSyncState(n),t=ne.encodeSyncState(e);return e.free(),t}function tr(n){const e=ne.decodeSyncState(n),t=ne.exportSyncState(e);return e.free(),t}function ms(n,e){const t=$(n),r=ne.importSyncState(e),s=t.handle.generateSyncMessage(r);return[ne.exportSyncState(r),s]}function vs(n,e,t,r){const s=ne.importSyncState(e);r||(r={});const i=$(n);if(i.heads)throw new RangeError("Attempting to change an outdated document.  Use Automerge.clone() if you wish to make a writable copy.");if(se(n))throw new RangeError("Calls to Automerge.change cannot be nested");const o=i.handle.getHeads();i.handle.receiveSyncMessage(s,t);const a=ne.exportSyncState(s);return[ft(n,"receiveSyncMessage",o,r.patchCallback||i.patchCallback),a,null]}function Ao(n,e){const t=$(n),r=ne.importSyncState(e);return t.handle.hasOurChanges(r)}function xs(){return ne.exportSyncState(ne.initSyncState())}function Co(n){return ne.encodeChange(n)}function Ss(n){return ne.decodeChange(n)}function Io(n){return ne.encodeSyncMessage(n)}function ks(n){return ne.decodeSyncMessage(n)}function Ro(n,e){return $(n).handle.getMissingDeps(e)}function me(n){const e=$(n);return e.heads||e.handle.getHeads()}function Oo(n){$(n).handle.dump()}function To(n){const e=$(n),t=e.handle.enableFreeze(!1),r=e.handle.materialize();return e.handle.enableFreeze(t),r}function jo(n){return typeof n=="object"&&n!==null?ys(n)==="_root"&&!!Reflect.get(n,Te):!1}function Ir(n){return typeof n=="object"&&n!==null}function Es(n,e){return $(n).handle.saveSince(e)}function Mo(n,e){const t=$(n);for(const r of e)if(!t.handle.getChangeByHash(r))return!1;return!0}function As(n,e){n.registerDatatype("counter",t=>new yt(t),t=>{if(t instanceof yt)return t.value}),e?n.registerDatatype("str",t=>new Nt(t),t=>{if(t instanceof Nt)return t.val}):n.registerDatatype("text",t=>new je(t),t=>{if(t instanceof je)return t.join("")})}function Cs(n){return $(n).handle.topoHistoryTraversal()}function Is(n,e){return $(n).handle.getDecodedChangeByHash(e)}function rn(n){return $(n).handle.stats()}const Do=_o;function $e(n){const e=sn(n);return e.enableTextV2=!0,nn(e)}function En(n,e){const t=sn(e);return t.enableTextV2=!0,po(n,t)}function Rs(n,e){const t=sn(e);return t.enableTextV2=!0,bo(n,t)}function Os(n,e){const t=sn(e);return t.enableTextV2=!0,t.patchCallback?Zn(nn(t),n):wo(n,t)}function sn(n){return typeof n=="object"?n:{actor:n}}function At(n,e,t){if(typeof t=="string"){if(/^[0-9]+@[0-9a-zA-z]+$/.test(t))return n.handle.getCursorPosition(e,t);throw new RangeError("index must be a number or cursor")}else return t}function Uo(n,e,t,r,s){const i=le(n,e,"splice");if(!se(n))throw new RangeError("object cannot be modified outside of a change block");const o=$(n,!1);ct(n),t=At(o,i,t);try{return o.handle.splice(i,t,r,s)}catch(a){throw new RangeError(`Cannot splice: ${a}`)}}function Po(n,e,t){const r=le(n,e,"updateText");if(!se(n))throw new RangeError("object cannot be modified outside of a change block");const s=$(n,!1);ct(n);try{return s.handle.updateText(r,t)}catch(i){throw new RangeError(`Cannot updateText: ${i}`)}}function $o(n,e){const t=$(n,!1),r=le(n,e,"spans");try{return t.handle.spans(r,t.heads)}catch(s){throw new RangeError(`Cannot splice: ${s}`)}}function Lo(n,e,t){const r=le(n,e,"splitBlock"),s=$(n,!1);t=At(s,r,t);try{return s.handle.getBlock(r,t)}catch(i){throw new RangeError(`Cannot get block: ${i}`)}}function Bo(n,e,t,r){if(!se(n))throw new RangeError("object cannot be modified outside of a change block");const s=le(n,e,"splitBlock"),i=$(n,!1);ct(n),t=At(i,s,t);try{i.handle.splitBlock(s,t,r)}catch(o){throw new RangeError(`Cannot splice: ${o}`)}}function Fo(n,e,t){if(!se(n))throw new RangeError("object cannot be modified outside of a change block");const r=le(n,e,"joinBlock"),s=$(n,!1);ct(n),t=At(s,r,t);try{s.handle.joinBlock(r,t)}catch(i){throw new RangeError(`Cannot joinBlock: ${i}`)}}function zo(n,e,t,r){if(!se(n))throw new RangeError("object cannot be modified outside of a change block");const s=le(n,e,"updateBlock"),i=$(n,!1);ct(n),t=At(i,s,t);try{i.handle.updateBlock(s,t,r)}catch(o){throw new RangeError(`Cannot updateBlock: ${o}`)}}function Ho(n,e,t){if(!se(n))throw new RangeError("object cannot be modified outside of a change block");const r=le(n,e,"updateSpans"),s=$(n,!1);ct(n);try{s.handle.updateSpans(r,t)}catch(i){throw new RangeError(`Cannot updateBlock: ${i}`)}}function No(n,e,t){const r=le(n,e,"getCursor"),s=$(n,!1);try{return s.handle.getCursor(r,t)}catch(i){throw new RangeError(`Cannot getCursor: ${i}`)}}function Vo(n,e,t){const r=le(n,e,"getCursorPosition"),s=$(n,!1);try{return s.handle.getCursorPosition(r,t)}catch(i){throw new RangeError(`Cannot getCursorPosition: ${i}`)}}function Wo(n,e,t,r,s){const i=le(n,e,"mark");if(!se(n))throw new RangeError("object cannot be modified outside of a change block");const o=$(n,!1);try{return o.handle.mark(i,t,r,s)}catch(a){throw new RangeError(`Cannot mark: ${a}`)}}function Jo(n,e,t,r){const s=le(n,e,"unmark");if(!se(n))throw new RangeError("object cannot be modified outside of a change block");const i=$(n,!1);try{return i.handle.unmark(s,t,r)}catch(o){throw new RangeError(`Cannot unmark: ${o}`)}}function Ko(n,e){const t=le(n,e,"marks"),r=$(n,!1);try{return r.handle.marks(t)}catch(s){throw new RangeError(`Cannot call marks(): ${s}`)}}function qo(n,e,t){const r=le(n,e,"marksAt"),s=$(n,!1);try{return s.handle.marksAt(r,t)}catch(i){throw new RangeError(`Cannot call marksAt(): ${i}`)}}function Go(n,e){const t=$(n,!1);if(!t.textV2)throw new Error("use getConflicts for a stable document");const r=wt(n);if(r!=null)return fo(t.handle,r,e)}function le(n,e,t){e=e.slice();const r=wt(n);if(!r)throw new RangeError(`invalid object for ${t}`);return e.unshift(r),e.join("/")}const Ts=Object.freeze(Object.defineProperty({__proto__:null,Counter:yt,Float64:zi,Int:Bi,RawString:Nt,Uint:Fi,applyChanges:ws,block:Lo,change:hs,changeAt:gs,clone:En,decodeChange:Ss,decodeSyncMessage:ks,decodeSyncState:tr,deleteAt:go,diff:kn,dump:Oo,emptyChange:_s,encodeChange:Co,encodeSyncMessage:Io,encodeSyncState:er,equals:Jt,free:yo,from:Rs,generateSyncMessage:ms,getActorId:vo,getAllChanges:bs,getBackend:Do,getChanges:So,getConflicts:Go,getCursor:No,getCursorPosition:Vo,getHeads:me,getHistory:ko,getLastLocalChange:xo,getMissingDeps:Ro,getObjectId:ys,hasHeads:Mo,hasOurChanges:Ao,init:$e,initSyncState:xs,initializeBase64Wasm:oo,initializeWasm:Gn,insertAt:ho,inspectChange:Is,isAutomerge:jo,isWasmInitialized:co,joinBlock:Fo,load:Os,loadIncremental:Zn,mark:Wo,marks:Ko,marksAt:qo,merge:ps,receiveSyncMessage:vs,save:Qn,saveIncremental:mo,saveSince:Es,spans:$o,splice:Uo,splitBlock:Bo,stats:rn,toJS:To,topoHistoryTraversal:Cs,unmark:Jo,updateBlock:zo,updateSpans:Ho,updateText:Po,view:ds,wasmInitialized:ao},Symbol.toStringTag,{value:"Module"}));var Yo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function nr(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var An={exports:{}},ln,Rr;function Xo(){if(Rr)return ln;Rr=1;var n=1e3,e=n*60,t=e*60,r=t*24,s=r*7,i=r*365.25;ln=function(l,f){f=f||{};var g=typeof l;if(g==="string"&&l.length>0)return o(l);if(g==="number"&&isFinite(l))return f.long?c(l):a(l);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(l))};function o(l){if(l=String(l),!(l.length>100)){var f=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(l);if(f){var g=parseFloat(f[1]),h=(f[2]||"ms").toLowerCase();switch(h){case"years":case"year":case"yrs":case"yr":case"y":return g*i;case"weeks":case"week":case"w":return g*s;case"days":case"day":case"d":return g*r;case"hours":case"hour":case"hrs":case"hr":case"h":return g*t;case"minutes":case"minute":case"mins":case"min":case"m":return g*e;case"seconds":case"second":case"secs":case"sec":case"s":return g*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return g;default:return}}}}function a(l){var f=Math.abs(l);return f>=r?Math.round(l/r)+"d":f>=t?Math.round(l/t)+"h":f>=e?Math.round(l/e)+"m":f>=n?Math.round(l/n)+"s":l+"ms"}function c(l){var f=Math.abs(l);return f>=r?u(l,f,r,"day"):f>=t?u(l,f,t,"hour"):f>=e?u(l,f,e,"minute"):f>=n?u(l,f,n,"second"):l+" ms"}function u(l,f,g,h){var y=f>=g*1.5;return Math.round(l/g)+" "+h+(y?"s":"")}return ln}function Zo(n){t.debug=t,t.default=t,t.coerce=c,t.disable=i,t.enable=s,t.enabled=o,t.humanize=Xo(),t.destroy=u,Object.keys(n).forEach(l=>{t[l]=n[l]}),t.names=[],t.skips=[],t.formatters={};function e(l){let f=0;for(let g=0;g<l.length;g++)f=(f<<5)-f+l.charCodeAt(g),f|=0;return t.colors[Math.abs(f)%t.colors.length]}t.selectColor=e;function t(l){let f,g=null,h,y;function v(...S){if(!v.enabled)return;const T=v,j=Number(new Date),A=j-(f||j);T.diff=A,T.prev=f,T.curr=j,f=j,S[0]=t.coerce(S[0]),typeof S[0]!="string"&&S.unshift("%O");let N=0;S[0]=S[0].replace(/%([a-zA-Z%])/g,(E,U)=>{if(E==="%%")return"%";N++;const P=t.formatters[U];if(typeof P=="function"){const L=S[N];E=P.call(T,L),S.splice(N,1),N--}return E}),t.formatArgs.call(T,S),(T.log||t.log).apply(T,S)}return v.namespace=l,v.useColors=t.useColors(),v.color=t.selectColor(l),v.extend=r,v.destroy=t.destroy,Object.defineProperty(v,"enabled",{enumerable:!0,configurable:!1,get:()=>g!==null?g:(h!==t.namespaces&&(h=t.namespaces,y=t.enabled(l)),y),set:S=>{g=S}}),typeof t.init=="function"&&t.init(v),v}function r(l,f){const g=t(this.namespace+(typeof f>"u"?":":f)+l);return g.log=this.log,g}function s(l){t.save(l),t.namespaces=l,t.names=[],t.skips=[];let f;const g=(typeof l=="string"?l:"").split(/[\s,]+/),h=g.length;for(f=0;f<h;f++)g[f]&&(l=g[f].replace(/\*/g,".*?"),l[0]==="-"?t.skips.push(new RegExp("^"+l.slice(1)+"$")):t.names.push(new RegExp("^"+l+"$")))}function i(){const l=[...t.names.map(a),...t.skips.map(a).map(f=>"-"+f)].join(",");return t.enable(""),l}function o(l){if(l[l.length-1]==="*")return!0;let f,g;for(f=0,g=t.skips.length;f<g;f++)if(t.skips[f].test(l))return!1;for(f=0,g=t.names.length;f<g;f++)if(t.names[f].test(l))return!0;return!1}function a(l){return l.toString().substring(2,l.toString().length-2).replace(/\.\*\?$/,"*")}function c(l){return l instanceof Error?l.stack||l.message:l}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var Qo=Zo;(function(n,e){var t={};e.formatArgs=s,e.save=i,e.load=o,e.useColors=r,e.storage=a(),e.destroy=(()=>{let u=!1;return()=>{u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function s(u){if(u[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+u[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const l="color: "+this.color;u.splice(1,0,l,"color: inherit");let f=0,g=0;u[0].replace(/%[a-zA-Z%]/g,h=>{h!=="%%"&&(f++,h==="%c"&&(g=f))}),u.splice(g,0,l)}e.log=console.debug||console.log||(()=>{});function i(u){try{u?e.storage.setItem("debug",u):e.storage.removeItem("debug")}catch{}}function o(){let u;try{u=e.storage.getItem("debug")}catch{}return!u&&typeof process<"u"&&"env"in process&&(u=t.DEBUG),u}function a(){try{return localStorage}catch{}}n.exports=Qo(e);const{formatters:c}=n.exports;c.j=function(u){try{return JSON.stringify(u)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}}})(An,An.exports);var ea=An.exports;const Ae=nr(ea);var js={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(c,u,l){this.fn=c,this.context=u,this.once=l||!1}function i(c,u,l,f,g){if(typeof l!="function")throw new TypeError("The listener must be a function");var h=new s(l,f||c,g),y=t?t+u:u;return c._events[y]?c._events[y].fn?c._events[y]=[c._events[y],h]:c._events[y].push(h):(c._events[y]=h,c._eventsCount++),c}function o(c,u){--c._eventsCount===0?c._events=new r:delete c._events[u]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],l,f;if(this._eventsCount===0)return u;for(f in l=this._events)e.call(l,f)&&u.push(t?f.slice(1):f);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(l)):u},a.prototype.listeners=function(u){var l=t?t+u:u,f=this._events[l];if(!f)return[];if(f.fn)return[f.fn];for(var g=0,h=f.length,y=new Array(h);g<h;g++)y[g]=f[g].fn;return y},a.prototype.listenerCount=function(u){var l=t?t+u:u,f=this._events[l];return f?f.fn?1:f.length:0},a.prototype.emit=function(u,l,f,g,h,y){var v=t?t+u:u;if(!this._events[v])return!1;var S=this._events[v],T=arguments.length,j,A;if(S.fn){switch(S.once&&this.removeListener(u,S.fn,void 0,!0),T){case 1:return S.fn.call(S.context),!0;case 2:return S.fn.call(S.context,l),!0;case 3:return S.fn.call(S.context,l,f),!0;case 4:return S.fn.call(S.context,l,f,g),!0;case 5:return S.fn.call(S.context,l,f,g,h),!0;case 6:return S.fn.call(S.context,l,f,g,h,y),!0}for(A=1,j=new Array(T-1);A<T;A++)j[A-1]=arguments[A];S.fn.apply(S.context,j)}else{var N=S.length,z;for(A=0;A<N;A++)switch(S[A].once&&this.removeListener(u,S[A].fn,void 0,!0),T){case 1:S[A].fn.call(S[A].context);break;case 2:S[A].fn.call(S[A].context,l);break;case 3:S[A].fn.call(S[A].context,l,f);break;case 4:S[A].fn.call(S[A].context,l,f,g);break;default:if(!j)for(z=1,j=new Array(T-1);z<T;z++)j[z-1]=arguments[z];S[A].fn.apply(S[A].context,j)}}return!0},a.prototype.on=function(u,l,f){return i(this,u,l,f,!1)},a.prototype.once=function(u,l,f){return i(this,u,l,f,!0)},a.prototype.removeListener=function(u,l,f,g){var h=t?t+u:u;if(!this._events[h])return this;if(!l)return o(this,h),this;var y=this._events[h];if(y.fn)y.fn===l&&(!g||y.once)&&(!f||y.context===f)&&o(this,h);else{for(var v=0,S=[],T=y.length;v<T;v++)(y[v].fn!==l||g&&!y[v].once||f&&y[v].context!==f)&&S.push(y[v]);S.length?this._events[h]=S.length===1?S[0]:S:o(this,h)}return this},a.prototype.removeAllListeners=function(u){var l;return u?(l=t?t+u:u,this._events[l]&&o(this,l)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(js);var ta=js.exports;const Me=nr(ta);function na(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global}function ra(){const n=na();if(n.__xstate__)return n.__xstate__}const sa=n=>{if(typeof window>"u")return;const e=ra();e&&e.register(n)};class Or{constructor(e){this._process=e,this._active=!1,this._current=null,this._last=null}start(){this._active=!0,this.flush()}clear(){this._current&&(this._current.next=null,this._last=this._current)}enqueue(e){const t={value:e,next:null};if(this._current){this._last.next=t,this._last=t;return}this._current=t,this._last=t,this._active&&this.flush()}flush(){for(;this._current;){const e=this._current;this._process(e.value),this._current=e.next}this._last=null}}const Ms=".",ia="",Ds="",oa="#",aa="*",Us="xstate.init",Cn="xstate.stop";function ca(n,e){return{type:`xstate.after.${n}.${e}`}}function In(n,e){return{type:`xstate.done.state.${n}`,output:e}}function fa(n,e){return{type:`xstate.done.actor.${n}`,output:e,actorId:n}}function ua(n,e){return{type:`xstate.error.actor.${n}`,error:e,actorId:n}}function Ps(n){return{type:Us,input:n}}function Ce(n){setTimeout(()=>{throw n})}const la=typeof Symbol=="function"&&Symbol.observable||"@@observable";function $s(n,e){const t=Tr(n),r=Tr(e);return typeof r=="string"?typeof t=="string"?r===t:!1:typeof t=="string"?t in r:Object.keys(t).every(s=>s in r?$s(t[s],r[s]):!1)}function rr(n){if(Bs(n))return n;let e=[],t="";for(let r=0;r<n.length;r++){switch(n.charCodeAt(r)){case 92:t+=n[r+1],r++;continue;case 46:e.push(t),t="";continue}t+=n[r]}return e.push(t),e}function Tr(n){if(Va(n))return n.value;if(typeof n!="string")return n;const e=rr(n);return da(e)}function da(n){if(n.length===1)return n[0];const e={};let t=e;for(let r=0;r<n.length-1;r++)if(r===n.length-2)t[n[r]]=n[r+1];else{const s=t;t={},s[n[r]]=t}return e}function jr(n,e){const t={},r=Object.keys(n);for(let s=0;s<r.length;s++){const i=r[s];t[i]=e(n[i],i,n,s)}return t}function Ls(n){return Bs(n)?n:[n]}function Oe(n){return n===void 0?[]:Ls(n)}function Rn(n,e,t,r){return typeof n=="function"?n({context:e,event:t,self:r}):n}function Bs(n){return Array.isArray(n)}function ha(n){return n.type.startsWith("xstate.error.actor")}function Ye(n){return Ls(n).map(e=>typeof e>"u"||typeof e=="string"?{target:e}:e)}function Fs(n){if(!(n===void 0||n===ia))return Oe(n)}function On(n,e,t){const r=typeof n=="object",s=r?n:void 0;return{next:(r?n.next:n)?.bind(s),error:(r?n.error:e)?.bind(s),complete:(r?n.complete:t)?.bind(s)}}function Mr(n,e){return`${e}.${n}`}function sr(n,e){const t=e.match(/^xstate\.invoke\.(\d+)\.(.*)/);if(!t)return n.implementations.actors[e];const[,r,s]=t,o=n.getStateNodeById(s).config.invoke;return(Array.isArray(o)?o[r]:o).src}function Dr(n,e){return`${n.sessionId}.${e}`}let ga=0;function _a(n,e){const t=new Map,r=new Map,s=new WeakMap,i=new Set,o={},{clock:a,logger:c}=e,u={schedule:(g,h,y,v,S=Math.random().toString(36).slice(2))=>{const T={source:g,target:h,event:y,delay:v,id:S,startedAt:Date.now()},j=Dr(g,S);f._snapshot._scheduledEvents[j]=T;const A=a.setTimeout(()=>{delete o[j],delete f._snapshot._scheduledEvents[j],f._relay(g,h,y)},v);o[j]=A},cancel:(g,h)=>{const y=Dr(g,h),v=o[y];delete o[y],delete f._snapshot._scheduledEvents[y],v!==void 0&&a.clearTimeout(v)},cancelAll:g=>{for(const h in f._snapshot._scheduledEvents){const y=f._snapshot._scheduledEvents[h];y.source===g&&u.cancel(g,y.id)}}},l=g=>{if(!i.size)return;const h={...g,rootId:n.sessionId};i.forEach(y=>y.next?.(h))},f={_snapshot:{_scheduledEvents:(e?.snapshot&&e.snapshot.scheduler)??{}},_bookId:()=>`x:${ga++}`,_register:(g,h)=>(t.set(g,h),g),_unregister:g=>{t.delete(g.sessionId);const h=s.get(g);h!==void 0&&(r.delete(h),s.delete(g))},get:g=>r.get(g),_set:(g,h)=>{const y=r.get(g);if(y&&y!==h)throw new Error(`Actor with system ID '${g}' already exists.`);r.set(g,h),s.set(h,g)},inspect:g=>{const h=On(g);return i.add(h),{unsubscribe(){i.delete(h)}}},_sendInspectionEvent:l,_relay:(g,h,y)=>{f._sendInspectionEvent({type:"@xstate.event",sourceRef:g,actorRef:h,event:y}),h._send(y)},scheduler:u,getSnapshot:()=>({_scheduledEvents:{...f._snapshot._scheduledEvents}}),start:()=>{const g=f._snapshot._scheduledEvents;f._snapshot._scheduledEvents={};for(const h in g){const{source:y,target:v,event:S,delay:T,id:j}=g[h];u.schedule(y,v,S,T,j)}},_clock:a,_logger:c};return f}const ir=1;let oe=function(n){return n[n.NotStarted=0]="NotStarted",n[n.Running=1]="Running",n[n.Stopped=2]="Stopped",n}({});const pa={clock:{setTimeout:(n,e)=>setTimeout(n,e),clearTimeout:n=>clearTimeout(n)},logger:console.log.bind(console),devTools:!1};class ya{constructor(e,t){this.logic=e,this._snapshot=void 0,this.clock=void 0,this.options=void 0,this.id=void 0,this.mailbox=new Or(this._process.bind(this)),this.observers=new Set,this.eventListeners=new Map,this.logger=void 0,this._processingStatus=oe.NotStarted,this._parent=void 0,this._syncSnapshot=void 0,this.ref=void 0,this._actorScope=void 0,this._systemId=void 0,this.sessionId=void 0,this.system=void 0,this._doneEvent=void 0,this.src=void 0,this._deferred=[];const r={...pa,...t},{clock:s,logger:i,parent:o,syncSnapshot:a,id:c,systemId:u,inspect:l}=r;this.system=o?o.system:_a(this,{clock:s,logger:i}),l&&!o&&this.system.inspect(On(l)),this.sessionId=this.system._bookId(),this.id=c??this.sessionId,this.logger=t?.logger??this.system._logger,this.clock=t?.clock??this.system._clock,this._parent=o,this._syncSnapshot=a,this.options=r,this.src=r.src??e,this.ref=this,this._actorScope={self:this,id:this.id,sessionId:this.sessionId,logger:this.logger,defer:f=>{this._deferred.push(f)},system:this.system,stopChild:f=>{if(f._parent!==this)throw new Error(`Cannot stop child actor ${f.id} of ${this.id} because it is not a child`);f._stop()},emit:f=>{const g=this.eventListeners.get(f.type),h=this.eventListeners.get("*");if(!g&&!h)return;const y=new Set([...g?g.values():[],...h?h.values():[]]);for(const v of Array.from(y))v(f)}},this.send=this.send.bind(this),this.system._sendInspectionEvent({type:"@xstate.actor",actorRef:this}),u&&(this._systemId=u,this.system._set(u,this)),this._initState(t?.snapshot??t?.state),u&&this._snapshot.status!=="active"&&this.system._unregister(this)}_initState(e){try{this._snapshot=e?this.logic.restoreSnapshot?this.logic.restoreSnapshot(e,this._actorScope):e:this.logic.getInitialSnapshot(this._actorScope,this.options?.input)}catch(t){this._snapshot={status:"error",output:void 0,error:t}}}update(e,t){this._snapshot=e;let r;for(;r=this._deferred.shift();)try{r()}catch(s){this._deferred.length=0,this._snapshot={...e,status:"error",error:s}}switch(this._snapshot.status){case"active":for(const s of this.observers)try{s.next?.(e)}catch(i){Ce(i)}break;case"done":for(const s of this.observers)try{s.next?.(e)}catch(i){Ce(i)}this._stopProcedure(),this._complete(),this._doneEvent=fa(this.id,this._snapshot.output),this._parent&&this.system._relay(this,this._parent,this._doneEvent);break;case"error":this._error(this._snapshot.error);break}this.system._sendInspectionEvent({type:"@xstate.snapshot",actorRef:this,event:t,snapshot:e})}subscribe(e,t,r){const s=On(e,t,r);if(this._processingStatus!==oe.Stopped)this.observers.add(s);else switch(this._snapshot.status){case"done":try{s.complete?.()}catch(i){Ce(i)}break;case"error":{const i=this._snapshot.error;if(!s.error)Ce(i);else try{s.error(i)}catch(o){Ce(o)}break}}return{unsubscribe:()=>{this.observers.delete(s)}}}on(e,t){let r=this.eventListeners.get(e);r||(r=new Set,this.eventListeners.set(e,r));const s=t.bind(void 0);return r.add(s),{unsubscribe:()=>{r.delete(s)}}}start(){if(this._processingStatus===oe.Running)return this;this._syncSnapshot&&this.subscribe({next:r=>{r.status==="active"&&this.system._relay(this,this._parent,{type:`xstate.snapshot.${this.id}`,snapshot:r})},error:()=>{}}),this.system._register(this.sessionId,this),this._systemId&&this.system._set(this._systemId,this),this._processingStatus=oe.Running;const e=Ps(this.options.input);switch(this.system._sendInspectionEvent({type:"@xstate.event",sourceRef:this._parent,actorRef:this,event:e}),this._snapshot.status){case"done":return this.update(this._snapshot,e),this;case"error":return this._error(this._snapshot.error),this}if(this._parent||this.system.start(),this.logic.start)try{this.logic.start(this._snapshot,this._actorScope)}catch(r){return this._snapshot={...this._snapshot,status:"error",error:r},this._error(r),this}return this.update(this._snapshot,e),this.options.devTools&&this.attachDevTools(),this.mailbox.start(),this}_process(e){let t,r;try{t=this.logic.transition(this._snapshot,e,this._actorScope)}catch(s){r={err:s}}if(r){const{err:s}=r;this._snapshot={...this._snapshot,status:"error",error:s},this._error(s);return}this.update(t,e),e.type===Cn&&(this._stopProcedure(),this._complete())}_stop(){return this._processingStatus===oe.Stopped?this:(this.mailbox.clear(),this._processingStatus===oe.NotStarted?(this._processingStatus=oe.Stopped,this):(this.mailbox.enqueue({type:Cn}),this))}stop(){if(this._parent)throw new Error("A non-root actor cannot be stopped directly.");return this._stop()}_complete(){for(const e of this.observers)try{e.complete?.()}catch(t){Ce(t)}this.observers.clear()}_reportError(e){if(!this.observers.size){this._parent||Ce(e);return}let t=!1;for(const r of this.observers){const s=r.error;t||=!s;try{s?.(e)}catch(i){Ce(i)}}this.observers.clear(),t&&Ce(e)}_error(e){this._stopProcedure(),this._reportError(e),this._parent&&this.system._relay(this,this._parent,ua(this.id,e))}_stopProcedure(){return this._processingStatus!==oe.Running?this:(this.system.scheduler.cancelAll(this),this.mailbox.clear(),this.mailbox=new Or(this._process.bind(this)),this._processingStatus=oe.Stopped,this.system._unregister(this),this)}_send(e){this._processingStatus!==oe.Stopped&&this.mailbox.enqueue(e)}send(e){this.system._relay(void 0,this,e)}attachDevTools(){const{devTools:e}=this.options;e&&(typeof e=="function"?e:sa)(this)}toJSON(){return{xstate$$type:ir,id:this.id}}getPersistedSnapshot(e){return this.logic.getPersistedSnapshot(this._snapshot,e)}[la](){return this}getSnapshot(){return this._snapshot}}function vt(n,...[e]){return new ya(n,e)}function ba(n,e,t,r,{sendId:s}){const i=typeof s=="function"?s(t,r):s;return[e,i]}function wa(n,e){n.defer(()=>{n.system.scheduler.cancel(n.self,e)})}function ma(n){function e(t,r){}return e.type="xstate.cancel",e.sendId=n,e.resolve=ba,e.execute=wa,e}function va(n,e,t,r,{id:s,systemId:i,src:o,input:a,syncSnapshot:c}){const u=typeof o=="string"?sr(e.machine,o):o,l=typeof s=="function"?s(t):s;let f;return u&&(f=vt(u,{id:l,src:o,parent:n.self,syncSnapshot:c,systemId:i,input:typeof a=="function"?a({context:e.context,event:t.event,self:n.self}):a})),[We(e,{children:{...e.children,[l]:f}}),{id:s,actorRef:f}]}function xa(n,{id:e,actorRef:t}){t&&n.defer(()=>{t._processingStatus!==oe.Stopped&&t.start()})}function Sa(...[n,{id:e,systemId:t,input:r,syncSnapshot:s=!1}={}]){function i(o,a){}return i.type="snapshot.spawnChild",i.id=e,i.systemId=t,i.src=n,i.input=r,i.syncSnapshot=s,i.resolve=va,i.execute=xa,i}function ka(n,e,t,r,{actorRef:s}){const i=typeof s=="function"?s(t,r):s,o=typeof i=="string"?e.children[i]:i;let a=e.children;return o&&(a={...a},delete a[o.id]),[We(e,{children:a}),o]}function Ea(n,e){if(e){if(n.system._unregister(e),e._processingStatus!==oe.Running){n.stopChild(e);return}n.defer(()=>{n.stopChild(e)})}}function zs(n){function e(t,r){}return e.type="xstate.stopChild",e.actorRef=n,e.resolve=ka,e.execute=Ea,e}function or(n,e,t,r){const{machine:s}=r,i=typeof n=="function",o=i?n:s.implementations.guards[typeof n=="string"?n:n.type];if(!i&&!o)throw new Error(`Guard '${typeof n=="string"?n:n.type}' is not implemented.'.`);if(typeof o!="function")return or(o,e,t,r);const a={context:e,event:t},c=i||typeof n=="string"?void 0:"params"in n?typeof n.params=="function"?n.params({context:e,event:t}):n.params:void 0;return"check"in o?o.check(r,a,o):o(a,c)}const ar=n=>n.type==="atomic"||n.type==="final";function rt(n){return Object.values(n.states).filter(e=>e.type!=="history")}function Ct(n,e){const t=[];if(e===n)return t;let r=n.parent;for(;r&&r!==e;)t.push(r),r=r.parent;return t}function Kt(n){const e=new Set(n),t=Ns(e);for(const r of e)if(r.type==="compound"&&(!t.get(r)||!t.get(r).length))Ur(r).forEach(s=>e.add(s));else if(r.type==="parallel"){for(const s of rt(r))if(s.type!=="history"&&!e.has(s)){const i=Ur(s);for(const o of i)e.add(o)}}for(const r of e){let s=r.parent;for(;s;)e.add(s),s=s.parent}return e}function Hs(n,e){const t=e.get(n);if(!t)return{};if(n.type==="compound"){const s=t[0];if(s){if(ar(s))return s.key}else return{}}const r={};for(const s of t)r[s.key]=Hs(s,e);return r}function Ns(n){const e=new Map;for(const t of n)e.has(t)||e.set(t,[]),t.parent&&(e.has(t.parent)||e.set(t.parent,[]),e.get(t.parent).push(t));return e}function Vs(n,e){const t=Kt(e);return Hs(n,Ns(t))}function cr(n,e){return e.type==="compound"?rt(e).some(t=>t.type==="final"&&n.has(t)):e.type==="parallel"?rt(e).every(t=>cr(n,t)):e.type==="final"}const on=n=>n[0]===oa;function Aa(n,e){return n.transitions.get(e)||[...n.transitions.keys()].filter(r=>{if(r===aa)return!0;if(!r.endsWith(".*"))return!1;const s=r.split("."),i=e.split(".");for(let o=0;o<s.length;o++){const a=s[o],c=i[o];if(a==="*")return o===s.length-1;if(a!==c)return!1}return!0}).sort((r,s)=>s.length-r.length).flatMap(r=>n.transitions.get(r))}function Ca(n){const e=n.config.after;if(!e)return[];const t=(s,i)=>{const o=ca(s,n.id),a=o.type;return n.entry.push(Qa(o,{id:a,delay:s})),n.exit.push(ma(a)),a};return Object.keys(e).flatMap((s,i)=>{const o=e[s],a=typeof o=="string"?{target:o}:o,c=Number.isNaN(+s)?s:+s,u=t(c);return Oe(a).map(l=>({...l,event:u,delay:c}))}).map(s=>{const{delay:i}=s;return{...He(n,s.event,s),delay:i}})}function He(n,e,t){const r=Fs(t.target),s=t.reenter??!1,i=Oa(n,r),o={...t,actions:Oe(t.actions),guard:t.guard,target:i,source:n,reenter:s,eventType:e,toJSON:()=>({...o,source:`#${n.id}`,target:i?i.map(a=>`#${a.id}`):void 0})};return o}function Ia(n){const e=new Map;if(n.config.on)for(const t of Object.keys(n.config.on)){if(t===Ds)throw new Error('Null events ("") cannot be specified as a transition key. Use `always: { ... }` instead.');const r=n.config.on[t];e.set(t,Ye(r).map(s=>He(n,t,s)))}if(n.config.onDone){const t=`xstate.done.state.${n.id}`;e.set(t,Ye(n.config.onDone).map(r=>He(n,t,r)))}for(const t of n.invoke){if(t.onDone){const r=`xstate.done.actor.${t.id}`;e.set(r,Ye(t.onDone).map(s=>He(n,r,s)))}if(t.onError){const r=`xstate.error.actor.${t.id}`;e.set(r,Ye(t.onError).map(s=>He(n,r,s)))}if(t.onSnapshot){const r=`xstate.snapshot.${t.id}`;e.set(r,Ye(t.onSnapshot).map(s=>He(n,r,s)))}}for(const t of n.after){let r=e.get(t.eventType);r||(r=[],e.set(t.eventType,r)),r.push(t)}return e}function Ra(n,e){const t=typeof e=="string"?n.states[e]:e?n.states[e.target]:void 0;if(!t&&e)throw new Error(`Initial state node "${e}" not found on parent state node #${n.id}`);const r={source:n,actions:!e||typeof e=="string"?[]:Oe(e.actions),eventType:null,reenter:!1,target:t?[t]:[],toJSON:()=>({...r,source:`#${n.id}`,target:t?[`#${t.id}`]:[]})};return r}function Oa(n,e){if(e!==void 0)return e.map(t=>{if(typeof t!="string")return t;if(on(t))return n.machine.getStateNodeById(t);const r=t[0]===Ms;if(r&&!n.parent)return qt(n,t.slice(1));const s=r?n.key+t:t;if(n.parent)try{return qt(n.parent,s)}catch(i){throw new Error(`Invalid transition definition for state node '${n.id}':
${i.message}`)}else throw new Error(`Invalid target: "${t}" is not a valid target from the root node. Did you mean ".${t}"?`)})}function Ws(n){const e=Fs(n.config.target);return e?{target:e.map(t=>typeof t=="string"?qt(n.parent,t):t)}:n.parent.initial}function Ne(n){return n.type==="history"}function Ur(n){const e=Js(n);for(const t of e)for(const r of Ct(t,n))e.add(r);return e}function Js(n){const e=new Set;function t(r){if(!e.has(r)){if(e.add(r),r.type==="compound")t(r.initial.target[0]);else if(r.type==="parallel")for(const s of rt(r))t(s)}}return t(n),e}function st(n,e){if(on(e))return n.machine.getStateNodeById(e);if(!n.states)throw new Error(`Unable to retrieve child state '${e}' from '${n.id}'; no child states exist.`);const t=n.states[e];if(!t)throw new Error(`Child state '${e}' does not exist on '${n.id}'`);return t}function qt(n,e){if(typeof e=="string"&&on(e))try{return n.machine.getStateNodeById(e)}catch{}const t=rr(e).slice();let r=n;for(;t.length;){const s=t.shift();if(!s.length)break;r=st(r,s)}return r}function Gt(n,e){if(typeof e=="string"){const s=n.states[e];if(!s)throw new Error(`State '${e}' does not exist on '${n.id}'`);return[n,s]}const t=Object.keys(e),r=t.map(s=>st(n,s)).filter(Boolean);return[n.machine.root,n].concat(r,t.reduce((s,i)=>{const o=st(n,i);if(!o)return s;const a=Gt(o,e[i]);return s.concat(a)},[]))}function Ta(n,e,t,r){const i=st(n,e).next(t,r);return!i||!i.length?n.next(t,r):i}function ja(n,e,t,r){const s=Object.keys(e),i=st(n,s[0]),o=fr(i,e[s[0]],t,r);return!o||!o.length?n.next(t,r):o}function Ma(n,e,t,r){const s=[];for(const i of Object.keys(e)){const o=e[i];if(!o)continue;const a=st(n,i),c=fr(a,o,t,r);c&&s.push(...c)}return s.length?s:n.next(t,r)}function fr(n,e,t,r){return typeof e=="string"?Ta(n,e,t,r):Object.keys(e).length===1?ja(n,e,t,r):Ma(n,e,t,r)}function Da(n){return Object.keys(n.states).map(e=>n.states[e]).filter(e=>e.type==="history")}function Le(n,e){let t=n;for(;t.parent&&t.parent!==e;)t=t.parent;return t.parent===e}function Ua(n,e){const t=new Set(n),r=new Set(e);for(const s of t)if(r.has(s))return!0;for(const s of r)if(t.has(s))return!0;return!1}function Ks(n,e,t){const r=new Set;for(const s of n){let i=!1;const o=new Set;for(const a of r)if(Ua(Tn([s],e,t),Tn([a],e,t)))if(Le(s.source,a.source))o.add(a);else{i=!0;break}if(!i){for(const a of o)r.delete(a);r.add(s)}}return Array.from(r)}function Pa(n){const[e,...t]=n;for(const r of Ct(e,void 0))if(t.every(s=>Le(s,r)))return r}function ur(n,e){if(!n.target)return[];const t=new Set;for(const r of n.target)if(Ne(r))if(e[r.id])for(const s of e[r.id])t.add(s);else for(const s of ur(Ws(r),e))t.add(s);else t.add(r);return[...t]}function qs(n,e){const t=ur(n,e);if(!t)return;if(!n.reenter&&t.every(s=>s===n.source||Le(s,n.source)))return n.source;const r=Pa(t.concat(n.source));if(r)return r;if(!n.reenter)return n.source.machine.root}function Tn(n,e,t){const r=new Set;for(const s of n)if(s.target?.length){const i=qs(s,t);s.reenter&&s.source===i&&r.add(i);for(const o of e)Le(o,i)&&r.add(o)}return[...r]}function $a(n,e){if(n.length!==e.size)return!1;for(const t of n)if(!e.has(t))return!1;return!0}function jn(n,e,t,r,s,i){if(!n.length)return e;const o=new Set(e._nodes);let a=e.historyValue;const c=Ks(n,o,a);let u=e;s||([u,a]=za(u,r,t,c,o,a,i)),u=it(u,r,t,c.flatMap(f=>f.actions),i),u=Ba(u,r,t,c,o,i,a,s);const l=[...o];u.status==="done"&&(u=it(u,r,t,l.sort((f,g)=>g.order-f.order).flatMap(f=>f.exit),i));try{return a===e.historyValue&&$a(e._nodes,o)?u:We(u,{_nodes:l,historyValue:a})}catch(f){throw f}}function La(n,e,t,r,s){if(r.output===void 0)return;const i=In(s.id,s.output!==void 0&&s.parent?Rn(s.output,n.context,e,t.self):void 0);return Rn(r.output,n.context,i,t.self)}function Ba(n,e,t,r,s,i,o,a){let c=n;const u=new Set,l=new Set;Fa(r,o,l,u),a&&l.add(n.machine.root);const f=new Set;for(const g of[...u].sort((h,y)=>h.order-y.order)){s.add(g);const h=[];h.push(...g.entry);for(const y of g.invoke)h.push(Sa(y.src,{...y,syncSnapshot:!!y.onSnapshot}));if(l.has(g)){const y=g.initial.actions;h.push(...y)}if(c=it(c,e,t,h,i,g.invoke.map(y=>y.id)),g.type==="final"){const y=g.parent;let v=y?.type==="parallel"?y:y?.parent,S=v||g;for(y?.type==="compound"&&i.push(In(y.id,g.output!==void 0?Rn(g.output,c.context,e,t.self):void 0));v?.type==="parallel"&&!f.has(v)&&cr(s,v);)f.add(v),i.push(In(v.id)),S=v,v=v.parent;if(v)continue;c=We(c,{status:"done",output:La(c,e,t,c.machine.root,S)})}}return c}function Fa(n,e,t,r){for(const s of n){const i=qs(s,e);for(const a of s.target||[])!Ne(a)&&(s.source!==a||s.source!==i||s.reenter)&&(r.add(a),t.add(a)),Ze(a,e,t,r);const o=ur(s,e);for(const a of o){const c=Ct(a,i);i?.type==="parallel"&&c.push(i),Gs(r,e,t,c,!s.source.parent&&s.reenter?void 0:i)}}}function Ze(n,e,t,r){if(Ne(n))if(e[n.id]){const s=e[n.id];for(const i of s)r.add(i),Ze(i,e,t,r);for(const i of s)dn(i,n.parent,r,e,t)}else{const s=Ws(n);for(const i of s.target)r.add(i),s===n.parent?.initial&&t.add(n.parent),Ze(i,e,t,r);for(const i of s.target)dn(i,n.parent,r,e,t)}else if(n.type==="compound"){const[s]=n.initial.target;Ne(s)||(r.add(s),t.add(s)),Ze(s,e,t,r),dn(s,n,r,e,t)}else if(n.type==="parallel")for(const s of rt(n).filter(i=>!Ne(i)))[...r].some(i=>Le(i,s))||(Ne(s)||(r.add(s),t.add(s)),Ze(s,e,t,r))}function Gs(n,e,t,r,s){for(const i of r)if((!s||Le(i,s))&&n.add(i),i.type==="parallel")for(const o of rt(i).filter(a=>!Ne(a)))[...n].some(a=>Le(a,o))||(n.add(o),Ze(o,e,t,n))}function dn(n,e,t,r,s){Gs(t,r,s,Ct(n,e))}function za(n,e,t,r,s,i,o){let a=n;const c=Tn(r,s,i);c.sort((l,f)=>f.order-l.order);let u;for(const l of c)for(const f of Da(l)){let g;f.history==="deep"?g=h=>ar(h)&&Le(h,l):g=h=>h.parent===l,u??={...i},u[f.id]=Array.from(s).filter(g)}for(const l of c)a=it(a,e,t,[...l.exit,...l.invoke.map(f=>zs(f.id))],o),s.delete(l);return[a,u||i]}let Pr=!1;function Ys(n,e,t,r,s,i){const{machine:o}=n;let a=n;for(const c of r){let h=function(){t.system._sendInspectionEvent({type:"@xstate.action",actorRef:t.self,action:{type:typeof c=="string"?c:typeof c=="object"?c.type:c.name||"(anonymous)",params:g}});try{Pr=l,l(f,g)}finally{Pr=!1}};const u=typeof c=="function",l=u?c:o.implementations.actions[typeof c=="string"?c:c.type];if(!l)continue;const f={context:a.context,event:e,self:t.self,system:t.system},g=u||typeof c=="string"?void 0:"params"in c?typeof c.params=="function"?c.params({context:a.context,event:e}):c.params:void 0;if(!("resolve"in l)){t.self._processingStatus===oe.Running?h():t.defer(()=>{h()});continue}const y=l,[v,S,T]=y.resolve(t,a,f,g,l,s);a=v,"retryResolve"in y&&i?.push([y,S]),"execute"in y&&(t.self._processingStatus===oe.Running?y.execute(t,S):t.defer(y.execute.bind(null,t,S))),T&&(a=Ys(a,e,t,T,s,i))}return a}function it(n,e,t,r,s,i){const o=i?[]:void 0,a=Ys(n,e,t,r,{internalQueue:s,deferredActorIds:i},o);return o?.forEach(([c,u])=>{c.retryResolve(t,a,u)}),a}function hn(n,e,t,r=[]){let s=n;const i=[];function o(u,l,f){t.system._sendInspectionEvent({type:"@xstate.microstep",actorRef:t.self,event:l,snapshot:u,_transitions:f}),i.push(u)}if(e.type===Cn)return s=We($r(s,e,t),{status:"stopped"}),o(s,e,[]),{snapshot:s,microstates:i};let a=e;if(a.type!==Us){const u=a,l=ha(u),f=Lr(u,s);if(l&&!f.length)return s=We(n,{status:"error",error:u.error}),o(s,u,[]),{snapshot:s,microstates:i};s=jn(f,n,t,a,!1,r),o(s,u,f)}let c=!0;for(;s.status==="active";){let u=c?Ha(s,a):[];const l=u.length?s:void 0;if(!u.length){if(!r.length)break;a=r.shift(),u=Lr(a,s)}s=jn(u,s,t,a,!1,r),c=s!==l,o(s,a,u)}return s.status!=="active"&&$r(s,a,t),{snapshot:s,microstates:i}}function $r(n,e,t){return it(n,e,t,Object.values(n.children).map(r=>zs(r)),[])}function Lr(n,e){return e.machine.getTransitionData(e,n)}function Ha(n,e){const t=new Set,r=n._nodes.filter(ar);for(const s of r)e:for(const i of[s].concat(Ct(s,void 0)))if(i.always){for(const o of i.always)if(o.guard===void 0||or(o.guard,n.context,e,n)){t.add(o);break e}}return Ks(Array.from(t),new Set(n._nodes),n.historyValue)}function Na(n,e){const t=Kt(Gt(n,e));return Vs(n,[...t])}function Va(n){return!!n&&typeof n=="object"&&"machine"in n&&"value"in n}const Wa=function(e){return $s(e,this.value)},Ja=function(e){return this.tags.has(e)},Ka=function(e){const t=this.machine.getTransitionData(this,e);return!!t?.length&&t.some(r=>r.target!==void 0||r.actions.length)},qa=function(){const{_nodes:e,tags:t,machine:r,getMeta:s,toJSON:i,can:o,hasTag:a,matches:c,...u}=this;return{...u,tags:Array.from(t)}},Ga=function(){return this._nodes.reduce((e,t)=>(t.meta!==void 0&&(e[t.id]=t.meta),e),{})};function $t(n,e){return{status:n.status,output:n.output,error:n.error,machine:e,context:n.context,_nodes:n._nodes,value:Vs(e.root,n._nodes),tags:new Set(n._nodes.flatMap(t=>t.tags)),children:n.children,historyValue:n.historyValue||{},matches:Wa,hasTag:Ja,can:Ka,getMeta:Ga,toJSON:qa}}function We(n,e={}){return $t({...n,...e},n.machine)}function Ya(n,e){const{_nodes:t,tags:r,machine:s,children:i,context:o,can:a,hasTag:c,matches:u,getMeta:l,toJSON:f,...g}=n,h={};for(const v in i){const S=i[v];h[v]={snapshot:S.getPersistedSnapshot(e),src:S.src,systemId:S._systemId,syncSnapshot:S._syncSnapshot}}return{...g,context:Xs(o),children:h}}function Xs(n){let e;for(const t in n){const r=n[t];if(r&&typeof r=="object")if("sessionId"in r&&"send"in r&&"ref"in r)e??=Array.isArray(n)?n.slice():{...n},e[t]={xstate$$type:ir,id:r.id};else{const s=Xs(r);s!==r&&(e??=Array.isArray(n)?n.slice():{...n},e[t]=s)}}return e??n}function Xa(n,e,t,r,{event:s,id:i,delay:o},{internalQueue:a}){const c=e.machine.implementations.delays;if(typeof s=="string")throw new Error(`Only event objects may be used with raise; use raise({ type: "${s}" }) instead`);const u=typeof s=="function"?s(t,r):s;let l;if(typeof o=="string"){const f=c&&c[o];l=typeof f=="function"?f(t,r):f}else l=typeof o=="function"?o(t,r):o;return typeof l!="number"&&a.push(u),[e,{event:u,id:i,delay:l}]}function Za(n,e){const{event:t,delay:r,id:s}=e;if(typeof r=="number"){n.defer(()=>{const i=n.self;n.system.scheduler.schedule(i,i,t,r,s)});return}}function Qa(n,e){function t(r,s){}return t.type="xstate.raise",t.event=n,t.id=e?.id,t.delay=e?.delay,t.resolve=Xa,t.execute=Za,t}function ec(n,{machine:e,context:t},r,s){const i=(o,a={})=>{const{systemId:c,input:u}=a;if(typeof o=="string"){const l=sr(e,o);if(!l)throw new Error(`Actor logic '${o}' not implemented in machine '${e.id}'`);const f=vt(l,{id:a.id,parent:n.self,syncSnapshot:a.syncSnapshot,input:typeof u=="function"?u({context:t,event:r,self:n.self}):u,src:o,systemId:c});return s[f.id]=f,f}else return vt(o,{id:a.id,parent:n.self,syncSnapshot:a.syncSnapshot,input:a.input,src:o,systemId:c})};return(o,a)=>{const c=i(o,a);return s[c.id]=c,n.defer(()=>{c._processingStatus!==oe.Stopped&&c.start()}),c}}function tc(n,e,t,r,{assignment:s}){if(!e.context)throw new Error("Cannot assign to undefined `context`. Ensure that `context` is defined in the machine config.");const i={},o={context:e.context,event:t.event,spawn:ec(n,e,t.event,i),self:n.self,system:n.system};let a={};if(typeof s=="function")a=s(o,r);else for(const u of Object.keys(s)){const l=s[u];a[u]=typeof l=="function"?l(o,r):l}const c=Object.assign({},e.context,a);return[We(e,{context:c,children:Object.keys(i).length?{...e.children,...i}:e.children})]}function Lt(n){function e(t,r){}return e.type="xstate.assign",e.assignment=n,e.resolve=tc,e}function nc(n,e){const t=Oe(e);if(!t.includes(n.type)){const r=t.length===1?`type "${t[0]}"`:`one of types "${t.join('", "')}"`;throw new Error(`Expected event ${JSON.stringify(n)} to have ${r}`)}}const Br=new WeakMap;function Ke(n,e,t){let r=Br.get(n);return r?e in r||(r[e]=t()):(r={[e]:t()},Br.set(n,r)),r[e]}const rc={},ut=n=>typeof n=="string"?{type:n}:typeof n=="function"?"resolve"in n?{type:n.type}:{type:n.name}:n;class lr{constructor(e,t){if(this.config=e,this.key=void 0,this.id=void 0,this.type=void 0,this.path=void 0,this.states=void 0,this.history=void 0,this.entry=void 0,this.exit=void 0,this.parent=void 0,this.machine=void 0,this.meta=void 0,this.output=void 0,this.order=-1,this.description=void 0,this.tags=[],this.transitions=void 0,this.always=void 0,this.parent=t._parent,this.key=t._key,this.machine=t._machine,this.path=this.parent?this.parent.path.concat(this.key):[],this.id=this.config.id||[this.machine.id,...this.path].join(Ms),this.type=this.config.type||(this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.description=this.config.description,this.order=this.machine.idMap.size,this.machine.idMap.set(this.id,this),this.states=this.config.states?jr(this.config.states,(r,s)=>new lr(r,{_parent:this,_key:s,_machine:this.machine})):rc,this.type==="compound"&&!this.config.initial)throw new Error(`No initial state specified for compound state node "#${this.id}". Try adding { initial: "${Object.keys(this.states)[0]}" } to the state config.`);this.history=this.config.history===!0?"shallow":this.config.history||!1,this.entry=Oe(this.config.entry).slice(),this.exit=Oe(this.config.exit).slice(),this.meta=this.config.meta,this.output=this.type==="final"||!this.parent?this.config.output:void 0,this.tags=Oe(e.tags).slice()}_initialize(){this.transitions=Ia(this),this.config.always&&(this.always=Ye(this.config.always).map(e=>He(this,Ds,e))),Object.keys(this.states).forEach(e=>{this.states[e]._initialize()})}get definition(){return{id:this.id,key:this.key,version:this.machine.version,type:this.type,initial:this.initial?{target:this.initial.target,source:this,actions:this.initial.actions.map(ut),eventType:null,reenter:!1,toJSON:()=>({target:this.initial.target.map(e=>`#${e.id}`),source:`#${this.id}`,actions:this.initial.actions.map(ut),eventType:null})}:void 0,history:this.history,states:jr(this.states,e=>e.definition),on:this.on,transitions:[...this.transitions.values()].flat().map(e=>({...e,actions:e.actions.map(ut)})),entry:this.entry.map(ut),exit:this.exit.map(ut),meta:this.meta,order:this.order||-1,output:this.output,invoke:this.invoke,description:this.description,tags:this.tags}}toJSON(){return this.definition}get invoke(){return Ke(this,"invoke",()=>Oe(this.config.invoke).map((e,t)=>{const{src:r,systemId:s}=e,i=e.id??Mr(this.id,t),o=typeof r=="string"?r:`xstate.invoke.${Mr(this.id,t)}`;return{...e,src:o,id:i,systemId:s,toJSON(){const{onDone:a,onError:c,...u}=e;return{...u,type:"xstate.invoke",src:o,id:i}}}}))}get on(){return Ke(this,"on",()=>[...this.transitions].flatMap(([t,r])=>r.map(s=>[t,s])).reduce((t,[r,s])=>(t[r]=t[r]||[],t[r].push(s),t),{}))}get after(){return Ke(this,"delayedTransitions",()=>Ca(this))}get initial(){return Ke(this,"initial",()=>Ra(this,this.config.initial))}next(e,t){const r=t.type,s=[];let i;const o=Ke(this,`candidates-${r}`,()=>Aa(this,r));for(const a of o){const{guard:c}=a,u=e.context;let l=!1;try{l=!c||or(c,u,t,e)}catch(f){const g=typeof c=="string"?c:typeof c=="object"?c.type:void 0;throw new Error(`Unable to evaluate guard ${g?`'${g}' `:""}in transition for event '${r}' in state node '${this.id}':
${f.message}`)}if(l){s.push(...a.actions),i=a;break}}return i?[i]:void 0}get events(){return Ke(this,"events",()=>{const{states:e}=this,t=new Set(this.ownEvents);if(e)for(const r of Object.keys(e)){const s=e[r];if(s.states)for(const i of s.events)t.add(`${i}`)}return Array.from(t)})}get ownEvents(){const e=new Set([...this.transitions.keys()].filter(t=>this.transitions.get(t).some(r=>!(!r.target&&!r.actions.length&&!r.reenter))));return Array.from(e)}}const sc="#";class dr{constructor(e,t){this.config=e,this.version=void 0,this.schemas=void 0,this.implementations=void 0,this.__xstatenode=!0,this.idMap=new Map,this.root=void 0,this.id=void 0,this.states=void 0,this.events=void 0,this.id=e.id||"(machine)",this.implementations={actors:t?.actors??{},actions:t?.actions??{},delays:t?.delays??{},guards:t?.guards??{}},this.version=this.config.version,this.schemas=this.config.schemas,this.transition=this.transition.bind(this),this.getInitialSnapshot=this.getInitialSnapshot.bind(this),this.getPersistedSnapshot=this.getPersistedSnapshot.bind(this),this.restoreSnapshot=this.restoreSnapshot.bind(this),this.start=this.start.bind(this),this.root=new lr(e,{_key:this.id,_machine:this}),this.root._initialize(),this.states=this.root.states,this.events=this.root.events}provide(e){const{actions:t,guards:r,actors:s,delays:i}=this.implementations;return new dr(this.config,{actions:{...t,...e.actions},guards:{...r,...e.guards},actors:{...s,...e.actors},delays:{...i,...e.delays}})}resolveState(e){const t=Na(this.root,e.value),r=Kt(Gt(this.root,t));return $t({_nodes:[...r],context:e.context||{},children:{},status:cr(r,this.root)?"done":e.status||"active",output:e.output,error:e.error,historyValue:e.historyValue},this)}transition(e,t,r){return hn(e,t,r).snapshot}microstep(e,t,r){return hn(e,t,r).microstates}getTransitionData(e,t){return fr(this.root,e.value,e,t)||[]}getPreInitialState(e,t,r){const{context:s}=this.config,i=$t({context:typeof s!="function"&&s?s:{},_nodes:[this.root],children:{},status:"active"},this);return typeof s=="function"?it(i,t,e,[Lt(({spawn:a,event:c,self:u})=>s({spawn:a,input:c.input,self:u}))],r):i}getInitialSnapshot(e,t){const r=Ps(t),s=[],i=this.getPreInitialState(e,r,s),o=jn([{target:[...Js(this.root)],source:this.root,reenter:!0,actions:[],eventType:null,toJSON:null}],i,e,r,!0,s),{snapshot:a}=hn(o,r,e,s);return a}start(e){Object.values(e.children).forEach(t=>{t.getSnapshot().status==="active"&&t.start()})}getStateNodeById(e){const t=rr(e),r=t.slice(1),s=on(t[0])?t[0].slice(sc.length):t[0],i=this.idMap.get(s);if(!i)throw new Error(`Child state node '#${s}' does not exist on machine '${this.id}'`);return qt(i,r)}get definition(){return this.root.definition}toJSON(){return this.definition}getPersistedSnapshot(e,t){return Ya(e,t)}restoreSnapshot(e,t){const r={},s=e.children;Object.keys(s).forEach(c=>{const u=s[c],l=u.snapshot,f=u.src,g=typeof f=="string"?sr(this,f):f;if(!g)return;const h=vt(g,{id:c,parent:t.self,syncSnapshot:u.syncSnapshot,snapshot:l,src:f,systemId:u.systemId});r[c]=h});const i=$t({...e,children:r,_nodes:Array.from(Kt(Gt(this.root,e.value)))},this);let o=new Set;function a(c,u){if(!o.has(c)){o.add(c);for(let l in c){const f=c[l];if(f&&typeof f=="object"){if("xstate$$type"in f&&f.xstate$$type===ir){c[l]=u[f.id];continue}a(f,u)}}}}return a(i.context,r),i}}function ic(n,e){return new dr(n,e)}function oc({schemas:n,actors:e,actions:t,guards:r,delays:s}){return{createMachine:i=>ic({...i,schemas:n},{actors:e,actions:t,guards:r,delays:s})}}const ac={timeout:1/0};function cc(n,e,t){const r={...ac,...t};return new Promise((s,i)=>{const{signal:o}=r;if(o?.aborted){i(o.reason);return}let a=!1;const c=r.timeout===1/0?void 0:setTimeout(()=>{u(),i(new Error(`Timeout of ${r.timeout} ms exceeded`))},r.timeout),u=()=>{clearTimeout(c),a=!0,g?.unsubscribe(),f&&o.removeEventListener("abort",f)};function l(h){e(h)&&(u(),s(h))}let f,g;l(n.getSnapshot()),!a&&(o&&(f=()=>{u(),i(o.reason)},o.addEventListener("abort",f)),g=n.subscribe({next:l,error:h=>{u(),i(h)},complete:()=>{u(),i(new Error("Actor terminated without satisfying predicate"))}}),a&&g.unsubscribe())})}var ot={},an={},ce={};Object.defineProperty(ce,"__esModule",{value:!0});ce.output=ce.exists=ce.hash=ce.bytes=ce.bool=ce.number=void 0;function Yt(n){if(!Number.isSafeInteger(n)||n<0)throw new Error(`Wrong positive integer: ${n}`)}ce.number=Yt;function Zs(n){if(typeof n!="boolean")throw new Error(`Expected boolean, not ${n}`)}ce.bool=Zs;function hr(n,...e){if(!(n instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(n.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${n.length}`)}ce.bytes=hr;function Qs(n){if(typeof n!="function"||typeof n.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Yt(n.outputLen),Yt(n.blockLen)}ce.hash=Qs;function ei(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}ce.exists=ei;function ti(n,e){hr(n);const t=e.outputLen;if(n.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}ce.output=ti;const fc={number:Yt,bool:Zs,bytes:hr,hash:Qs,exists:ei,output:ti};ce.default=fc;var gr={},cn={};Object.defineProperty(cn,"__esModule",{value:!0});cn.crypto=void 0;cn.crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;(function(n){/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(n,"__esModule",{value:!0}),n.randomBytes=n.wrapXOFConstructorWithOpts=n.wrapConstructorWithOpts=n.wrapConstructor=n.checkOpts=n.Hash=n.concatBytes=n.toBytes=n.utf8ToBytes=n.asyncLoop=n.nextTick=n.hexToBytes=n.bytesToHex=n.isLE=n.rotr=n.createView=n.u32=n.u8=void 0;const e=cn,t=E=>E instanceof Uint8Array,r=E=>new Uint8Array(E.buffer,E.byteOffset,E.byteLength);n.u8=r;const s=E=>new Uint32Array(E.buffer,E.byteOffset,Math.floor(E.byteLength/4));n.u32=s;const i=E=>new DataView(E.buffer,E.byteOffset,E.byteLength);n.createView=i;const o=(E,U)=>E<<32-U|E>>>U;if(n.rotr=o,n.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68,!n.isLE)throw new Error("Non little-endian hardware is not supported");const a=Array.from({length:256},(E,U)=>U.toString(16).padStart(2,"0"));function c(E){if(!t(E))throw new Error("Uint8Array expected");let U="";for(let P=0;P<E.length;P++)U+=a[E[P]];return U}n.bytesToHex=c;function u(E){if(typeof E!="string")throw new Error("hex string expected, got "+typeof E);const U=E.length;if(U%2)throw new Error("padded hex string expected, got unpadded hex of length "+U);const P=new Uint8Array(U/2);for(let L=0;L<P.length;L++){const W=L*2,fe=E.slice(W,W+2),ge=Number.parseInt(fe,16);if(Number.isNaN(ge)||ge<0)throw new Error("Invalid byte sequence");P[L]=ge}return P}n.hexToBytes=u;const l=async()=>{};n.nextTick=l;async function f(E,U,P){let L=Date.now();for(let W=0;W<E;W++){P(W);const fe=Date.now()-L;fe>=0&&fe<U||(await(0,n.nextTick)(),L+=fe)}}n.asyncLoop=f;function g(E){if(typeof E!="string")throw new Error(`utf8ToBytes expected string, got ${typeof E}`);return new Uint8Array(new TextEncoder().encode(E))}n.utf8ToBytes=g;function h(E){if(typeof E=="string"&&(E=g(E)),!t(E))throw new Error(`expected Uint8Array, got ${typeof E}`);return E}n.toBytes=h;function y(...E){const U=new Uint8Array(E.reduce((L,W)=>L+W.length,0));let P=0;return E.forEach(L=>{if(!t(L))throw new Error("Uint8Array expected");U.set(L,P),P+=L.length}),U}n.concatBytes=y;class v{clone(){return this._cloneInto()}}n.Hash=v;const S={}.toString;function T(E,U){if(U!==void 0&&S.call(U)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign(E,U)}n.checkOpts=T;function j(E){const U=L=>E().update(h(L)).digest(),P=E();return U.outputLen=P.outputLen,U.blockLen=P.blockLen,U.create=()=>E(),U}n.wrapConstructor=j;function A(E){const U=(L,W)=>E(W).update(h(L)).digest(),P=E({});return U.outputLen=P.outputLen,U.blockLen=P.blockLen,U.create=L=>E(L),U}n.wrapConstructorWithOpts=A;function N(E){const U=(L,W)=>E(W).update(h(L)).digest(),P=E({});return U.outputLen=P.outputLen,U.blockLen=P.blockLen,U.create=L=>E(L),U}n.wrapXOFConstructorWithOpts=N;function z(E=32){if(e.crypto&&typeof e.crypto.getRandomValues=="function")return e.crypto.getRandomValues(new Uint8Array(E));throw new Error("crypto.getRandomValues must be defined")}n.randomBytes=z})(gr);Object.defineProperty(an,"__esModule",{value:!0});an.SHA2=void 0;const gn=ce,lt=gr;function uc(n,e,t,r){if(typeof n.setBigUint64=="function")return n.setBigUint64(e,t,r);const s=BigInt(32),i=BigInt(4294967295),o=Number(t>>s&i),a=Number(t&i),c=r?4:0,u=r?0:4;n.setUint32(e+c,o,r),n.setUint32(e+u,a,r)}class lc extends lt.Hash{constructor(e,t,r,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=(0,lt.createView)(this.buffer)}update(e){(0,gn.exists)(this);const{view:t,buffer:r,blockLen:s}=this;e=(0,lt.toBytes)(e);const i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=(0,lt.createView)(e);for(;s<=i-o;o+=s)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){(0,gn.exists)(this),(0,gn.output)(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:s,isLE:i}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(r,0),o=0);for(let f=o;f<s;f++)t[f]=0;uc(r,s-8,BigInt(this.length*8),i),this.process(r,0);const a=(0,lt.createView)(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<u;f++)a.setUint32(4*f,l[f],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:s,finished:i,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=i,e.destroyed=o,s%t&&e.buffer.set(r),e}}an.SHA2=lc;Object.defineProperty(ot,"__esModule",{value:!0});ot.sha224=ot.sha256=void 0;const dc=an,_e=gr,hc=(n,e,t)=>n&e^~n&t,gc=(n,e,t)=>n&e^n&t^e&t,_c=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),De=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ue=new Uint32Array(64);class ni extends dc.SHA2{constructor(){super(64,32,8,!1),this.A=De[0]|0,this.B=De[1]|0,this.C=De[2]|0,this.D=De[3]|0,this.E=De[4]|0,this.F=De[5]|0,this.G=De[6]|0,this.H=De[7]|0}get(){const{A:e,B:t,C:r,D:s,E:i,F:o,G:a,H:c}=this;return[e,t,r,s,i,o,a,c]}set(e,t,r,s,i,o,a,c){this.A=e|0,this.B=t|0,this.C=r|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let f=0;f<16;f++,t+=4)Ue[f]=e.getUint32(t,!1);for(let f=16;f<64;f++){const g=Ue[f-15],h=Ue[f-2],y=(0,_e.rotr)(g,7)^(0,_e.rotr)(g,18)^g>>>3,v=(0,_e.rotr)(h,17)^(0,_e.rotr)(h,19)^h>>>10;Ue[f]=v+Ue[f-7]+y+Ue[f-16]|0}let{A:r,B:s,C:i,D:o,E:a,F:c,G:u,H:l}=this;for(let f=0;f<64;f++){const g=(0,_e.rotr)(a,6)^(0,_e.rotr)(a,11)^(0,_e.rotr)(a,25),h=l+g+hc(a,c,u)+_c[f]+Ue[f]|0,v=((0,_e.rotr)(r,2)^(0,_e.rotr)(r,13)^(0,_e.rotr)(r,22))+gc(r,s,i)|0;l=u,u=c,c=a,a=o+h|0,o=i,i=s,s=r,r=h+v|0}r=r+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(r,s,i,o,a,c,u,l)}roundClean(){Ue.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class pc extends ni{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}ot.sha256=(0,_e.wrapConstructor)(()=>new ni);ot.sha224=(0,_e.wrapConstructor)(()=>new pc);function yc(n){if(n.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),t=0;t<e.length;t++)e[t]=255;for(var r=0;r<n.length;r++){var s=n.charAt(r),i=s.charCodeAt(0);if(e[i]!==255)throw new TypeError(s+" is ambiguous");e[i]=r}var o=n.length,a=n.charAt(0),c=Math.log(o)/Math.log(256),u=Math.log(256)/Math.log(o);function l(h){if(h instanceof Uint8Array||(ArrayBuffer.isView(h)?h=new Uint8Array(h.buffer,h.byteOffset,h.byteLength):Array.isArray(h)&&(h=Uint8Array.from(h))),!(h instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(h.length===0)return"";for(var y=0,v=0,S=0,T=h.length;S!==T&&h[S]===0;)S++,y++;for(var j=(T-S)*u+1>>>0,A=new Uint8Array(j);S!==T;){for(var N=h[S],z=0,E=j-1;(N!==0||z<v)&&E!==-1;E--,z++)N+=256*A[E]>>>0,A[E]=N%o>>>0,N=N/o>>>0;if(N!==0)throw new Error("Non-zero carry");v=z,S++}for(var U=j-v;U!==j&&A[U]===0;)U++;for(var P=a.repeat(y);U<j;++U)P+=n.charAt(A[U]);return P}function f(h){if(typeof h!="string")throw new TypeError("Expected String");if(h.length===0)return new Uint8Array;for(var y=0,v=0,S=0;h[y]===a;)v++,y++;for(var T=(h.length-y)*c+1>>>0,j=new Uint8Array(T);h[y];){var A=e[h.charCodeAt(y)];if(A===255)return;for(var N=0,z=T-1;(A!==0||N<S)&&z!==-1;z--,N++)A+=o*j[z]>>>0,j[z]=A%256>>>0,A=A/256>>>0;if(A!==0)throw new Error("Non-zero carry");S=N,y++}for(var E=T-S;E!==T&&j[E]===0;)E++;for(var U=new Uint8Array(v+(T-E)),P=v;E!==T;)U[P++]=j[E++];return U}function g(h){var y=f(h);if(y)return y;throw new Error("Non-base"+o+" character")}return{encode:l,decodeUnsafe:f,decode:g}}var bc=yc;const wc=bc,mc="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";var vc=wc(mc),_n=vc,xc=function(n){function e(i){var o=Uint8Array.from(i),a=n(o),c=o.length+4,u=new Uint8Array(c);return u.set(o,0),u.set(a.subarray(0,4),o.length),_n.encode(u,c)}function t(i){var o=i.slice(0,-4),a=i.slice(-4),c=n(o);if(!(a[0]^c[0]|a[1]^c[1]|a[2]^c[2]|a[3]^c[3]))return o}function r(i){var o=_n.decodeUnsafe(i);if(o)return t(o)}function s(i){var o=_n.decode(i),a=t(o);if(!a)throw new Error("Invalid checksum");return a}return{encode:e,decode:s,decodeUnsafe:r}},{sha256:Fr}=ot,Sc=xc;function kc(n){return Fr(Fr(n))}var Ec=Sc(kc);const ri=nr(Ec),_r="automerge:",fn=n=>{const e=new RegExp(`^${_r}(\\w+)$`),[,t]=n.match(e)||[],r=t,s=ii(r);if(!s)throw new Error("Invalid document URL: "+n);return{binaryDocumentId:s,documentId:r}},pr=n=>{const e=n instanceof Uint8Array||typeof n=="string"?n:"documentId"in n?n.documentId:void 0,t=e instanceof Uint8Array?Mn(e):typeof e=="string"?e:void 0;if(t===void 0)throw new Error("Invalid documentId: "+e);return _r+t},Bt=n=>{if(typeof n!="string"||!n||!n.startsWith(_r))return!1;const e=n;try{const{documentId:t}=fn(e);return si(t)}catch{return!1}},si=n=>{if(typeof n!="string")return!1;const e=ii(n);if(e===void 0)return!1;const t=Ri(e);return Qt(t)},Ac=n=>typeof n=="string"&&Qt(n),Cc=()=>{const n=ns(null,new Uint8Array(16));return pr({documentId:n})},ii=n=>ri.decodeUnsafe(n),Mn=n=>ri.encode(n),pn=n=>{if(n instanceof Uint8Array)return Mn(n);if(Bt(n))return fn(n).documentId;if(si(n))return n;if(Ac(n)){console.warn("Future versions will not support UUIDs as document IDs; use Automerge URLs instead.");const e=Oi(n);return Mn(e)}throw new Error(`Invalid AutomergeUrl: '${n}'`)};let Dn;try{Dn=new TextDecoder}catch{}let D,Ve,x=0;const Ic=105,Rc=57342,Oc=57343,zr=57337,Hr=6,qe={};let K={},X,Xt,Zt=0,xt=0,ee,ve,Z=[],Un=[],ue,ae,_t,Nr={useRecords:!1,mapsAsObjects:!0},St=!1,oi=2;try{new Function("")}catch{oi=1/0}class kt{constructor(e){if(e&&((e.keyMap||e._keyMap)&&!e.useRecords&&(e.useRecords=!1,e.mapsAsObjects=!0),e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.getStructures&&(e.getShared=e.getStructures),e.getShared&&!e.structures&&((e.structures=[]).uninitialized=!0),e.keyMap)){this.mapKey=new Map;for(let[t,r]of Object.entries(e.keyMap))this.mapKey.set(r,t)}Object.assign(this,e)}decodeKey(e){return this.keyMap&&this.mapKey.get(e)||e}encodeKey(e){return this.keyMap&&this.keyMap.hasOwnProperty(e)?this.keyMap[e]:e}encodeKeys(e){if(!this._keyMap)return e;let t=new Map;for(let[r,s]of Object.entries(e))t.set(this._keyMap.hasOwnProperty(r)?this._keyMap[r]:r,s);return t}decodeKeys(e){if(!this._keyMap||e.constructor.name!="Map")return e;if(!this._mapKey){this._mapKey=new Map;for(let[r,s]of Object.entries(this._keyMap))this._mapKey.set(s,r)}let t={};return e.forEach((r,s)=>t[ye(this._mapKey.has(s)?this._mapKey.get(s):s)]=r),t}mapDecode(e,t){let r=this.decode(e);if(this._keyMap)switch(r.constructor.name){case"Array":return r.map(s=>this.decodeKeys(s))}return r}decode(e,t){if(D)return ui(()=>(Bn(),this?this.decode(e,t):kt.prototype.decode.call(Nr,e,t)));Ve=t>-1?t:e.length,x=0,xt=0,Xt=null,ee=null,D=e;try{ae=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(r){throw D=null,e instanceof Uint8Array?r:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof kt){if(K=this,ue=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return X=this.structures,Ot();(!X||X.length>0)&&(X=[])}else K=Nr,(!X||X.length>0)&&(X=[]),ue=null;return Ot()}decodeMultiple(e,t){let r,s=0;try{let i=e.length;St=!0;let o=this?this.decode(e,i):wr.decode(e,i);if(t){if(t(o)===!1)return;for(;x<i;)if(s=x,t(Ot())===!1)return}else{for(r=[o];x<i;)s=x,r.push(Ot());return r}}catch(i){throw i.lastPosition=s,i.values=r,i}finally{St=!1,Bn()}}}function Ot(){try{let n=J();if(ee){if(x>=ee.postBundlePosition){let e=new Error("Unexpected bundle position");throw e.incomplete=!0,e}x=ee.postBundlePosition,ee=null}if(x==Ve)X=null,D=null,ve&&(ve=null);else if(x>Ve){let e=new Error("Unexpected end of CBOR data");throw e.incomplete=!0,e}else if(!St)throw new Error("Data read, but end of buffer not reached");return n}catch(n){throw Bn(),(n instanceof RangeError||n.message.startsWith("Unexpected end of buffer"))&&(n.incomplete=!0),n}}function J(){let n=D[x++],e=n>>5;if(n=n&31,n>23)switch(n){case 24:n=D[x++];break;case 25:if(e==7)return Dc();n=ae.getUint16(x),x+=2;break;case 26:if(e==7){let t=ae.getFloat32(x);if(K.useFloat32>2){let r=br[(D[x]&127)<<1|D[x+1]>>7];return x+=4,(r*t+(t>0?.5:-.5)>>0)/r}return x+=4,t}n=ae.getUint32(x),x+=4;break;case 27:if(e==7){let t=ae.getFloat64(x);return x+=8,t}if(e>1){if(ae.getUint32(x)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");n=ae.getUint32(x+4)}else K.int64AsNumber?(n=ae.getUint32(x)*4294967296,n+=ae.getUint32(x+4)):n=ae.getBigUint64(x);x+=8;break;case 31:switch(e){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let t=[],r,s=0;for(;(r=J())!=qe;)t[s++]=r;return e==4?t:e==3?t.join(""):Buffer.concat(t);case 5:let i;if(K.mapsAsObjects){let o={};if(K.keyMap)for(;(i=J())!=qe;)o[ye(K.decodeKey(i))]=J();else for(;(i=J())!=qe;)o[ye(i)]=J();return o}else{_t&&(K.mapsAsObjects=!0,_t=!1);let o=new Map;if(K.keyMap)for(;(i=J())!=qe;)o.set(K.decodeKey(i),J());else for(;(i=J())!=qe;)o.set(i,J());return o}case 7:return qe;default:throw new Error("Invalid major type for indefinite length "+e)}default:throw new Error("Unknown token "+n)}switch(e){case 0:return n;case 1:return~n;case 2:return Mc(n);case 3:if(xt>=x)return Xt.slice(x-Zt,(x+=n)-Zt);if(xt==0&&Ve<140&&n<32){let s=n<16?ai(n):jc(n);if(s!=null)return s}return Tc(n);case 4:let t=new Array(n);for(let s=0;s<n;s++)t[s]=J();return t;case 5:if(K.mapsAsObjects){let s={};if(K.keyMap)for(let i=0;i<n;i++)s[ye(K.decodeKey(J()))]=J();else for(let i=0;i<n;i++)s[ye(J())]=J();return s}else{_t&&(K.mapsAsObjects=!0,_t=!1);let s=new Map;if(K.keyMap)for(let i=0;i<n;i++)s.set(K.decodeKey(J()),J());else for(let i=0;i<n;i++)s.set(J(),J());return s}case 6:if(n>=zr){let s=X[n&8191];if(s)return s.read||(s.read=Pn(s)),s.read();if(n<65536){if(n==Oc){let i=Qe(),o=J(),a=J();Ln(o,a);let c={};if(K.keyMap)for(let u=2;u<i;u++){let l=K.decodeKey(a[u-2]);c[ye(l)]=J()}else for(let u=2;u<i;u++){let l=a[u-2];c[ye(l)]=J()}return c}else if(n==Rc){let i=Qe(),o=J();for(let a=2;a<i;a++)Ln(o++,J());return J()}else if(n==zr)return Fc();if(K.getShared&&(yr(),s=X[n&8191],s))return s.read||(s.read=Pn(s)),s.read()}}let r=Z[n];if(r)return r.handlesRead?r(J):r(J());{let s=J();for(let i=0;i<Un.length;i++){let o=Un[i](n,s);if(o!==void 0)return o}return new Je(s,n)}case 7:switch(n){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 31:default:let s=(ue||Fe())[n];if(s!==void 0)return s;throw new Error("Unknown token "+n)}default:if(isNaN(n)){let s=new Error("Unexpected end of CBOR data");throw s.incomplete=!0,s}throw new Error("Unknown CBOR token "+n)}}const Vr=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function Pn(n){function e(){let t=D[x++];if(t=t&31,t>23)switch(t){case 24:t=D[x++];break;case 25:t=ae.getUint16(x),x+=2;break;case 26:t=ae.getUint32(x),x+=4;break;default:throw new Error("Expected array header, but got "+D[x-1])}let r=this.compiledReader;for(;r;){if(r.propertyCount===t)return r(J);r=r.next}if(this.slowReads++>=oi){let i=this.length==t?this:this.slice(0,t);return r=K.keyMap?new Function("r","return {"+i.map(o=>K.decodeKey(o)).map(o=>Vr.test(o)?ye(o)+":r()":"["+JSON.stringify(o)+"]:r()").join(",")+"}"):new Function("r","return {"+i.map(o=>Vr.test(o)?ye(o)+":r()":"["+JSON.stringify(o)+"]:r()").join(",")+"}"),this.compiledReader&&(r.next=this.compiledReader),r.propertyCount=t,this.compiledReader=r,r(J)}let s={};if(K.keyMap)for(let i=0;i<t;i++)s[ye(K.decodeKey(this[i]))]=J();else for(let i=0;i<t;i++)s[ye(this[i])]=J();return s}return n.slowReads=0,e}function ye(n){return n==="__proto__"?"__proto_":n}let Tc=$n;function $n(n){let e;if(n<16&&(e=ai(n)))return e;if(n>64&&Dn)return Dn.decode(D.subarray(x,x+=n));const t=x+n,r=[];for(e="";x<t;){const s=D[x++];if(!(s&128))r.push(s);else if((s&224)===192){const i=D[x++]&63;r.push((s&31)<<6|i)}else if((s&240)===224){const i=D[x++]&63,o=D[x++]&63;r.push((s&31)<<12|i<<6|o)}else if((s&248)===240){const i=D[x++]&63,o=D[x++]&63,a=D[x++]&63;let c=(s&7)<<18|i<<12|o<<6|a;c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|c&1023),r.push(c)}else r.push(s);r.length>=4096&&(e+=te.apply(String,r),r.length=0)}return r.length>0&&(e+=te.apply(String,r)),e}let te=String.fromCharCode;function jc(n){let e=x,t=new Array(n);for(let r=0;r<n;r++){const s=D[x++];if((s&128)>0){x=e;return}t[r]=s}return te.apply(String,t)}function ai(n){if(n<4)if(n<2){if(n===0)return"";{let e=D[x++];if((e&128)>1){x-=1;return}return te(e)}}else{let e=D[x++],t=D[x++];if((e&128)>0||(t&128)>0){x-=2;return}if(n<3)return te(e,t);let r=D[x++];if((r&128)>0){x-=3;return}return te(e,t,r)}else{let e=D[x++],t=D[x++],r=D[x++],s=D[x++];if((e&128)>0||(t&128)>0||(r&128)>0||(s&128)>0){x-=4;return}if(n<6){if(n===4)return te(e,t,r,s);{let i=D[x++];if((i&128)>0){x-=5;return}return te(e,t,r,s,i)}}else if(n<8){let i=D[x++],o=D[x++];if((i&128)>0||(o&128)>0){x-=6;return}if(n<7)return te(e,t,r,s,i,o);let a=D[x++];if((a&128)>0){x-=7;return}return te(e,t,r,s,i,o,a)}else{let i=D[x++],o=D[x++],a=D[x++],c=D[x++];if((i&128)>0||(o&128)>0||(a&128)>0||(c&128)>0){x-=8;return}if(n<10){if(n===8)return te(e,t,r,s,i,o,a,c);{let u=D[x++];if((u&128)>0){x-=9;return}return te(e,t,r,s,i,o,a,c,u)}}else if(n<12){let u=D[x++],l=D[x++];if((u&128)>0||(l&128)>0){x-=10;return}if(n<11)return te(e,t,r,s,i,o,a,c,u,l);let f=D[x++];if((f&128)>0){x-=11;return}return te(e,t,r,s,i,o,a,c,u,l,f)}else{let u=D[x++],l=D[x++],f=D[x++],g=D[x++];if((u&128)>0||(l&128)>0||(f&128)>0||(g&128)>0){x-=12;return}if(n<14){if(n===12)return te(e,t,r,s,i,o,a,c,u,l,f,g);{let h=D[x++];if((h&128)>0){x-=13;return}return te(e,t,r,s,i,o,a,c,u,l,f,g,h)}}else{let h=D[x++],y=D[x++];if((h&128)>0||(y&128)>0){x-=14;return}if(n<15)return te(e,t,r,s,i,o,a,c,u,l,f,g,h,y);let v=D[x++];if((v&128)>0){x-=15;return}return te(e,t,r,s,i,o,a,c,u,l,f,g,h,y,v)}}}}}function Mc(n){return K.copyBuffers?Uint8Array.prototype.slice.call(D,x,x+=n):D.subarray(x,x+=n)}let ci=new Float32Array(1),Tt=new Uint8Array(ci.buffer,0,4);function Dc(){let n=D[x++],e=D[x++],t=(n&127)>>2;if(t===31)return e||n&3?NaN:n&128?-1/0:1/0;if(t===0){let r=((n&3)<<8|e)/16777216;return n&128?-r:r}return Tt[3]=n&128|(t>>1)+56,Tt[2]=(n&7)<<5|e>>3,Tt[1]=e<<5,Tt[0]=0,ci[0]}new Array(4096);class Je{constructor(e,t){this.value=e,this.tag=t}}Z[0]=n=>new Date(n);Z[1]=n=>new Date(Math.round(n*1e3));Z[2]=n=>{let e=BigInt(0);for(let t=0,r=n.byteLength;t<r;t++)e=BigInt(n[t])+e<<BigInt(8);return e};Z[3]=n=>BigInt(-1)-Z[2](n);Z[4]=n=>+(n[1]+"e"+n[0]);Z[5]=n=>n[1]*Math.exp(n[0]*Math.log(2));const Ln=(n,e)=>{n=n-57344;let t=X[n];t&&t.isShared&&((X.restoreStructures||(X.restoreStructures=[]))[n]=t),X[n]=e,e.read=Pn(e)};Z[Ic]=n=>{let e=n.length,t=n[1];Ln(n[0],t);let r={};for(let s=2;s<e;s++){let i=t[s-2];r[ye(i)]=n[s]}return r};Z[14]=n=>ee?ee[0].slice(ee.position0,ee.position0+=n):new Je(n,14);Z[15]=n=>ee?ee[1].slice(ee.position1,ee.position1+=n):new Je(n,15);let Uc={Error,RegExp};Z[27]=n=>(Uc[n[0]]||Error)(n[1],n[2]);const fi=n=>{if(D[x++]!=132)throw new Error("Packed values structure must be followed by a 4 element array");let e=n();return ue=ue?e.concat(ue.slice(e.length)):e,ue.prefixes=n(),ue.suffixes=n(),n()};fi.handlesRead=!0;Z[51]=fi;Z[Hr]=n=>{if(!ue)if(K.getShared)yr();else return new Je(n,Hr);if(typeof n=="number")return ue[16+(n>=0?2*n:-2*n-1)];throw new Error("No support for non-integer packed references yet")};Z[28]=n=>{ve||(ve=new Map,ve.id=0);let e=ve.id++,t=D[x],r;t>>5==4?r=[]:r={};let s={target:r};ve.set(e,s);let i=n();return s.used?Object.assign(r,i):(s.target=i,i)};Z[28].handlesRead=!0;Z[29]=n=>{let e=ve.get(n);return e.used=!0,e.target};Z[258]=n=>new Set(n);(Z[259]=n=>(K.mapsAsObjects&&(K.mapsAsObjects=!1,_t=!0),n())).handlesRead=!0;function Ge(n,e){return typeof n=="string"?n+e:n instanceof Array?n.concat(e):Object.assign({},n,e)}function Fe(){if(!ue)if(K.getShared)yr();else throw new Error("No packed values available");return ue}const Pc=1399353956;Un.push((n,e)=>{if(n>=225&&n<=255)return Ge(Fe().prefixes[n-224],e);if(n>=28704&&n<=32767)return Ge(Fe().prefixes[n-28672],e);if(n>=1879052288&&n<=2147483647)return Ge(Fe().prefixes[n-1879048192],e);if(n>=216&&n<=223)return Ge(e,Fe().suffixes[n-216]);if(n>=27647&&n<=28671)return Ge(e,Fe().suffixes[n-27639]);if(n>=1811940352&&n<=1879048191)return Ge(e,Fe().suffixes[n-1811939328]);if(n==Pc)return{packedValues:ue,structures:X.slice(0),version:e};if(n==55799)return e});const $c=new Uint8Array(new Uint16Array([1]).buffer)[0]==1,Wr=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array>"u"?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array>"u"?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],Lc=[64,68,69,70,71,72,77,78,79,85,86];for(let n=0;n<Wr.length;n++)Bc(Wr[n],Lc[n]);function Bc(n,e){let t="get"+n.name.slice(0,-5),r;typeof n=="function"?r=n.BYTES_PER_ELEMENT:n=null;for(let s=0;s<2;s++){if(!s&&r==1)continue;let i=r==2?1:r==4?2:3;Z[s?e:e-4]=r==1||s==$c?o=>{if(!n)throw new Error("Could not find typed array for code "+e);return new n(Uint8Array.prototype.slice.call(o,0).buffer)}:o=>{if(!n)throw new Error("Could not find typed array for code "+e);let a=new DataView(o.buffer,o.byteOffset,o.byteLength),c=o.length>>i,u=new n(c),l=a[t];for(let f=0;f<c;f++)u[f]=l.call(a,f<<i,s);return u}}}function Fc(){let n=Qe(),e=x+J();for(let r=2;r<n;r++){let s=Qe();x+=s}let t=x;return x=e,ee=[$n(Qe()),$n(Qe())],ee.position0=0,ee.position1=0,ee.postBundlePosition=x,x=t,J()}function Qe(){let n=D[x++]&31;if(n>23)switch(n){case 24:n=D[x++];break;case 25:n=ae.getUint16(x),x+=2;break;case 26:n=ae.getUint32(x),x+=4;break}return n}function yr(){if(K.getShared){let n=ui(()=>(D=null,K.getShared()))||{},e=n.structures||[];K.sharedVersion=n.version,ue=K.sharedValues=n.packedValues,X===!0?K.structures=X=e:X.splice.apply(X,[0,e.length].concat(e))}}function ui(n){let e=Ve,t=x,r=Zt,s=xt,i=Xt,o=ve,a=ee,c=new Uint8Array(D.slice(0,Ve)),u=X,l=K,f=St,g=n();return Ve=e,x=t,Zt=r,xt=s,Xt=i,ve=o,ee=a,D=c,St=f,X=u,K=l,ae=new DataView(D.buffer,D.byteOffset,D.byteLength),g}function Bn(){D=null,ve=null,X=null}const br=new Array(147);for(let n=0;n<256;n++)br[n]=+("1e"+Math.floor(45.15-n*.30103));let wr=new kt({useRecords:!1});const li=wr.decode;wr.decodeMultiple;let Ft;try{Ft=new TextEncoder}catch{}let Fn,di;const un=typeof globalThis=="object"&&globalThis.Buffer,It=typeof un<"u",yn=It?un.allocUnsafeSlow:Uint8Array,Jr=It?un:Uint8Array,Kr=256,qr=It?4294967296:2144337920;let bn,b,Y,_=0,Pe,Q=null;const zc=61440,Hc=/[\u0080-\uFFFF]/,de=Symbol("record-id");class hi extends kt{constructor(e){super(e),this.offset=0;let t,r,s,i,o;e=e||{};let a=Jr.prototype.utf8Write?function(m,M,I){return b.utf8Write(m,M,I)}:Ft&&Ft.encodeInto?function(m,M){return Ft.encodeInto(m,b.subarray(M)).written}:!1,c=this,u=e.structures||e.saveStructures,l=e.maxSharedStructures;if(l==null&&(l=u?128:0),l>8190)throw new Error("Maximum maxSharedStructure is 8190");let f=e.sequential;f&&(l=0),this.structures||(this.structures=[]),this.saveStructures&&(this.saveShared=this.saveStructures);let g,h,y=e.sharedValues,v;if(y){v=Object.create(null);for(let m=0,M=y.length;m<M;m++)v[y[m]]=m}let S=[],T=0,j=0;this.mapEncode=function(m,M){if(this._keyMap&&!this._mapped)switch(m.constructor.name){case"Array":m=m.map(I=>this.encodeKeys(I));break}return this.encode(m,M)},this.encode=function(m,M){if(b||(b=new yn(8192),Y=new DataView(b.buffer,0,8192),_=0),Pe=b.length-10,Pe-_<2048?(b=new yn(b.length),Y=new DataView(b.buffer,0,b.length),Pe=b.length-10,_=0):M===Zr&&(_=_+7&2147483640),t=_,c.useSelfDescribedHeader&&(Y.setUint32(_,3654940416),_+=3),o=c.structuredClone?new Map:null,c.bundleStrings&&typeof m!="string"?(Q=[],Q.size=1/0):Q=null,r=c.structures,r){if(r.uninitialized){let O=c.getShared()||{};c.structures=r=O.structures||[],c.sharedVersion=O.version;let C=c.sharedValues=O.packedValues;if(C){v={};for(let B=0,F=C.length;B<F;B++)v[C[B]]=B}}let I=r.length;if(I>l&&!f&&(I=l),!r.transitions){r.transitions=Object.create(null);for(let O=0;O<I;O++){let C=r[O];if(!C)continue;let B,F=r.transitions;for(let H=0,V=C.length;H<V;H++){F[de]===void 0&&(F[de]=O);let q=C[H];B=F[q],B||(B=F[q]=Object.create(null)),F=B}F[de]=O|1048576}}f||(r.nextId=I)}if(s&&(s=!1),i=r||[],h=v,e.pack){let I=new Map;if(I.values=[],I.encoder=c,I.maxValues=e.maxPrivatePackedValues||(v?16:1/0),I.objectMap=v||!1,I.samplingPackedValues=g,zt(m,I),I.values.length>0){b[_++]=216,b[_++]=51,Se(4);let O=I.values;A(O),Se(0),Se(0),h=Object.create(v||null);for(let C=0,B=O.length;C<B;C++)h[O[C]]=C}}bn=M&mn;try{if(bn)return;if(A(m),Q&&Xr(t,A),c.offset=_,o&&o.idsToInsert){_+=o.idsToInsert.length*2,_>Pe&&z(_),c.offset=_;let I=Wc(b.subarray(t,_),o.idsToInsert);return o=null,I}return M&Zr?(b.start=t,b.end=_,b):b.subarray(t,_)}finally{if(r){if(j<10&&j++,r.length>l&&(r.length=l),T>1e4)r.transitions=null,j=0,T=0,S.length>0&&(S=[]);else if(S.length>0&&!f){for(let I=0,O=S.length;I<O;I++)S[I][de]=void 0;S=[]}}if(s&&c.saveShared){c.structures.length>l&&(c.structures=c.structures.slice(0,l));let I=b.subarray(t,_);return c.updateSharedData()===!1?c.encode(m):I}M&Jc&&(_=t)}},this.findCommonStringsToPack=()=>(g=new Map,v||(v=Object.create(null)),m=>{let M=m&&m.threshold||4,I=this.pack?m.maxPrivatePackedValues||16:0;y||(y=this.sharedValues=[]);for(let[O,C]of g)C.count>M&&(v[O]=I++,y.push(O),s=!0);for(;this.saveShared&&this.updateSharedData()===!1;);g=null});const A=m=>{_>Pe&&(b=z(_));var M=typeof m,I;if(M==="string"){if(h){let F=h[m];if(F>=0){F<16?b[_++]=F+224:(b[_++]=198,F&1?A(15-F>>1):A(F-16>>1));return}else if(g&&!e.pack){let H=g.get(m);H?H.count++:g.set(m,{count:1})}}let O=m.length;if(Q&&O>=4&&O<1024){if((Q.size+=O)>zc){let H,V=(Q[0]?Q[0].length*3+Q[1].length:0)+10;_+V>Pe&&(b=z(_+V)),b[_++]=217,b[_++]=223,b[_++]=249,b[_++]=Q.position?132:130,b[_++]=26,H=_-t,_+=4,Q.position&&Xr(t,A),Q=["",""],Q.size=0,Q.position=H}let F=Hc.test(m);Q[F?0:1]+=m,b[_++]=F?206:207,A(O);return}let C;O<32?C=1:O<256?C=2:O<65536?C=3:C=5;let B=O*3;if(_+B>Pe&&(b=z(_+B)),O<64||!a){let F,H,V,q=_+C;for(F=0;F<O;F++)H=m.charCodeAt(F),H<128?b[q++]=H:H<2048?(b[q++]=H>>6|192,b[q++]=H&63|128):(H&64512)===55296&&((V=m.charCodeAt(F+1))&64512)===56320?(H=65536+((H&1023)<<10)+(V&1023),F++,b[q++]=H>>18|240,b[q++]=H>>12&63|128,b[q++]=H>>6&63|128,b[q++]=H&63|128):(b[q++]=H>>12|224,b[q++]=H>>6&63|128,b[q++]=H&63|128);I=q-_-C}else I=a(m,_+C,B);I<24?b[_++]=96|I:I<256?(C<2&&b.copyWithin(_+2,_+1,_+1+I),b[_++]=120,b[_++]=I):I<65536?(C<3&&b.copyWithin(_+3,_+2,_+2+I),b[_++]=121,b[_++]=I>>8,b[_++]=I&255):(C<5&&b.copyWithin(_+5,_+3,_+3+I),b[_++]=122,Y.setUint32(_,I),_+=4),_+=I}else if(M==="number")if(!this.alwaysUseFloat&&m>>>0===m)m<24?b[_++]=m:m<256?(b[_++]=24,b[_++]=m):m<65536?(b[_++]=25,b[_++]=m>>8,b[_++]=m&255):(b[_++]=26,Y.setUint32(_,m),_+=4);else if(!this.alwaysUseFloat&&m>>0===m)m>=-24?b[_++]=31-m:m>=-256?(b[_++]=56,b[_++]=~m):m>=-65536?(b[_++]=57,Y.setUint16(_,~m),_+=2):(b[_++]=58,Y.setUint32(_,~m),_+=4);else{let O;if((O=this.useFloat32)>0&&m<4294967296&&m>=-2147483648){b[_++]=250,Y.setFloat32(_,m);let C;if(O<4||(C=m*br[(b[_]&127)<<1|b[_+1]>>7])>>0===C){_+=4;return}else _--}b[_++]=251,Y.setFloat64(_,m),_+=8}else if(M==="object")if(!m)b[_++]=246;else{if(o){let C=o.get(m);if(C){if(b[_++]=216,b[_++]=29,b[_++]=25,!C.references){let B=o.idsToInsert||(o.idsToInsert=[]);C.references=[],B.push(C)}C.references.push(_-t),_+=2;return}else o.set(m,{offset:_-t})}let O=m.constructor;if(O===Object)N(m,!0);else if(O===Array){I=m.length,I<24?b[_++]=128|I:Se(I);for(let C=0;C<I;C++)A(m[C])}else if(O===Map)if((this.mapsAsObjects?this.useTag259ForMaps!==!1:this.useTag259ForMaps)&&(b[_++]=217,b[_++]=1,b[_++]=3),I=m.size,I<24?b[_++]=160|I:I<256?(b[_++]=184,b[_++]=I):I<65536?(b[_++]=185,b[_++]=I>>8,b[_++]=I&255):(b[_++]=186,Y.setUint32(_,I),_+=4),c.keyMap)for(let[C,B]of m)A(c.encodeKey(C)),A(B);else for(let[C,B]of m)A(C),A(B);else{for(let C=0,B=Fn.length;C<B;C++){let F=di[C];if(m instanceof F){let H=Fn[C],V=H.tag;V==null&&(V=H.getTag&&H.getTag.call(this,m)),V<24?b[_++]=192|V:V<256?(b[_++]=216,b[_++]=V):V<65536?(b[_++]=217,b[_++]=V>>8,b[_++]=V&255):V>-1&&(b[_++]=218,Y.setUint32(_,V),_+=4),H.encode.call(this,m,A,z);return}}if(m[Symbol.iterator]){if(bn){let C=new Error("Iterable should be serialized as iterator");throw C.iteratorNotHandled=!0,C}b[_++]=159;for(let C of m)A(C);b[_++]=255;return}if(m[Symbol.asyncIterator]||wn(m)){let C=new Error("Iterable/blob should be serialized as iterator");throw C.iteratorNotHandled=!0,C}if(this.useToJSON&&m.toJSON){const C=m.toJSON();if(C!==m)return A(C)}N(m,!m.hasOwnProperty)}}else if(M==="boolean")b[_++]=m?245:244;else if(M==="bigint"){if(m<BigInt(1)<<BigInt(64)&&m>=0)b[_++]=27,Y.setBigUint64(_,m);else if(m>-(BigInt(1)<<BigInt(64))&&m<0)b[_++]=59,Y.setBigUint64(_,-m-BigInt(1));else if(this.largeBigIntToFloat)b[_++]=251,Y.setFloat64(_,Number(m));else throw new RangeError(m+" was too large to fit in CBOR 64-bit integer format, set largeBigIntToFloat to convert to float-64");_+=8}else if(M==="undefined")b[_++]=247;else throw new Error("Unknown type: "+M)},N=this.useRecords===!1?this.variableMapSize?m=>{let M=Object.keys(m),I=Object.values(m),O=M.length;if(O<24?b[_++]=160|O:O<256?(b[_++]=184,b[_++]=O):O<65536?(b[_++]=185,b[_++]=O>>8,b[_++]=O&255):(b[_++]=186,Y.setUint32(_,O),_+=4),c.keyMap)for(let C=0;C<O;C++)A(c.encodeKey(M[C])),A(I[C]);else for(let C=0;C<O;C++)A(M[C]),A(I[C])}:(m,M)=>{b[_++]=185;let I=_-t;_+=2;let O=0;if(c.keyMap)for(let C in m)(M||m.hasOwnProperty(C))&&(A(c.encodeKey(C)),A(m[C]),O++);else for(let C in m)(M||m.hasOwnProperty(C))&&(A(C),A(m[C]),O++);b[I+++t]=O>>8,b[I+t]=O&255}:(m,M)=>{let I,O=i.transitions||(i.transitions=Object.create(null)),C=0,B=0,F,H;if(this.keyMap){H=Object.keys(m).map(q=>this.encodeKey(q)),B=H.length;for(let q=0;q<B;q++){let xr=H[q];I=O[xr],I||(I=O[xr]=Object.create(null),C++),O=I}}else for(let q in m)(M||m.hasOwnProperty(q))&&(I=O[q],I||(O[de]&1048576&&(F=O[de]&65535),I=O[q]=Object.create(null),C++),O=I,B++);let V=O[de];if(V!==void 0)V&=65535,b[_++]=217,b[_++]=V>>8|224,b[_++]=V&255;else if(H||(H=O.__keys__||(O.__keys__=Object.keys(m))),F===void 0?(V=i.nextId++,V||(V=0,i.nextId=1),V>=Kr&&(i.nextId=(V=l)+1)):V=F,i[V]=H,V<l){b[_++]=217,b[_++]=V>>8|224,b[_++]=V&255,O=i.transitions;for(let q=0;q<B;q++)(O[de]===void 0||O[de]&1048576)&&(O[de]=V),O=O[H[q]];O[de]=V|1048576,s=!0}else{if(O[de]=V,Y.setUint32(_,3655335680),_+=3,C&&(T+=j*C),S.length>=Kr-l&&(S.shift()[de]=void 0),S.push(O),Se(B+2),A(57344+V),A(H),M===null)return;for(let q in m)(M||m.hasOwnProperty(q))&&A(m[q]);return}if(B<24?b[_++]=128|B:Se(B),M!==null)for(let q in m)(M||m.hasOwnProperty(q))&&A(m[q])},z=m=>{let M;if(m>16777216){if(m-t>qr)throw new Error("Encoded buffer would be larger than maximum buffer size");M=Math.min(qr,Math.round(Math.max((m-t)*(m>67108864?1.25:2),4194304)/4096)*4096)}else M=(Math.max(m-t<<2,b.length-1)>>12)+1<<12;let I=new yn(M);return Y=new DataView(I.buffer,0,M),b.copy?b.copy(I,0,t,m):I.set(b.slice(t,m)),_-=t,t=0,Pe=I.length-10,b=I};let E=100,U=1e3;this.encodeAsIterable=function(m,M){return fe(m,M,P)},this.encodeAsAsyncIterable=function(m,M){return fe(m,M,ge)};function*P(m,M,I){let O=m.constructor;if(O===Object){let C=c.useRecords!==!1;C?N(m,null):Gr(Object.keys(m).length,160);for(let B in m){let F=m[B];C||A(B),F&&typeof F=="object"?M[B]?yield*P(F,M[B]):yield*L(F,M,B):A(F)}}else if(O===Array){let C=m.length;Se(C);for(let B=0;B<C;B++){let F=m[B];F&&(typeof F=="object"||_-t>E)?M.element?yield*P(F,M.element):yield*L(F,M,"element"):A(F)}}else if(m[Symbol.iterator]){b[_++]=159;for(let C of m)C&&(typeof C=="object"||_-t>E)?M.element?yield*P(C,M.element):yield*L(C,M,"element"):A(C);b[_++]=255}else wn(m)?(Gr(m.size,64),yield b.subarray(t,_),yield m,W()):m[Symbol.asyncIterator]?(b[_++]=159,yield b.subarray(t,_),yield m,W(),b[_++]=255):A(m);I&&_>t?yield b.subarray(t,_):_-t>E&&(yield b.subarray(t,_),W())}function*L(m,M,I){let O=_-t;try{A(m),_-t>E&&(yield b.subarray(t,_),W())}catch(C){if(C.iteratorNotHandled)M[I]={},_=t+O,yield*P.call(this,m,M[I]);else throw C}}function W(){E=U,c.encode(null,mn)}function fe(m,M,I){return M&&M.chunkThreshold?E=U=M.chunkThreshold:E=100,m&&typeof m=="object"?(c.encode(null,mn),I(m,c.iterateProperties||(c.iterateProperties={}),!0)):[c.encode(m)]}async function*ge(m,M){for(let I of P(m,M,!0)){let O=I.constructor;if(O===Jr||O===Uint8Array)yield I;else if(wn(I)){let C=I.stream().getReader(),B;for(;!(B=await C.read()).done;)yield B.value}else if(I[Symbol.asyncIterator])for await(let C of I)W(),C?yield*ge(C,M.async||(M.async={})):yield c.encode(C);else yield I}}}useBuffer(e){b=e,Y=new DataView(b.buffer,b.byteOffset,b.byteLength),_=0}clearSharedData(){this.structures&&(this.structures=[]),this.sharedValues&&(this.sharedValues=void 0)}updateSharedData(){let e=this.sharedVersion||0;this.sharedVersion=e+1;let t=this.structures.slice(0),r=new gi(t,this.sharedValues,this.sharedVersion),s=this.saveShared(r,i=>(i&&i.version||0)==e);return s===!1?(r=this.getShared()||{},this.structures=r.structures||[],this.sharedValues=r.packedValues,this.sharedVersion=r.version,this.structures.nextId=this.structures.length):t.forEach((i,o)=>this.structures[o]=i),s}}function Gr(n,e){n<24?b[_++]=e|n:n<256?(b[_++]=e|24,b[_++]=n):n<65536?(b[_++]=e|25,b[_++]=n>>8,b[_++]=n&255):(b[_++]=e|26,Y.setUint32(_,n),_+=4)}class gi{constructor(e,t,r){this.structures=e,this.packedValues=t,this.version=r}}function Se(n){n<24?b[_++]=128|n:n<256?(b[_++]=152,b[_++]=n):n<65536?(b[_++]=153,b[_++]=n>>8,b[_++]=n&255):(b[_++]=154,Y.setUint32(_,n),_+=4)}const Nc=typeof Blob>"u"?function(){}:Blob;function wn(n){if(n instanceof Nc)return!0;let e=n[Symbol.toStringTag];return e==="Blob"||e==="File"}function zt(n,e){switch(typeof n){case"string":if(n.length>3){if(e.objectMap[n]>-1||e.values.length>=e.maxValues)return;let r=e.get(n);if(r)++r.count==2&&e.values.push(n);else if(e.set(n,{count:1}),e.samplingPackedValues){let s=e.samplingPackedValues.get(n);s?s.count++:e.samplingPackedValues.set(n,{count:1})}}break;case"object":if(n)if(n instanceof Array)for(let r=0,s=n.length;r<s;r++)zt(n[r],e);else{let r=!e.encoder.useRecords;for(var t in n)n.hasOwnProperty(t)&&(r&&zt(t,e),zt(n[t],e))}break;case"function":console.log(n)}}const Vc=new Uint8Array(new Uint16Array([1]).buffer)[0]==1;di=[Date,Set,Error,RegExp,Je,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array>"u"?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array>"u"?function(){}:BigInt64Array,Float32Array,Float64Array,gi];Fn=[{tag:1,encode(n,e){let t=n.getTime()/1e3;(this.useTimestamp32||n.getMilliseconds()===0)&&t>=0&&t<4294967296?(b[_++]=26,Y.setUint32(_,t),_+=4):(b[_++]=251,Y.setFloat64(_,t),_+=8)}},{tag:258,encode(n,e){let t=Array.from(n);e(t)}},{tag:27,encode(n,e){e([n.name,n.message])}},{tag:27,encode(n,e){e(["RegExp",n.source,n.flags])}},{getTag(n){return n.tag},encode(n,e){e(n.value)}},{encode(n,e,t){Yr(n,t)}},{getTag(n){if(n.constructor===Uint8Array&&(this.tagUint8Array||It&&this.tagUint8Array!==!1))return 64},encode(n,e,t){Yr(n,t)}},xe(68,1),xe(69,2),xe(70,4),xe(71,8),xe(72,1),xe(77,2),xe(78,4),xe(79,8),xe(85,4),xe(86,8),{encode(n,e){let t=n.packedValues||[],r=n.structures||[];if(t.values.length>0){b[_++]=216,b[_++]=51,Se(4);let s=t.values;e(s),Se(0),Se(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let i=0,o=s.length;i<o;i++)packedObjectMap[s[i]]=i}if(r){Y.setUint32(_,3655335424),_+=3;let s=r.slice(0);s.unshift(57344),s.push(new Je(n.version,1399353956)),e(s)}else e(new Je(n.version,1399353956))}}];function xe(n,e){return!Vc&&e>1&&(n-=4),{tag:n,encode:function(r,s){let i=r.byteLength,o=r.byteOffset||0,a=r.buffer||r;s(It?un.from(a,o,i):new Uint8Array(a,o,i))}}}function Yr(n,e){let t=n.byteLength;t<24?b[_++]=64+t:t<256?(b[_++]=88,b[_++]=t):t<65536?(b[_++]=89,b[_++]=t>>8,b[_++]=t&255):(b[_++]=90,Y.setUint32(_,t),_+=4),_+t>=b.length&&e(_+t),b.set(n.buffer?n:new Uint8Array(n),_),_+=t}function Wc(n,e){let t,r=e.length*2,s=n.length-r;e.sort((i,o)=>i.offset>o.offset?1:-1);for(let i=0;i<e.length;i++){let o=e[i];o.id=i;for(let a of o.references)n[a++]=i>>8,n[a]=i&255}for(;t=e.pop();){let i=t.offset;n.copyWithin(i+r,i,s),r-=2;let o=i+r;n[o++]=216,n[o++]=28,s=i}return n}function Xr(n,e){Y.setUint32(Q.position+n,_-Q.position-n+1);let t=Q;Q=null,e(t[0]),e(t[1])}let mr=new hi({useRecords:!1});mr.encode;mr.encodeAsIterable;mr.encodeAsAsyncIterable;const Zr=512,Jc=1024,mn=2048;function _i(n){return new hi({tagUint8Array:!1,useRecords:!1}).encode(n)}function Kc(n){return li(n)}const qc=(n,e)=>n.length===e.length&&n.every((t,r)=>t===e[r]),vr=(n,e)=>qc(n,e),Gc=async(n,e)=>{let t;const r=new Promise((s,i)=>{t=setTimeout(()=>i(new Yc(`withTimeout: timed out after ${e}ms`)),e)});try{return await Promise.race([n,r])}finally{clearTimeout(t)}};class Yc extends Error{constructor(e){super(e),this.name="TimeoutError"}}class Xc extends Me{documentId;#t;#e;#r=$e();#n=6e4;#i={};constructor(e,t={}){super(),this.documentId=e,"timeoutDelay"in t&&t.timeoutDelay&&(this.#n=t.timeoutDelay);const r=$e();this.#t=Ae(`automerge-repo:dochandle:${this.documentId.slice(0,5)}`);const s=this.#n,i=oc({types:{context:{},events:{}},actions:{onUpdate:Lt(({context:o,event:a})=>{const c=o.doc;nc(a,Mt);const{callback:u}=a.payload;return{doc:u(c)}}),onDelete:Lt(()=>(this.emit("delete",{handle:this}),{doc:$e()})),onUnload:Lt(()=>({doc:$e()})),onUnavailable:()=>{this.emit("unavailable",{handle:this})}}}).createMachine({initial:"idle",context:{documentId:e,doc:r},on:{UPDATE:{actions:"onUpdate"},UNLOAD:".unloaded",DELETE:".deleted"},states:{idle:{on:{BEGIN:"loading"}},loading:{on:{REQUEST:"requesting",DOC_READY:"ready"},after:{[s]:"unavailable"}},requesting:{on:{DOC_UNAVAILABLE:"unavailable",DOC_READY:"ready"},after:{[s]:"unavailable"}},unavailable:{entry:"onUnavailable",on:{DOC_READY:"ready"}},ready:{},unloaded:{entry:"onUnload",on:{RELOAD:"loading"}},deleted:{entry:"onDelete",type:"final"}}});this.#e=vt(i),this.#e.subscribe(o=>{const a=this.#r,c=o.context.doc;this.#t(`→ ${o.value} %o`,c),this.#c(a,c)}),this.#e.start(),this.begin()}get#s(){return this.#e?.getSnapshot().context.doc}get#a(){return this.#e?.getSnapshot().value}#o(e){const t=Array.isArray(e)?e:[e];return cc(this.#e,r=>t.some(s=>r.matches(s)),{timeout:this.#n*2})}#c(e,t){const r=me(e),s=me(t);if(!vr(s,r)){this.emit("heads-changed",{handle:this,doc:t});const o=kn(t,r,s);o.length>0&&this.emit("change",{handle:this,doc:t,patches:o,patchInfo:{before:e,after:t,source:"change"}}),this.isReady()||this.#e.send({type:Qr})}this.#r=t}get url(){return pr({documentId:this.documentId})}isReady=()=>this.inState(["ready"]);isUnloaded=()=>this.inState(["unloaded"]);isDeleted=()=>this.inState(["deleted"]);isUnavailable=()=>this.inState(["unavailable"]);inState=e=>e.some(t=>this.#e.getSnapshot().matches(t));get state(){return this.#e.getSnapshot().value}async whenReady(e=["ready"]){await Gc(this.#o(e),this.#n)}async doc(e=["ready","unavailable"]){try{await this.#o(e)}catch{return}return this.isUnavailable()?void 0:this.#s}docSync(){if(this.isReady())return this.#s}heads(){if(this.isReady())return me(this.#s)}begin(){this.#e.send({type:tf})}history(){if(this.isReady())return Cs(this.#s).map(e=>[e])}view(e){if(this.isReady())return ds(this.#s,e)}diff(e,t){if(!this.isReady())return;const r=t?e:this.heads()||[],s=t||e;return kn(this.#s,r,s)}metadata(e){if(this.isReady())return e||(e=this.heads()[0]),Is(this.#s,e)||void 0}update(e){this.#e.send({type:Mt,payload:{callback:e}})}doneLoading(){this.#e.send({type:Qr})}setRemoteHeads(e,t){this.#i[e]=t,this.emit("remote-heads",{storageId:e,heads:t})}getRemoteHeads(e){return this.#i[e]}change(e,t={}){if(!this.isReady())throw new Error(`DocHandle#${this.documentId} is in ${this.state} and not ready. Check \`handle.isReady()\` before accessing the document.`);this.#e.send({type:Mt,payload:{callback:r=>hs(r,t,e)}})}changeAt(e,t,r={}){if(!this.isReady())throw new Error(`DocHandle#${this.documentId} is not ready. Check \`handle.isReady()\` before accessing the document.`);let s;return this.#e.send({type:Mt,payload:{callback:i=>{const o=gs(i,e,r,t);return s=o.newHeads||void 0,o.newDoc}}}),s}merge(e){if(!this.isReady()||!e.isReady())throw new Error("Both handles must be ready to merge");const t=e.docSync();if(!t)throw new Error("The document to be merged in is falsy, aborting.");this.update(r=>ps(r,t))}unavailable(){this.#e.send({type:af})}request(){this.#a==="loading"&&this.#e.send({type:nf})}unload(){this.#e.send({type:rf})}reload(){this.#e.send({type:sf})}delete(){this.#e.send({type:of})}broadcast(e){this.emit("ephemeral-message-outbound",{handle:this,data:_i(e)})}metrics(){return rn(this.#s)}}const Zc={IDLE:"idle",LOADING:"loading",REQUESTING:"requesting",READY:"ready",UNLOADED:"unloaded",DELETED:"deleted",UNAVAILABLE:"unavailable"},{IDLE:Ff,LOADING:zf,REQUESTING:jt,READY:Ht,UNLOADED:Qc,DELETED:ef,UNAVAILABLE:zn}=Zc,tf="BEGIN",nf="REQUEST",Qr="DOC_READY",Mt="UPDATE",rf="UNLOAD",sf="RELOAD",of="DELETE",af="DOC_UNAVAILABLE";class cf extends Me{#t=new Map;#e=new Set;#r=new Map;#n=new Set;#i=new Map;#s=Ae("automerge-repo:remote-heads-subscriptions");subscribeToRemotes(e){this.#s("subscribeToRemotes",e);const t=[];for(const r of e)this.#e.has(r)||(this.#e.add(r),t.push(r));t.length>0&&this.emit("change-remote-subs",{add:t,peers:Array.from(this.#n)})}unsubscribeFromRemotes(e){this.#s("subscribeToRemotes",e);const t=[];for(const r of e)this.#e.has(r)&&(this.#e.delete(r),this.#r.has(r)||t.push(r));t.length>0&&this.emit("change-remote-subs",{remove:t,peers:Array.from(this.#n)})}handleControlMessage(e){const t=[],r=[],s=[];if(this.#s("handleControlMessage",e),e.add)for(const i of e.add){let o=this.#r.get(i);(this.#e.has(i)||o)&&s.push(i),o||(o=new Set,this.#r.set(i,o),this.#e.has(i)||t.push(i)),o.add(e.senderId)}if(e.remove)for(const i of e.remove){const o=this.#r.get(i);o&&(o.delete(e.senderId),o.size==0&&!this.#e.has(i)&&r.push(i))}(t.length>0||r.length>0)&&this.emit("change-remote-subs",{peers:Array.from(this.#n),add:t,remove:r});for(const i of s){const o=this.#i.get(e.senderId);if(o)for(const a of o){const c=this.#t.get(a);if(!c)continue;const u=c.get(i);u&&this.emit("notify-remote-heads",{targetId:e.senderId,documentId:a,heads:u.heads,timestamp:u.timestamp,storageId:i})}}}handleRemoteHeads(e){this.#s("handleRemoteHeads",e);const t=this.#o(e);for(const r of t)this.#e.has(r.storageId)&&this.emit("remote-heads-changed",r);for(const r of t)for(const s of this.#n)s!==e.senderId&&this.emit("notify-remote-heads",{targetId:s,documentId:r.documentId,heads:r.remoteHeads,timestamp:r.timestamp,storageId:r.storageId});for(const r of t){const s=this.#r.get(r.storageId);if(s)for(const i of s)this.#a(i,r.documentId)&&this.emit("notify-remote-heads",{targetId:i,documentId:r.documentId,heads:r.remoteHeads,timestamp:r.timestamp,storageId:r.storageId})}}handleImmediateRemoteHeadsChanged(e,t,r){this.#s("handleLocalHeadsChanged",e,t,r);const s=this.#t.get(e),i=Date.now();if(!s)this.#t.set(e,new Map([[t,{heads:r,timestamp:i}]]));else{const a=s.get(t);(!a||a.timestamp<Date.now())&&s.set(t,{heads:r,timestamp:Date.now()})}const o=this.#r.get(t);if(o)for(const a of o)this.#a(a,e)&&this.emit("notify-remote-heads",{targetId:a,documentId:e,heads:r,timestamp:i,storageId:t})}addGenerousPeer(e){this.#s("addGenerousPeer",e),this.#n.add(e),this.#e.size>0&&this.emit("change-remote-subs",{add:Array.from(this.#e),peers:[e]});for(const[t,r]of this.#t)for(const[s,{heads:i,timestamp:o}]of r)this.emit("notify-remote-heads",{targetId:e,documentId:t,heads:i,timestamp:o,storageId:s})}removePeer(e){this.#s("removePeer",e);const t=[];this.#n.delete(e),this.#i.delete(e);for(const[r,s]of this.#r)s.has(e)&&(s.delete(e),s.size==0&&(t.push(r),this.#r.delete(r)));t.length>0&&this.emit("change-remote-subs",{remove:t,peers:Array.from(this.#n)})}subscribePeerToDoc(e,t){let r=this.#i.get(e);r||(r=new Set,this.#i.set(e,r)),r.add(t);const s=this.#t.get(t);if(s)for(const[i,o]of s){const a=this.#r.get(i);a&&a.has(e)&&this.emit("notify-remote-heads",{targetId:e,documentId:t,heads:o.heads,timestamp:o.timestamp,storageId:i})}}#a(e,t){const r=this.#i.get(e);return r&&r.has(t)}#o(e){const t=[],{documentId:r,newHeads:s}=e;for(const[i,{heads:o,timestamp:a}]of Object.entries(s)){if(!this.#e.has(i)&&!this.#r.has(i))continue;let c=this.#t.get(r);c||(c=new Map,this.#t.set(r,c));const u=c.get(i);u&&u.timestamp>=a||(c.set(i,{timestamp:a,heads:o}),t.push({documentId:r,storageId:i,remoteHeads:o,timestamp:a}))}return t}}const Hn=(n,e)=>{let t=Date.now(),r,s;return function(...i){r=t+e-Date.now(),clearTimeout(s),s=setTimeout(()=>{n(...i),t=Date.now()},r)}},ff=n=>lf(n)||yi(n)||pi(n)||uf(n)||df(n)||hf(n),uf=n=>n.type==="doc-unavailable",pi=n=>n.type==="request",lf=n=>n.type==="sync",yi=n=>n.type==="ephemeral",df=n=>n.type==="remote-subscription-change",hf=n=>n.type==="remote-heads-changed",gf=n=>`${n.senderId}:${n.sessionId}`;class _f extends Me{peerId;peerMetadata;#t;#e={};#r=0;#n=Math.random().toString(36).slice(2);#i={};adapters=[];constructor(e,t,r){super(),this.peerId=t,this.peerMetadata=r,this.#t=Ae(`automerge-repo:network:${this.peerId}`),e.forEach(s=>this.addNetworkAdapter(s))}disconnect(){this.adapters.forEach(e=>e.disconnect())}reconnect(){this.adapters.forEach(e=>e.connect(this.peerId))}addNetworkAdapter(e){this.adapters.push(e),e.on("peer-candidate",({peerId:t,peerMetadata:r})=>{this.#t(`peer candidate: ${t} `),this.#e[t]||(this.#e[t]=e),this.emit("peer",{peerId:t,peerMetadata:r})}),e.on("peer-disconnected",({peerId:t})=>{this.#t(`peer disconnected: ${t} `),delete this.#e[t],this.emit("peer-disconnected",{peerId:t})}),e.on("message",t=>{if(!ff(t)){this.#t(`invalid message: ${JSON.stringify(t)}`);return}if(this.#t(`message from ${t.senderId}`),yi(t)){const r=gf(t);(this.#i[r]===void 0||t.count>this.#i[r])&&(this.#i[r]=t.count,this.emit("message",t));return}this.emit("message",t)}),e.on("close",()=>{this.#t("adapter closed"),Object.entries(this.#e).forEach(([t,r])=>{r===e&&delete this.#e[t]})}),this.peerMetadata.then(t=>{e.connect(this.peerId,t)}).catch(t=>{this.#t("error connecting to network",t)})}removeNetworkAdapter(e){this.adapters=this.adapters.filter(t=>t!==e),e.disconnect()}send(e){const t=this.#e[e.targetId];if(!t){this.#t(`Tried to send message but peer not found: ${e.targetId}`);return}const s=(i=>i.type==="ephemeral"?"count"in i?i:{...i,count:++this.#r,sessionId:this.#n,senderId:this.peerId}:{...i,senderId:this.peerId})(e);this.#t("sending message %o",s),t.send(s)}isReady=()=>this.adapters.every(e=>e.isReady());whenReady=async()=>Promise.all(this.adapters.map(e=>e.whenReady()))}function bi(n){let e=0;n.forEach(s=>{e+=s.length});const t=new Uint8Array(e);let r=0;return n.forEach(s=>{t.set(s,r),r+=s.length}),t}var wi={exports:{}};(function(n){(function(e,t){var r={};t(r);var s=r.default;for(var i in r)s[i]=r[i];n.exports=s})(Yo,function(e){e.__esModule=!0,e.digestLength=32,e.blockSize=64;var t=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function r(g,h,y,v,S){for(var T,j,A,N,z,E,U,P,L,W,fe,ge,m;S>=64;){for(T=h[0],j=h[1],A=h[2],N=h[3],z=h[4],E=h[5],U=h[6],P=h[7],W=0;W<16;W++)fe=v+W*4,g[W]=(y[fe]&255)<<24|(y[fe+1]&255)<<16|(y[fe+2]&255)<<8|y[fe+3]&255;for(W=16;W<64;W++)L=g[W-2],ge=(L>>>17|L<<15)^(L>>>19|L<<13)^L>>>10,L=g[W-15],m=(L>>>7|L<<25)^(L>>>18|L<<14)^L>>>3,g[W]=(ge+g[W-7]|0)+(m+g[W-16]|0);for(W=0;W<64;W++)ge=(((z>>>6|z<<26)^(z>>>11|z<<21)^(z>>>25|z<<7))+(z&E^~z&U)|0)+(P+(t[W]+g[W]|0)|0)|0,m=((T>>>2|T<<30)^(T>>>13|T<<19)^(T>>>22|T<<10))+(T&j^T&A^j&A)|0,P=U,U=E,E=z,z=N+ge|0,N=A,A=j,j=T,T=ge+m|0;h[0]+=T,h[1]+=j,h[2]+=A,h[3]+=N,h[4]+=z,h[5]+=E,h[6]+=U,h[7]+=P,v+=64,S-=64}return v}var s=function(){function g(){this.digestLength=e.digestLength,this.blockSize=e.blockSize,this.state=new Int32Array(8),this.temp=new Int32Array(64),this.buffer=new Uint8Array(128),this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this.reset()}return g.prototype.reset=function(){return this.state[0]=1779033703,this.state[1]=3144134277,this.state[2]=1013904242,this.state[3]=2773480762,this.state[4]=1359893119,this.state[5]=2600822924,this.state[6]=528734635,this.state[7]=1541459225,this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this},g.prototype.clean=function(){for(var h=0;h<this.buffer.length;h++)this.buffer[h]=0;for(var h=0;h<this.temp.length;h++)this.temp[h]=0;this.reset()},g.prototype.update=function(h,y){if(y===void 0&&(y=h.length),this.finished)throw new Error("SHA256: can't update because hash was finished.");var v=0;if(this.bytesHashed+=y,this.bufferLength>0){for(;this.bufferLength<64&&y>0;)this.buffer[this.bufferLength++]=h[v++],y--;this.bufferLength===64&&(r(this.temp,this.state,this.buffer,0,64),this.bufferLength=0)}for(y>=64&&(v=r(this.temp,this.state,h,v,y),y%=64);y>0;)this.buffer[this.bufferLength++]=h[v++],y--;return this},g.prototype.finish=function(h){if(!this.finished){var y=this.bytesHashed,v=this.bufferLength,S=y/536870912|0,T=y<<3,j=y%64<56?64:128;this.buffer[v]=128;for(var A=v+1;A<j-8;A++)this.buffer[A]=0;this.buffer[j-8]=S>>>24&255,this.buffer[j-7]=S>>>16&255,this.buffer[j-6]=S>>>8&255,this.buffer[j-5]=S>>>0&255,this.buffer[j-4]=T>>>24&255,this.buffer[j-3]=T>>>16&255,this.buffer[j-2]=T>>>8&255,this.buffer[j-1]=T>>>0&255,r(this.temp,this.state,this.buffer,0,j),this.finished=!0}for(var A=0;A<8;A++)h[A*4+0]=this.state[A]>>>24&255,h[A*4+1]=this.state[A]>>>16&255,h[A*4+2]=this.state[A]>>>8&255,h[A*4+3]=this.state[A]>>>0&255;return this},g.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},g.prototype._saveState=function(h){for(var y=0;y<this.state.length;y++)h[y]=this.state[y]},g.prototype._restoreState=function(h,y){for(var v=0;v<this.state.length;v++)this.state[v]=h[v];this.bytesHashed=y,this.finished=!1,this.bufferLength=0},g}();e.Hash=s;var i=function(){function g(h){this.inner=new s,this.outer=new s,this.blockSize=this.inner.blockSize,this.digestLength=this.inner.digestLength;var y=new Uint8Array(this.blockSize);if(h.length>this.blockSize)new s().update(h).finish(y).clean();else for(var v=0;v<h.length;v++)y[v]=h[v];for(var v=0;v<y.length;v++)y[v]^=54;this.inner.update(y);for(var v=0;v<y.length;v++)y[v]^=106;this.outer.update(y),this.istate=new Uint32Array(8),this.ostate=new Uint32Array(8),this.inner._saveState(this.istate),this.outer._saveState(this.ostate);for(var v=0;v<y.length;v++)y[v]=0}return g.prototype.reset=function(){return this.inner._restoreState(this.istate,this.inner.blockSize),this.outer._restoreState(this.ostate,this.outer.blockSize),this},g.prototype.clean=function(){for(var h=0;h<this.istate.length;h++)this.ostate[h]=this.istate[h]=0;this.inner.clean(),this.outer.clean()},g.prototype.update=function(h){return this.inner.update(h),this},g.prototype.finish=function(h){return this.outer.finished?this.outer.finish(h):(this.inner.finish(h),this.outer.update(h,this.digestLength).finish(h)),this},g.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},g}();e.HMAC=i;function o(g){var h=new s().update(g),y=h.digest();return h.clean(),y}e.hash=o,e.default=o;function a(g,h){var y=new i(g).update(h),v=y.digest();return y.clean(),v}e.hmac=a;function c(g,h,y,v){var S=v[0];if(S===0)throw new Error("hkdf: cannot expand more");h.reset(),S>1&&h.update(g),y&&h.update(y),h.update(v),h.finish(g),v[0]++}var u=new Uint8Array(e.digestLength);function l(g,h,y,v){h===void 0&&(h=u),v===void 0&&(v=32);for(var S=new Uint8Array([1]),T=a(h,g),j=new i(T),A=new Uint8Array(j.digestLength),N=A.length,z=new Uint8Array(v),E=0;E<v;E++)N===A.length&&(c(A,j,y,S),N=0),z[E]=A[N++];return j.clean(),A.fill(0),S.fill(0),z}e.hkdf=l;function f(g,h,y,v){for(var S=new i(g),T=S.digestLength,j=new Uint8Array(4),A=new Uint8Array(T),N=new Uint8Array(T),z=new Uint8Array(v),E=0;E*T<v;E++){var U=E+1;j[0]=U>>>24&255,j[1]=U>>>16&255,j[2]=U>>>8&255,j[3]=U>>>0&255,S.reset(),S.update(h),S.update(j),S.finish(N);for(var P=0;P<T;P++)A[P]=N[P];for(var P=2;P<=y;P++){S.reset(),S.update(N).finish(N);for(var L=0;L<T;L++)A[L]^=N[L]}for(var P=0;P<T&&E*T+P<v;P++)z[E*T+P]=A[P]}for(var E=0;E<T;E++)A[E]=N[E]=0;for(var E=0;E<4;E++)j[E]=0;return S.clean(),z}e.pbkdf2=f})})(wi);var pf=wi.exports;function mi(n){const e=pf.hash(n);return bf(e)}function yf(n){const e=new TextEncoder,t=bi(n.map(r=>e.encode(r)));return mi(t)}function bf(n){return Array.from(n,e=>e.toString(16).padStart(2,"0")).join("")}function wf(n){if(n.length<2)return null;const e=n[n.length-2];return e==="snapshot"||e==="incremental"?e:null}class mf extends Me{#t;#e=new Map;#r=new Map;#n=!1;#i=Ae("automerge-repo:storage-subsystem");constructor(e){super(),this.#t=e}async id(){const e=await this.#t.load(["storage-adapter-id"]);let t;return e?t=new TextDecoder().decode(e):(t=ns(),await this.#t.save(["storage-adapter-id"],new TextEncoder().encode(t))),t}async load(e,t){const r=[e,t];return await this.#t.load(r)}async save(e,t,r){const s=[e,t];await this.#t.save(s,r)}async remove(e,t){const r=[e,t];await this.#t.remove(r)}async loadDoc(e){const t=await this.#t.loadRange([e]),r=[],s=[];for(const u of t){if(u.data===void 0)continue;const l=wf(u.key);l!=null&&(s.push({key:u.key,type:l,size:u.data.length}),r.push(u.data))}this.#r.set(e,s);const i=bi(r);if(i.length===0)return null;const o=performance.now(),a=Zn($e(),i),c=performance.now();return this.emit("document-loaded",{documentId:e,durationMillis:c-o,...rn(a)}),this.#e.set(e,me(a)),a}async saveDoc(e,t){if(!this.#o(e,t))return;const r=this.#r.get(e)??[];this.#c(r)?await this.#a(e,t,r):await this.#s(e,t),this.#e.set(e,me(t))}async removeDoc(e){await this.#t.removeRange([e,"snapshot"]),await this.#t.removeRange([e,"incremental"]),await this.#t.removeRange([e,"sync-state"])}async#s(e,t){const r=Es(t,this.#e.get(e)??[]);if(r&&r.length>0){const s=[e,"incremental",mi(r)];this.#i(`Saving incremental ${s} for document ${e}`),await this.#t.save(s,r),this.#r.has(e)||this.#r.set(e,[]),this.#r.get(e).push({key:s,type:"incremental",size:r.length}),this.#e.set(e,me(t))}else return Promise.resolve()}async#a(e,t,r){this.#n=!0;const s=Qn(t),i=yf(me(t)),o=[e,"snapshot",i],a=new Set(r.map(u=>u.key).filter(u=>u[2]!==i));this.#i(`Saving snapshot ${o} for document ${e}`),this.#i(`deleting old chunks ${Array.from(a)}`),await this.#t.save(o,s);for(const u of a)await this.#t.remove(u);const c=this.#r.get(e)?.filter(u=>!a.has(u.key))??[];c.push({key:o,type:"snapshot",size:s.length}),this.#r.set(e,c),this.#n=!1}async loadSyncState(e,t){const r=[e,"sync-state",t];try{const s=await this.#t.load(r);return s?tr(s):void 0}catch{this.#i(`Error loading sync state for ${e} from ${t}`);return}}async saveSyncState(e,t,r){const s=[e,"sync-state",t];await this.#t.save(s,er(r))}#o(e,t){const r=this.#e.get(e);if(!r)return!0;const s=me(t);return!vr(s,r)}#c(e){if(this.#n)return!1;let t=0,r=0;for(const s of e)s.type==="snapshot"?t+=s.size:r+=s.size;return t<1024||r>=t}}class vi extends Me{}class vf extends vi{#t;syncDebounceRate=100;#e=[];#r={};#n={};#i={};#s=[];#a=!1;#o;#c;constructor({handle:e,onLoadSyncState:t}){super(),this.#o=e,this.#c=t??(()=>Promise.resolve(void 0));const r=e.documentId.slice(0,5);this.#t=Ae(`automerge-repo:docsync:${r}`),e.on("change",Hn(()=>this.#_(),this.syncDebounceRate)),e.on("ephemeral-message-outbound",s=>this.#p(s)),(async()=>(await e.doc([Ht,jt]),this.#g()))()}get peerStates(){return this.#n}get documentId(){return this.#o.documentId}async#_(){this.#t("syncWithPeers");const e=await this.#o.doc();e!==void 0&&this.#e.forEach(t=>this.#d(t,e))}async#p({data:e}){this.#t("broadcastToPeers",this.#e),this.#e.forEach(t=>this.#y(t,e))}#y(e,t){this.#t(`sendEphemeralMessage ->${e}`);const r={type:"ephemeral",targetId:e,documentId:this.#o.documentId,data:t};this.emit("message",r)}#u(e,t){this.#b(e),e in this.#n||(this.#n[e]="unknown");const r=this.#i[e];if(r){t(r);return}let s=this.#r[e];s||(this.#c(e).then(i=>{this.#w(e,i??xs())}).catch(i=>{this.#t(`Error loading sync state for ${e}: ${i}`)}),s=this.#r[e]=[]),s.push(t)}#b(e){this.#e.includes(e)||(this.#e.push(e),this.emit("open-doc",{documentId:this.documentId,peerId:e}))}#w(e,t){const r=this.#r[e];if(r)for(const s of r)s(t);delete this.#r[e],this.#i[e]=t}#l(e,t){this.#i[e]=t,this.emit("sync-state",{peerId:e,syncState:t,documentId:this.#o.documentId})}#d(e,t){this.#t(`sendSyncMessage ->${e}`),this.#u(e,r=>{const[s,i]=ms(t,r);if(i){this.#l(e,s);const o=me(t).length===0;!this.#o.isReady()&&o&&s.sharedHeads.length===0&&!Object.values(this.#n).includes("has")&&this.#n[e]==="unknown"?this.emit("message",{type:"request",targetId:e,documentId:this.#o.documentId,data:i}):this.emit("message",{type:"sync",targetId:e,data:i,documentId:this.#o.documentId}),o||(this.#n[e]="has")}})}hasPeer(e){return this.#e.includes(e)}beginSync(e){const t=e.every(s=>this.#n[s]in["unavailable","wants"]),r=this.#o.doc([Ht,jt,zn]).then(s=>{if(this.#a=!0,this.#f(),!(s===void 0&&t))return s??$e()});this.#t(`beginSync: ${e.join(", ")}`),e.forEach(s=>{this.#u(s,i=>{const o=tr(er(i));this.#l(s,o),r.then(a=>{a&&this.#d(s,a)}).catch(a=>{this.#t(`Error loading doc for ${s}: ${a}`)})})})}endSync(e){this.#t(`removing peer ${e}`),this.#e=this.#e.filter(t=>t!==e)}receiveMessage(e){switch(e.type){case"sync":case"request":this.receiveSyncMessage(e);break;case"ephemeral":this.receiveEphemeralMessage(e);break;case"doc-unavailable":this.#n[e.senderId]="unavailable",this.#f();break;default:throw new Error(`unknown message type: ${e}`)}}receiveEphemeralMessage(e){if(e.documentId!==this.#o.documentId)throw new Error("channelId doesn't match documentId");const{senderId:t,data:r}=e,s=li(new Uint8Array(r));this.#o.emit("ephemeral-message",{handle:this.#o,senderId:t,message:s}),this.#e.forEach(i=>{i!==t&&this.emit("message",{...e,targetId:i})})}receiveSyncMessage(e){if(e.documentId!==this.#o.documentId)throw new Error("channelId doesn't match documentId");if(!this.#o.inState([Ht,jt,zn])){this.#s.push({message:e,received:new Date});return}this.#g(),this.#h(e)}#h(e){pi(e)&&(this.#n[e.senderId]="wants"),this.#f(),ks(e.data).heads.length>0&&(this.#n[e.senderId]="has"),this.#u(e.senderId,t=>{this.#o.update(r=>{const s=performance.now(),[i,o]=vs(r,t,e.data),a=performance.now();return this.emit("metrics",{type:"receive-sync-message",documentId:this.#o.documentId,durationMillis:a-s,...rn(r)}),this.#l(e.senderId,o),this.#d(e.senderId,r),i}),this.#f()})}#f(){this.#a&&this.#o.inState([jt])&&this.#e.every(e=>this.#n[e]==="unavailable"||this.#n[e]==="wants")&&(this.#e.filter(e=>this.#n[e]==="wants").forEach(e=>{const t={type:"doc-unavailable",documentId:this.#o.documentId,targetId:e};this.emit("message",t)}),this.#o.unavailable())}#g(){for(const e of this.#s)this.#h(e.message);this.#s=[]}metrics(){return{peers:this.#e,size:this.#o.metrics()}}}const vn=Ae("automerge-repo:collectionsync");class xf extends vi{repo;#t=new Set;docSynchronizers={};#e={};#r;constructor(e,t=[]){super(),this.repo=e,this.#r=t.map(r=>fn(r).documentId)}#n(e){if(!this.docSynchronizers[e]){const t=this.repo.find(pr({documentId:e}));this.docSynchronizers[e]=this.#i(t)}return this.docSynchronizers[e]}#i(e){const t=new vf({handle:e,onLoadSyncState:async r=>{if(!this.repo.storageSubsystem)return;const{storageId:s,isEphemeral:i}=this.repo.peerMetadataByPeerId[r]||{};if(!(!s||i))return this.repo.storageSubsystem.loadSyncState(e.documentId,s)}});return t.on("message",r=>this.emit("message",r)),t.on("open-doc",r=>this.emit("open-doc",r)),t.on("sync-state",r=>this.emit("sync-state",r)),t.on("metrics",r=>this.emit("metrics",r)),t}async#s(e){const t=Array.from(this.#t),r=[];for(const s of t)await this.repo.sharePolicy(s,e)&&r.push(s);return r}async receiveMessage(e){vn(`onSyncMessage: ${e.senderId}, ${e.documentId}, ${"data"in e?e.data.byteLength+"bytes":""}`);const t=e.documentId;if(!t)throw new Error("received a message with an invalid documentId");if(this.#r.includes(t)){this.emit("metrics",{type:"doc-denied",documentId:t}),this.emit("message",{type:"doc-unavailable",documentId:t,targetId:e.senderId});return}this.#e[t]=!0;const r=this.#n(t);r.receiveMessage(e);const s=await this.#s(t);r.beginSync(s.filter(i=>!r.hasPeer(i)))}addDocument(e){if(this.#e[e])return;const t=this.#n(e);this.#s(e).then(r=>{t.beginSync(r)})}removeDocument(e){throw new Error("not implemented")}addPeer(e){if(vn(`adding ${e} & synchronizing with them`),!this.#t.has(e)){this.#t.add(e);for(const t of Object.values(this.docSynchronizers)){const{documentId:r}=t;this.repo.sharePolicy(e,r).then(s=>{s&&t.beginSync([e])})}}}removePeer(e){vn(`removing peer ${e}`),this.#t.delete(e);for(const t of Object.values(this.docSynchronizers))t.endSync(e)}get peers(){return Array.from(this.#t)}metrics(){return Object.fromEntries(Object.entries(this.docSynchronizers).map(([e,t])=>[e,t.metrics()]))}}function Sf(){return"peer-"+Math.random().toString(36).slice(4)}class kf extends Me{#t;networkSubsystem;storageSubsystem;saveDebounceRate=100;#e={};synchronizer;sharePolicy=async()=>!0;peerMetadataByPeerId={};#r=new cf;#n=!1;constructor({storage:e,network:t=[],peerId:r=Sf(),sharePolicy:s,isEphemeral:i=e===void 0,enableRemoteHeadsGossiping:o=!1,denylist:a=[]}={}){super(),this.#n=o,this.#t=Ae("automerge-repo:repo"),this.sharePolicy=s??this.sharePolicy,this.on("delete-document",({documentId:f})=>{c&&c.removeDoc(f).catch(g=>{this.#t("error deleting document",{documentId:f,err:g})})}),this.synchronizer=new xf(this,a),this.synchronizer.on("message",f=>{this.#t(`sending ${f.type} message to ${f.targetId}`),l.send(f)}),this.synchronizer.on("metrics",f=>this.emit("doc-metrics",f)),this.#n&&this.synchronizer.on("open-doc",({peerId:f,documentId:g})=>{this.#r.subscribePeerToDoc(f,g)});const c=e?new mf(e):void 0;c&&c.on("document-loaded",f=>this.emit("doc-metrics",{type:"doc-loaded",...f})),this.storageSubsystem=c;const u=(async()=>({storageId:await c?.id(),isEphemeral:i}))(),l=new _f(t,r,u);this.networkSubsystem=l,l.on("peer",async({peerId:f,peerMetadata:g})=>{this.#t("peer connected",{peerId:f}),g&&(this.peerMetadataByPeerId[f]={...g}),this.sharePolicy(f).then(h=>{h&&this.#n&&this.#r.addGenerousPeer(f)}).catch(h=>{console.log("error in share policy",{err:h})}),this.synchronizer.addPeer(f)}),l.on("peer-disconnected",({peerId:f})=>{this.synchronizer.removePeer(f),this.#r.removePeer(f)}),l.on("message",async f=>{this.#s(f)}),this.synchronizer.on("sync-state",f=>{this.#o(f);const g=this.#e[f.documentId],{storageId:h}=this.peerMetadataByPeerId[f.peerId]||{};if(!h)return;const y=g.getRemoteHeads(h);f.syncState.theirHeads&&(!y||!vr(y,f.syncState.theirHeads))&&f.syncState.theirHeads&&(g.setRemoteHeads(h,f.syncState.theirHeads),h&&this.#n&&this.#r.handleImmediateRemoteHeadsChanged(f.documentId,h,f.syncState.theirHeads))}),this.#n&&(this.#r.on("notify-remote-heads",f=>{this.networkSubsystem.send({type:"remote-heads-changed",targetId:f.targetId,documentId:f.documentId,newHeads:{[f.storageId]:{heads:f.heads,timestamp:f.timestamp}}})}),this.#r.on("change-remote-subs",f=>{this.#t("change-remote-subs",f);for(const g of f.peers)this.networkSubsystem.send({type:"remote-subscription-change",targetId:g,add:f.add,remove:f.remove})}),this.#r.on("remote-heads-changed",f=>{this.#e[f.documentId].setRemoteHeads(f.storageId,f.remoteHeads)}))}#i(e){const{storageSubsystem:t}=this;if(t){const r=({handle:s,doc:i})=>{t.saveDoc(s.documentId,i)};e.on("heads-changed",Hn(r,this.saveDebounceRate))}e.on("unavailable",()=>{this.#t("document unavailable",{documentId:e.documentId}),this.emit("unavailable-document",{documentId:e.documentId})}),this.synchronizer.addDocument(e.documentId),this.emit("document",{handle:e})}#s(e){switch(e.type){case"remote-subscription-change":this.#n&&this.#r.handleControlMessage(e);break;case"remote-heads-changed":this.#n&&this.#r.handleRemoteHeads(e);break;case"sync":case"request":case"ephemeral":case"doc-unavailable":this.synchronizer.receiveMessage(e).catch(t=>{console.log("error receiving message",{err:t})})}}#a={};#o(e){if(!this.storageSubsystem)return;const{storageId:t,isEphemeral:r}=this.peerMetadataByPeerId[e.peerId]||{};if(!t||r)return;let s=this.#a[t];s||(s=this.#a[t]=Hn(({documentId:i,syncState:o})=>{this.storageSubsystem.saveSyncState(i,t,o)},this.saveDebounceRate)),s(e)}#c({documentId:e}){if(this.#e[e])return this.#e[e];if(!e)throw new Error(`Invalid documentId ${e}`);const t=new Xc(e);return this.#e[e]=t,t}get handles(){return this.#e}get peers(){return this.synchronizer.peers}getStorageIdOfPeer(e){return this.peerMetadataByPeerId[e]?.storageId}create(e){const{documentId:t}=fn(Cc()),r=this.#c({documentId:t});return this.#i(r),r.update(()=>{let s;return e?s=Rs(e):s=_s($e()),s}),r.doneLoading(),r}clone(e){if(!e.isReady())throw new Error(`Cloned handle is not yet in ready state.
        (Try await handle.whenReady() first.)`);const t=e.docSync();if(!t)throw new Error("Cloned handle doesn't have a document.");const r=this.create();return r.update(()=>En(t)),r}find(e){const t=pn(e);if(this.#e[t])return this.#e[t].isUnavailable()&&setTimeout(()=>{this.#e[t].emit("unavailable",{handle:this.#e[t]})}),this.#e[t];const r=this.#c({documentId:t});return(this.storageSubsystem?this.storageSubsystem.loadDoc(r.documentId):Promise.resolve(null)).then(async i=>{i?(r.update(()=>i),r.doneLoading()):(await this.networkSubsystem.whenReady(),r.request()),this.#i(r)}).catch(i=>{this.#t("error waiting for network",{err:i})}),r}delete(e){const t=pn(e);this.#c({documentId:t}).delete(),delete this.#e[t],this.emit("delete-document",{documentId:t})}async export(e){const t=pn(e),s=await this.#c({documentId:t}).doc();if(s)return Qn(s)}import(e){const t=Os(e),r=this.create();return r.update(()=>En(t)),r}subscribeToRemotes=e=>{this.#n?(this.#t("subscribeToRemotes",{remotes:e}),this.#r.subscribeToRemotes(e)):this.#t("WARN: subscribeToRemotes called but remote heads gossiping is not enabled")};storageId=async()=>{if(this.storageSubsystem)return this.storageSubsystem.id()};async flush(e){if(!this.storageSubsystem)return;const t=e?e.map(r=>this.#e[r]):Object.values(this.#e);await Promise.all(t.map(async r=>{const s=r.docSync();if(s)return this.storageSubsystem.saveDoc(r.documentId,s)}))}async removeFromCache(e){if(!this.#e[e]){this.#t(`WARN: removeFromCache called but handle not found in handleCache for documentId: ${e}`);return}const t=this.#c({documentId:e});await t.doc([Ht,Qc,ef,zn])?(t.isReady()?t.unload():this.#t(`WARN: removeFromCache called but handle for documentId: ${e} in unexpected state: ${t.state}`),delete this.#e[e]):this.#t(`WARN: removeFromCache called but doc undefined for documentId: ${e}`)}shutdown(){return this.networkSubsystem.adapters.forEach(e=>{e.disconnect()}),this.flush()}metrics(){return{documents:this.synchronizer.metrics()}}}class xi extends Me{peerId;peerMetadata}class Ef{database;store;dbPromise;constructor(e="automerge",t="documents"){this.database=e,this.store=t,this.dbPromise=this.createDatabasePromise()}createDatabasePromise(){return new Promise((e,t)=>{const r=indexedDB.open(this.database,1);r.onerror=()=>{t(r.error)},r.onupgradeneeded=s=>{s.target.result.createObjectStore(this.store)},r.onsuccess=s=>{const i=s.target.result;e(i)}})}async load(e){const r=(await this.dbPromise).transaction(this.store),i=r.objectStore(this.store).get(e);return new Promise((o,a)=>{r.onerror=()=>{a(i.error)},i.onsuccess=c=>{const u=c.target.result;u&&typeof u=="object"&&"binary"in u?o(u.binary):o(void 0)}})}async save(e,t){const s=(await this.dbPromise).transaction(this.store,"readwrite");return s.objectStore(this.store).put({key:e,binary:t},e),new Promise((o,a)=>{s.onerror=()=>{a(s.error)},s.oncomplete=()=>{o()}})}async remove(e){const r=(await this.dbPromise).transaction(this.store,"readwrite");return r.objectStore(this.store).delete(e),new Promise((i,o)=>{r.onerror=()=>{o(r.error)},r.oncomplete=()=>{i()}})}async loadRange(e){const t=await this.dbPromise,r=e,s=[...e,"￿"],i=IDBKeyRange.bound(r,s),o=t.transaction(this.store),c=o.objectStore(this.store).openCursor(i),u=[];return new Promise((l,f)=>{o.onerror=()=>{f(c.error)},c.onsuccess=g=>{const h=g.target.result;h?(u.push({data:h.value.binary,key:h.key}),h.continue()):l(u)}})}async removeRange(e){const t=await this.dbPromise,r=e,s=[...e,"￿"],i=IDBKeyRange.bound(r,s),o=t.transaction(this.store,"readwrite");return o.objectStore(this.store).delete(i),new Promise((c,u)=>{o.onerror=()=>{u(o.error)},o.oncomplete=()=>{c()}})}}var Xe=null;typeof WebSocket<"u"?Xe=WebSocket:typeof MozWebSocket<"u"?Xe=MozWebSocket:typeof global<"u"?Xe=global.WebSocket||global.MozWebSocket:typeof window<"u"?Xe=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(Xe=self.WebSocket||self.MozWebSocket);const xn=Xe,Af=n=>n.type==="peer",Cf=n=>n.type==="error",If="1";function Ie(n,e="Assertion failed"){if(n===!1||n===null||n===void 0){const t=new Error(Rf(e));throw t.stack=Of(t.stack,"assert.ts"),t}}const Rf=n=>n.split(`
`).map(e=>e.trim()).join(`
`),Of=(n="",e)=>n.split(`
`).filter(t=>!t.includes(e)).join(`
`),Tf=n=>{const{buffer:e,byteOffset:t,byteLength:r}=n;return e.slice(t,t+r)};class jf extends xi{socket}class Si extends jf{url;retryInterval;#t=!1;#e;#r=new Promise(e=>{this.#e=e});isReady(){return this.#t}whenReady(){return this.#r}#n(){this.#t||(this.#t=!0,this.#e?.())}#i;#s=Ae("automerge-repo:websocket:browser");remotePeerId;constructor(e,t=5e3){super(),this.url=e,this.retryInterval=t,this.#s=this.#s.extend(e)}connect(e,t){!this.socket||!this.peerId?(this.#s("connecting"),this.peerId=e,this.peerMetadata=t??{}):(this.#s("reconnecting"),Ie(e===this.peerId),this.socket.removeEventListener("open",this.onOpen),this.socket.removeEventListener("close",this.onClose),this.socket.removeEventListener("message",this.onMessage),this.socket.removeEventListener("error",this.onError)),this.#i||(this.#i=setInterval(()=>{this.connect(e,t)},this.retryInterval)),this.socket=new xn(this.url),this.socket.binaryType="arraybuffer",this.socket.addEventListener("open",this.onOpen),this.socket.addEventListener("close",this.onClose),this.socket.addEventListener("message",this.onMessage),this.socket.addEventListener("error",this.onError),setTimeout(()=>this.#n(),1e3),this.join()}onOpen=()=>{this.#s("open"),clearInterval(this.#i),this.#i=void 0,this.join()};onClose=()=>{this.#s("close"),this.remotePeerId&&this.emit("peer-disconnected",{peerId:this.remotePeerId}),this.retryInterval>0&&!this.#i&&setTimeout(()=>(Ie(this.peerId),this.connect(this.peerId,this.peerMetadata)),this.retryInterval)};onMessage=e=>{this.receiveMessage(e.data)};onError=e=>{if("error"in e&&e.error.code!=="ECONNREFUSED")throw e.error;this.#s("Connection failed, retrying...")};join(){Ie(this.peerId),Ie(this.socket),this.socket.readyState===xn.OPEN&&this.send(Mf(this.peerId,this.peerMetadata))}disconnect(){Ie(this.peerId),Ie(this.socket);const e=this.socket;e&&(e.removeEventListener("open",this.onOpen),e.removeEventListener("close",this.onClose),e.removeEventListener("message",this.onMessage),e.removeEventListener("error",this.onError),e.close()),clearInterval(this.#i),this.remotePeerId&&this.emit("peer-disconnected",{peerId:this.remotePeerId}),this.socket=void 0}send(e){if("data"in e&&e.data?.byteLength===0)throw new Error("Tried to send a zero-length message");if(Ie(this.peerId),!this.socket){this.#s("Tried to send on a disconnected socket.");return}if(this.socket.readyState!==xn.OPEN)throw new Error(`Websocket not ready (${this.socket.readyState})`);const t=_i(e);this.socket.send(Tf(t))}peerCandidate(e,t){Ie(this.socket),this.#n(),this.remotePeerId=e,this.emit("peer-candidate",{peerId:e,peerMetadata:t})}receiveMessage(e){const t=Kc(new Uint8Array(e));if(Ie(this.socket),e.byteLength===0)throw new Error("received a zero-length message");if(Af(t)){const{peerMetadata:r}=t;this.#s(`peer: ${t.senderId}`),this.peerCandidate(t.senderId,r)}else Cf(t)?this.#s(`error: ${t.message}`):this.emit("message",t)}}function Mf(n,e){return{type:"join",senderId:n,peerMetadata:e,supportedProtocolVersions:[If]}}Ae("WebsocketServer");class Df extends Me{port;isDisconnected=!1;constructor(e){e.addEventListener("message",t=>{this.isDisconnected||this.emit("message",t)}),super(),this.port=e}postMessage(e,t){this.isDisconnected||this.port.postMessage(e,t)}start(){this.isDisconnected=!1,this.port.start()}stop(){this.isDisconnected=!0}isAlive(){return!0}}class Uf extends Me{weakRef;isDisconnected=!1;constructor(e){super(),this.weakRef=new WeakRef(e),e.addEventListener("message",t=>{this.isDisconnected||this.emit("message",t)})}postMessage(e,t){const r=this.weakRef.deref();if(!r){this.disconnnect();return}if(!this.isDisconnected)try{r.postMessage(e,t)}catch{this.disconnnect()}}start(){const e=this.weakRef.deref();if(!e){this.disconnnect();return}this.isDisconnected=!1;try{e.start()}catch{this.disconnnect()}}stop(){this.isDisconnected=!0}disconnnect(){this.isDisconnected||(this.emit("close"),this.isDisconnected=!0)}isAlive(){return this.isDisconnected?!1:this.weakRef.deref()?!0:(this.disconnnect(),!1)}}const es=Ae("automerge-repo:messagechannel");class Pf extends xi{channels={};messagePortRef;#t=!1;#e;#r=new Promise(e=>{this.#e=e});#n;isReady(){return this.#t}whenReady(){return this.#r}#i(){this.#t||(this.#t=!0,this.#e?.())}constructor(e,t={}){super();const r=t.useWeakRef??!1;this.messagePortRef=r?new Uf(e):new Df(e)}connect(e,t){es("messageport connecting"),this.peerId=e,this.peerMetadata=t,this.messagePortRef.start(),this.messagePortRef.addListener("message",r=>{es("message port received %o",r.data);const s=r.data;if("targetId"in s&&s.targetId!==this.peerId)throw new Error("MessagePortNetwork should never receive messages for a different peer.");const{senderId:i,type:o}=s;switch(o){case"arrive":{const{peerMetadata:a}=s;this.messagePortRef.postMessage({type:"welcome",senderId:this.peerId,peerMetadata:this.peerMetadata,targetId:i}),this.announceConnection(i,a)}break;case"welcome":{const{peerMetadata:a}=s;this.announceConnection(i,a)}break;case"leave":this.#n===i&&this.emit("peer-disconnected",{peerId:i});break;default:"data"in s?this.emit("message",{...s,data:s.data?new Uint8Array(s.data):void 0}):this.emit("message",s);break}}),this.messagePortRef.addListener("close",()=>{this.emit("close")}),this.messagePortRef.postMessage({senderId:this.peerId,type:"arrive",peerMetadata:t}),setTimeout(()=>{this.#i()},100)}send(e){if("data"in e){const t=e.data.buffer.slice(e.data.byteOffset,e.data.byteOffset+e.data.byteLength);this.messagePortRef.postMessage({...e,data:t},[t])}else this.messagePortRef.postMessage(e)}announceConnection(e,t){this.#n=e,this.#i(),this.emit("peer-candidate",{peerId:e,peerMetadata:t})}disconnect(){this.#n&&this.peerId&&(this.messagePortRef.postMessage({type:"leave",senderId:this.peerId}),this.emit("peer-disconnected",{peerId:this.#n})),this.messagePortRef.stop()}}const ki="v6";async function $f(){await Gn(Ei),console.log("Creating repo");const n=new kf({storage:new Ef,network:[new Si("wss://sync.automerge.org")],peerId:"service-worker-"+Math.round(Math.random()*1e6),sharePolicy:async e=>e.includes("storage-server")});return self.Automerge=Ts,self.repo=n,n}console.log("Before registration");const et=$f();et.then(n=>{self.repo=n,self.Automerge=Ts});self.addEventListener("install",n=>{console.log("Installing SW"),self.skipWaiting()});self.addEventListener("message",async n=>{if(console.log("Client messaged",n.data),n.data&&n.data.type==="INIT_PORT"){const e=n.ports[0];(await et).networkSubsystem.addNetworkAdapter(new Pf(e,{useWeakRef:!0}))}});function Lf(n){et.then(e=>e.networkSubsystem.addNetworkAdapter(new Si(n)))}self.addSyncServer=Lf;async function Bf(){const n=[ki],t=(await caches.keys()).map(r=>{if(!n.includes(r))return caches.delete(r)});await Promise.all(t)}self.addEventListener("activate",async n=>{console.log("Activating service worker."),await Bf(),clients.claim()});self.addEventListener("fetch",async n=>{const e=new URL(n.request.url),t=e.pathname.match(new RegExp("^.*/automerge-repo/(automerge:.*)"));t?n.respondWith((async()=>{let[r,...s]=t[1].split("/");if(!Bt(r))return new Response(`Invalid Automerge URL
${r}`,{status:500,headers:{"Content-Type":"text/plain"}});const i=(await et).find(r);await i.whenReady();const o=await i.doc();if(!o)return new Response(`Document unavailable.
${r}: ${i.state}`,{status:500,headers:{"Content-Type":"text/plain"}});if(s[0]==="package.json")return new Response(JSON.stringify(o),{headers:{"Content-Type":"application/json"}});let a;if(o.docs?a=await s.reduce(async(c,u)=>{let l=(await c)?.docs?.find(f=>f.name===u);return Bt(l?.url)&&(l=await(await et).find(l.url).doc()),l},o):a=await s.reduce(async(c,u)=>{let l=(await c)?.[u];return Bt(l)&&(l=await(await et).find(l).doc()),l},o),!a)return new Response(`Not found
Object path: ${s}
${JSON.stringify(o,null,2)}`,{status:404,headers:{"Content-Type":"text/plain"}});if(a?.content?.type==="link"){const c=await fetch(a.content.url);return new Response(c.body,{headers:{"Content-Type":c.headers.get("Content-Type")}})}else if(a?.content){const c={svg:"image/svg+xml",html:"text/html",json:"application/json",js:"application/javascript",css:"text/css",md:"text/markdown",txt:"text/plain","":"text/plain"}[a.type];return new Response(a.content.value,{headers:{"Content-Type":c}})}return a.contentType?new Response(a.contents,{headers:{"Content-Type":a.contentType}}):typeof a=="string"?new Response(a,{headers:{"Content-Type":"text/plain"}}):new Response(JSON.stringify(a),{headers:{"Content-Type":"application/json"}})})()):n.request.method==="GET"&&e.origin===self.location.origin&&n.respondWith((async()=>{const r=await caches.match(n.request);if(console.log(`[Service Worker] Fetching resource from cache: ${n.request.url}`),r)return r;const s=await fetch(n.request);return await caches.open(ki),console.log(`[Service Worker] Caching new resource: ${n.request.url}`),s})())});
