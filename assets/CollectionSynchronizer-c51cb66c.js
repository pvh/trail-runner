import{g as Qr,c as Fn}from"./_commonjsHelpers-de833af9.js";import{i as Vn,e as $n,g as ot,d as zn,c as Hn,b as Kn,f as Wn,h as Gn,j as Or,k as Jn,m as qn,r as Qn}from"./index-195180a9.js";import{d as Ye}from"./browser-f8dbb0d6.js";var Yr={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function s(o,c,l){this.fn=o,this.context=c,this.once=l||!1}function i(o,c,l,y,d){if(typeof l!="function")throw new TypeError("The listener must be a function");var u=new s(l,y||o,d),p=r?r+c:c;return o._events[p]?o._events[p].fn?o._events[p]=[o._events[p],u]:o._events[p].push(u):(o._events[p]=u,o._eventsCount++),o}function a(o,c){--o._eventsCount===0?o._events=new n:delete o._events[c]}function f(){this._events=new n,this._eventsCount=0}f.prototype.eventNames=function(){var c=[],l,y;if(this._eventsCount===0)return c;for(y in l=this._events)e.call(l,y)&&c.push(r?y.slice(1):y);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(l)):c},f.prototype.listeners=function(c){var l=r?r+c:c,y=this._events[l];if(!y)return[];if(y.fn)return[y.fn];for(var d=0,u=y.length,p=new Array(u);d<u;d++)p[d]=y[d].fn;return p},f.prototype.listenerCount=function(c){var l=r?r+c:c,y=this._events[l];return y?y.fn?1:y.length:0},f.prototype.emit=function(c,l,y,d,u,p){var g=r?r+c:c;if(!this._events[g])return!1;var w=this._events[g],S=arguments.length,A,x;if(w.fn){switch(w.once&&this.removeListener(c,w.fn,void 0,!0),S){case 1:return w.fn.call(w.context),!0;case 2:return w.fn.call(w.context,l),!0;case 3:return w.fn.call(w.context,l,y),!0;case 4:return w.fn.call(w.context,l,y,d),!0;case 5:return w.fn.call(w.context,l,y,d,u),!0;case 6:return w.fn.call(w.context,l,y,d,u,p),!0}for(x=1,A=new Array(S-1);x<S;x++)A[x-1]=arguments[x];w.fn.apply(w.context,A)}else{var M=w.length,L;for(x=0;x<M;x++)switch(w[x].once&&this.removeListener(c,w[x].fn,void 0,!0),S){case 1:w[x].fn.call(w[x].context);break;case 2:w[x].fn.call(w[x].context,l);break;case 3:w[x].fn.call(w[x].context,l,y);break;case 4:w[x].fn.call(w[x].context,l,y,d);break;default:if(!A)for(L=1,A=new Array(S-1);L<S;L++)A[L-1]=arguments[L];w[x].fn.apply(w[x].context,A)}}return!0},f.prototype.on=function(c,l,y){return i(this,c,l,y,!1)},f.prototype.once=function(c,l,y){return i(this,c,l,y,!0)},f.prototype.removeListener=function(c,l,y,d){var u=r?r+c:c;if(!this._events[u])return this;if(!l)return a(this,u),this;var p=this._events[u];if(p.fn)p.fn===l&&(!d||p.once)&&(!y||p.context===y)&&a(this,u);else{for(var g=0,w=[],S=p.length;g<S;g++)(p[g].fn!==l||d&&!p[g].once||y&&p[g].context!==y)&&w.push(p[g]);w.length?this._events[u]=w.length===1?w[0]:w:a(this,u)}return this},f.prototype.removeAllListeners=function(c){var l;return c?(l=r?r+c:c,this._events[l]&&a(this,l)):(this._events=new n,this._eventsCount=0),this},f.prototype.off=f.prototype.removeListener,f.prototype.addListener=f.prototype.on,f.prefixed=r,f.EventEmitter=f,t.exports=f})(Yr);var Yn=Yr.exports;const Xr=Qr(Yn);/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var D=function(){return D=Object.assign||function(e){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},D.apply(this,arguments)};function hr(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(t);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(t,n[s])&&(r[n[s]]=t[n[s]]);return r}function W(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function G(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),s,i=[],a;try{for(;(e===void 0||e-- >0)&&!(s=n.next()).done;)i.push(s.value)}catch(f){a={error:f}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return i}function Y(t,e,r){if(r||arguments.length===2)for(var n=0,s=e.length,i;n<s;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return t.concat(i||Array.prototype.slice.call(e))}var Q;(function(t){t.Start="xstate.start",t.Stop="xstate.stop",t.Raise="xstate.raise",t.Send="xstate.send",t.Cancel="xstate.cancel",t.NullEvent="",t.Assign="xstate.assign",t.After="xstate.after",t.DoneState="done.state",t.DoneInvoke="done.invoke",t.Log="xstate.log",t.Init="xstate.init",t.Invoke="xstate.invoke",t.ErrorExecution="error.execution",t.ErrorCommunication="error.communication",t.ErrorPlatform="error.platform",t.ErrorCustom="xstate.error",t.Update="xstate.update",t.Pure="xstate.pure",t.Choose="xstate.choose"})(Q||(Q={}));var Be;(function(t){t.Parent="#_parent",t.Internal="#_internal"})(Be||(Be={}));var Yt=Q.Start,dr=Q.Stop,it=Q.Raise,Dt=Q.Send,Zr=Q.Cancel,Xn=Q.NullEvent,yr=Q.Assign;Q.After;Q.DoneState;var en=Q.Log,Zn=Q.Init,Xt=Q.Invoke;Q.ErrorExecution;var Tr=Q.ErrorPlatform,ei=Q.ErrorCustom,tn=Q.Update,ti=Q.Choose,ri=Q.Pure,rn=".",Ur={},Zt="xstate.guard",ni="",ft;function pr(t,e,r){r===void 0&&(r=rn);var n=Xe(t,r),s=Xe(e,r);return q(s)?q(n)?s===n:!1:q(n)?n in s:Object.keys(n).every(function(i){return i in s?pr(n[i],s[i]):!1})}function nn(t){try{return q(t)||typeof t=="number"?"".concat(t):t.type}catch{throw new Error("Events must be strings or objects with a string event.type property.")}}function er(t,e){try{return $e(t)?t:t.toString().split(e)}catch{throw new Error("'".concat(t,"' is not a valid state path."))}}function ii(t){return typeof t=="object"&&"value"in t&&"context"in t&&"event"in t&&"_event"in t}function Xe(t,e){if(ii(t))return t.value;if($e(t))return Et(t);if(typeof t!="string")return t;var r=er(t,e);return Et(r)}function Et(t){if(t.length===1)return t[0];for(var e={},r=e,n=0;n<t.length-1;n++)n===t.length-2?r[t[n]]=t[n+1]:(r[t[n]]={},r=r[t[n]]);return e}function We(t,e){for(var r={},n=Object.keys(t),s=0;s<n.length;s++){var i=n[s];r[i]=e(t[i],i,t,s)}return r}function _r(t,e,r){var n,s,i={};try{for(var a=W(Object.keys(t)),f=a.next();!f.done;f=a.next()){var o=f.value,c=t[o];r(c)&&(i[o]=e(c,o,t))}}catch(l){n={error:l}}finally{try{f&&!f.done&&(s=a.return)&&s.call(a)}finally{if(n)throw n.error}}return i}var si=function(t){return function(e){var r,n,s=e;try{for(var i=W(t),a=i.next();!a.done;a=i.next()){var f=a.value;s=s[f]}}catch(o){r={error:o}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return s}};function ai(t,e){return function(r){var n,s,i=r;try{for(var a=W(t),f=a.next();!f.done;f=a.next()){var o=f.value;i=i[e][o]}}catch(c){n={error:c}}finally{try{f&&!f.done&&(s=a.return)&&s.call(a)}finally{if(n)throw n.error}}return i}}function vt(t){if(!t)return[[]];if(q(t))return[[t]];var e=Z(Object.keys(t).map(function(r){var n=t[r];return typeof n!="string"&&(!n||!Object.keys(n).length)?[[r]]:vt(t[r]).map(function(s){return[r].concat(s)})}));return e}function Z(t){var e;return(e=[]).concat.apply(e,Y([],G(t),!1))}function sn(t){return $e(t)?t:[t]}function pe(t){return t===void 0?[]:sn(t)}function At(t,e,r){var n,s;if(J(t))return t(e,r.data);var i={};try{for(var a=W(Object.keys(t)),f=a.next();!f.done;f=a.next()){var o=f.value,c=t[o];J(c)?i[o]=c(e,r.data):i[o]=c}}catch(l){n={error:l}}finally{try{f&&!f.done&&(s=a.return)&&s.call(a)}finally{if(n)throw n.error}}return i}function oi(t){return/^(done|error)\./.test(t)}function Ir(t){return!!(t instanceof Promise||t!==null&&(J(t)||typeof t=="object")&&J(t.then))}function fi(t){return t!==null&&typeof t=="object"&&"transition"in t&&typeof t.transition=="function"}function ui(t,e){var r,n,s=G([[],[]],2),i=s[0],a=s[1];try{for(var f=W(t),o=f.next();!o.done;o=f.next()){var c=o.value;e(c)?i.push(c):a.push(c)}}catch(l){r={error:l}}finally{try{o&&!o.done&&(n=f.return)&&n.call(f)}finally{if(r)throw r.error}}return[i,a]}function an(t,e){return We(t.states,function(r,n){if(r){var s=(q(e)?void 0:e[n])||(r?r.current:void 0);if(s)return{current:s,states:an(r,s)}}})}function ci(t,e){return{current:e,states:an(t,e)}}function kr(t,e,r,n){var s=t&&r.reduce(function(i,a){var f,o,c=a.assignment,l={state:n,action:a,_event:e},y={};if(J(c))y=c(i,e.data,l);else try{for(var d=W(Object.keys(c)),u=d.next();!u.done;u=d.next()){var p=u.value,g=c[p];y[p]=J(g)?g(i,e.data,l):g}}catch(w){f={error:w}}finally{try{u&&!u.done&&(o=d.return)&&o.call(d)}finally{if(f)throw f.error}}return Object.assign({},i,y)},t);return s}var li=function(){};function $e(t){return Array.isArray(t)}function J(t){return typeof t=="function"}function q(t){return typeof t=="string"}function on(t,e){if(t)return q(t)?{type:Zt,name:t,predicate:e?e[t]:void 0}:J(t)?{type:Zt,name:t.name,predicate:t}:t}function hi(t){try{return"subscribe"in t&&J(t.subscribe)}catch{return!1}}var Ae=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();ft={},ft[Ae]=function(){return this},ft[Symbol.observable]=function(){return this};function Fe(t){return!!t&&"__xstatenode"in t}function di(t){return!!t&&typeof t.send=="function"}function Mt(t,e){return q(t)||typeof t=="number"?D({type:t},e):t}function oe(t,e){if(!q(t)&&"$$type"in t&&t.$$type==="scxml")return t;var r=Mt(t);return D({name:r.type,data:r,$$type:"scxml",type:"external"},e)}function ke(t,e){var r=sn(e).map(function(n){return typeof n>"u"||typeof n=="string"||Fe(n)?{target:n,event:t}:D(D({},n),{event:t})});return r}function yi(t){if(!(t===void 0||t===ni))return pe(t)}function fn(t,e,r,n,s){var i=t.options.guards,a={state:s,cond:e,_event:n};if(e.type===Zt)return(i?.[e.name]||e.predicate)(r,n.data,a);var f=i?.[e.type];if(!f)throw new Error("Guard '".concat(e.type,"' is not implemented on machine '").concat(t.id,"'."));return f(r,n.data,a)}function un(t){return typeof t=="string"?{type:t}:t}function gt(t,e,r){var n=function(){},s=typeof t=="object",i=s?t:null;return{next:((s?t.next:t)||n).bind(i),error:((s?t.error:e)||n).bind(i),complete:((s?t.complete:r)||n).bind(i)}}function ut(t,e){return"".concat(t,":invocation[").concat(e,"]")}function tr(t){return(t.type===it||t.type===Dt&&t.to===Be.Internal)&&typeof t.delay!="number"}var Ce=oe({type:Zn});function rr(t,e){return e&&e[t]||void 0}function Ze(t,e){var r;if(q(t)||typeof t=="number"){var n=rr(t,e);J(n)?r={type:t,exec:n}:n?r=n:r={type:t,exec:void 0}}else if(J(t))r={type:t.name||t.toString(),exec:t};else{var n=rr(t.type,e);if(J(n))r=D(D({},t),{exec:n});else if(n){var s=n.type||t.type;r=D(D(D({},n),t),{type:s})}else r=t}return r}var Oe=function(t,e){if(!t)return[];var r=$e(t)?t:[t];return r.map(function(n){return Ze(n,e)})};function vr(t){var e=Ze(t);return D(D({id:q(t)?t:e.id},e),{type:e.type})}function pi(t,e){return{type:it,event:typeof t=="function"?t:Mt(t),delay:e?e.delay:void 0,id:e?.id}}function vi(t,e,r,n){var s={_event:r},i=oe(J(t.event)?t.event(e,r.data,s):t.event),a;if(q(t.delay)){var f=n&&n[t.delay];a=J(f)?f(e,r.data,s):f}else a=J(t.delay)?t.delay(e,r.data,s):t.delay;return D(D({},t),{type:it,_event:i,delay:a})}function gi(t,e){return{to:e?e.to:void 0,type:Dt,event:J(t)?t:Mt(t),delay:e?e.delay:void 0,id:e&&e.id!==void 0?e.id:J(t)?t.name:nn(t)}}function xi(t,e,r,n){var s={_event:r},i=oe(J(t.event)?t.event(e,r.data,s):t.event),a;if(q(t.delay)){var f=n&&n[t.delay];a=J(f)?f(e,r.data,s):f}else a=J(t.delay)?t.delay(e,r.data,s):t.delay;var o=J(t.to)?t.to(e,r.data,s):t.to;return D(D({},t),{to:o,_event:i,event:i.data,delay:a})}var bi=function(t,e,r){return D(D({},t),{value:q(t.expr)?t.expr:t.expr(e,r.data,{_event:r})})},wi=function(t){return{type:Zr,sendId:t}};function mi(t){var e=vr(t);return{type:Q.Start,activity:e,exec:void 0}}function Si(t){var e=J(t)?t:vr(t);return{type:Q.Stop,activity:e,exec:void 0}}function Ei(t,e,r){var n=J(t.activity)?t.activity(e,r.data):t.activity,s=typeof n=="string"?{id:n}:n,i={type:Q.Stop,activity:s};return i}var Ai=function(t){return{type:yr,assignment:t}};function Oi(t,e){var r=e?"#".concat(e):"";return"".concat(Q.After,"(").concat(t,")").concat(r)}function ct(t,e){var r="".concat(Q.DoneState,".").concat(t),n={type:r,data:e};return n.toString=function(){return r},n}function xt(t,e){var r="".concat(Q.DoneInvoke,".").concat(t),n={type:r,data:e};return n.toString=function(){return r},n}function Ge(t,e){var r="".concat(Q.ErrorPlatform,".").concat(t),n={type:r,data:e};return n.toString=function(){return r},n}var Ti=function(t){var e,r,n=[];try{for(var s=W(t),i=s.next();!i.done;i=s.next())for(var a=i.value,f=0;f<a.actions.length;){if(a.actions[f].type===yr){n.push(a.actions[f]),a.actions.splice(f,1);continue}f++}}catch(o){e={error:o}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}return n};function Ot(t,e,r,n,s,i,a){a===void 0&&(a=!1);var f=a?[]:Ti(s),o=f.length?kr(r,n,f,e):r,c=a?[r]:void 0,l=[];function y(p,g){var w;switch(g.type){case it:{var S=vi(g,o,n,t.options.delays);return i&&typeof S.delay=="number"&&i(S,o,n),S}case Dt:var A=xi(g,o,n,t.options.delays);return i&&A.to!==Be.Internal&&(p==="entry"?l.push(A):i(A,o,n)),A;case en:{var x=bi(g,o,n);return i?.(x,o,n),x}case ti:{var M=g,L=(w=M.conds.find(function(_){var O=on(_.cond,t.options.guards);return!O||fn(t,O,o,n,i?void 0:e)}))===null||w===void 0?void 0:w.actions;if(!L)return[];var m=G(Ot(t,e,o,n,[{type:p,actions:Oe(pe(L),t.options.actions)}],i,a),2),U=m[0],I=m[1];return o=I,c?.push(o),U}case ri:{var L=g.get(o,n.data);if(!L)return[];var k=G(Ot(t,e,o,n,[{type:p,actions:Oe(pe(L),t.options.actions)}],i,a),2),j=k[0],P=k[1];return o=P,c?.push(o),j}case dr:{var x=Ei(g,o,n);return i?.(x,r,n),x}case yr:{o=kr(o,n,[g],i?void 0:e),c?.push(o);break}default:var V=Ze(g,t.options.actions),v=V.exec;if(i)i(V,o,n);else if(v&&c){var R=c.length-1,T=D(D({},V),{exec:function(_){for(var O=[],C=1;C<arguments.length;C++)O[C-1]=arguments[C];v.apply(void 0,Y([c[R]],G(O),!1))}});V=T}return V}}function d(p){var g,w,S=[];try{for(var A=W(p.actions),x=A.next();!x.done;x=A.next()){var M=x.value,L=y(p.type,M);L&&(S=S.concat(L))}}catch(m){g={error:m}}finally{try{x&&!x.done&&(w=A.return)&&w.call(A)}finally{if(g)throw g.error}}return l.forEach(function(m){i(m,o,n)}),l.length=0,S}var u=Z(s.map(d));return[u,o]}var Rr=[],Ne=function(t,e){Rr.push(t);var r=e(t);return Rr.pop(),r};function cn(t){var e;return e={id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},getSnapshot:function(){},toJSON:function(){return{id:t}}},e[Ae]=function(){return this},e}function Ui(t,e,r,n){var s,i=un(t.src),a=(s=e?.options.services)===null||s===void 0?void 0:s[i.type],f=t.data?At(t.data,r,n):void 0,o=a?ln(a,t.id,f):cn(t.id);return o.meta=t,o}function ln(t,e,r){var n=cn(e);if(n.deferred=!0,Fe(t)){var s=n.state=Ne(void 0,function(){return(r?t.withContext(r):t).initialState});n.getSnapshot=function(){return s}}return n}function _i(t){try{return typeof t.send=="function"}catch{return!1}}function Ii(t){return _i(t)&&"id"in t}function ki(t){var e;return D((e={subscribe:function(){return{unsubscribe:function(){}}},id:"anonymous",getSnapshot:function(){}},e[Ae]=function(){return this},e),t)}var Tt=function(t){return t.type==="atomic"||t.type==="final"};function hn(t){return Object.keys(t.states).map(function(e){return t.states[e]})}function et(t){return hn(t).filter(function(e){return e.type!=="history"})}function dn(t){var e=[t];return Tt(t)?e:e.concat(Z(et(t).map(dn)))}function Je(t,e){var r,n,s,i,a,f,o,c,l=new Set(t),y=nr(l),d=new Set(e);try{for(var u=W(d),p=u.next();!p.done;p=u.next())for(var g=p.value,w=g.parent;w&&!d.has(w);)d.add(w),w=w.parent}catch(k){r={error:k}}finally{try{p&&!p.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}var S=nr(d);try{for(var A=W(d),x=A.next();!x.done;x=A.next()){var g=x.value;if(g.type==="compound"&&(!S.get(g)||!S.get(g).length))y.get(g)?y.get(g).forEach(function(j){return d.add(j)}):g.initialStateNodes.forEach(function(j){return d.add(j)});else if(g.type==="parallel")try{for(var M=(a=void 0,W(et(g))),L=M.next();!L.done;L=M.next()){var m=L.value;d.has(m)||(d.add(m),y.get(m)?y.get(m).forEach(function(j){return d.add(j)}):m.initialStateNodes.forEach(function(j){return d.add(j)}))}}catch(j){a={error:j}}finally{try{L&&!L.done&&(f=M.return)&&f.call(M)}finally{if(a)throw a.error}}}}catch(k){s={error:k}}finally{try{x&&!x.done&&(i=A.return)&&i.call(A)}finally{if(s)throw s.error}}try{for(var U=W(d),I=U.next();!I.done;I=U.next())for(var g=I.value,w=g.parent;w&&!d.has(w);)d.add(w),w=w.parent}catch(k){o={error:k}}finally{try{I&&!I.done&&(c=U.return)&&c.call(U)}finally{if(o)throw o.error}}return d}function yn(t,e){var r=e.get(t);if(!r)return{};if(t.type==="compound"){var n=r[0];if(n){if(Tt(n))return n.key}else return{}}var s={};return r.forEach(function(i){s[i.key]=yn(i,e)}),s}function nr(t){var e,r,n=new Map;try{for(var s=W(t),i=s.next();!i.done;i=s.next()){var a=i.value;n.has(a)||n.set(a,[]),a.parent&&(n.has(a.parent)||n.set(a.parent,[]),n.get(a.parent).push(a))}}catch(f){e={error:f}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}return n}function Ri(t,e){var r=Je([t],e);return yn(t,nr(r))}function qe(t,e){return Array.isArray(t)?t.some(function(r){return r===e}):t instanceof Set?t.has(e):!1}function Di(t){return Y([],G(new Set(Z(Y([],G(t.map(function(e){return e.ownEvents})),!1)))),!1)}function bt(t,e){return e.type==="compound"?et(e).some(function(r){return r.type==="final"&&qe(t,r)}):e.type==="parallel"?et(e).every(function(r){return bt(t,r)}):!1}function Mi(t){return t===void 0&&(t=[]),t.reduce(function(e,r){return r.meta!==void 0&&(e[r.id]=r.meta),e},{})}function Dr(t){return new Set(Z(t.map(function(e){return e.tags})))}function pn(t,e){if(t===e)return!0;if(t===void 0||e===void 0)return!1;if(q(t)||q(e))return t===e;var r=Object.keys(t),n=Object.keys(e);return r.length===n.length&&r.every(function(s){return pn(t[s],e[s])})}function Li(t){return typeof t!="object"||t===null?!1:"value"in t&&"_event"in t}function Ni(t,e){var r=t.exec,n=D(D({},t),{exec:r!==void 0?function(){return r(e.context,e.event,{action:t,state:e,_event:e._event})}:void 0});return n}var xe=function(){function t(e){var r=this,n;this.actions=[],this.activities=Ur,this.meta={},this.events=[],this.value=e.value,this.context=e.context,this._event=e._event,this._sessionid=e._sessionid,this.event=this._event.data,this.historyValue=e.historyValue,this.history=e.history,this.actions=e.actions||[],this.activities=e.activities||Ur,this.meta=Mi(e.configuration),this.events=e.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=e.configuration,this.transitions=e.transitions,this.children=e.children,this.done=!!e.done,this.tags=(n=Array.isArray(e.tags)?new Set(e.tags):e.tags)!==null&&n!==void 0?n:new Set,this.machine=e.machine,Object.defineProperty(this,"nextEvents",{get:function(){return Di(r.configuration)}})}return t.from=function(e,r){if(e instanceof t)return e.context!==r?new t({value:e.value,context:r,_event:e._event,_sessionid:null,historyValue:e.historyValue,history:e.history,actions:[],activities:e.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):e;var n=Ce;return new t({value:e,context:r,_event:n,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},t.create=function(e){return new t(e)},t.inert=function(e,r){if(e instanceof t){if(!e.actions.length)return e;var n=Ce;return new t({value:e.value,context:r,_event:n,_sessionid:null,historyValue:e.historyValue,history:e.history,activities:e.activities,configuration:e.configuration,transitions:[],children:{}})}return t.from(e,r)},t.prototype.toStrings=function(e,r){var n=this;if(e===void 0&&(e=this.value),r===void 0&&(r="."),q(e))return[e];var s=Object.keys(e);return s.concat.apply(s,Y([],G(s.map(function(i){return n.toStrings(e[i],r).map(function(a){return i+r+a})})),!1))},t.prototype.toJSON=function(){var e=this;e.configuration,e.transitions;var r=e.tags;e.machine;var n=hr(e,["configuration","transitions","tags","machine"]);return D(D({},n),{tags:Array.from(r)})},t.prototype.matches=function(e){return pr(e,this.value)},t.prototype.hasTag=function(e){return this.tags.has(e)},t.prototype.can=function(e){var r;li(!!this.machine);var n=(r=this.machine)===null||r===void 0?void 0:r.getTransitionData(this,e);return!!n?.transitions.length&&n.transitions.some(function(s){return s.target!==void 0||s.actions.length})},t}(),ji={deferEvents:!1},Mr=function(){function t(e){this.processingEvent=!1,this.queue=[],this.initialized=!1,this.options=D(D({},ji),e)}return t.prototype.initialize=function(e){if(this.initialized=!0,e){if(!this.options.deferEvents){this.schedule(e);return}this.process(e)}this.flushEvents()},t.prototype.schedule=function(e){if(!this.initialized||this.processingEvent){this.queue.push(e);return}if(this.queue.length!==0)throw new Error("Event queue should be empty when it is not processing events");this.process(e),this.flushEvents()},t.prototype.clear=function(){this.queue=[]},t.prototype.flushEvents=function(){for(var e=this.queue.shift();e;)this.process(e),e=this.queue.shift()},t.prototype.process=function(e){this.processingEvent=!0;try{e()}catch(r){throw this.clear(),r}finally{this.processingEvent=!1}},t}(),Ct=new Map,Pi=0,ze={bookId:function(){return"x:".concat(Pi++)},register:function(t,e){return Ct.set(t,e),t},get:function(t){return Ct.get(t)},free:function(t){Ct.delete(t)}};function gr(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global}function Ci(){var t=gr();if(t&&"__xstate__"in t)return t.__xstate__}function Bi(t){if(gr()){var e=Ci();e&&e.register(t)}}function Fi(t,e){e===void 0&&(e={});var r=t.initialState,n=new Set,s=[],i=!1,a=function(){if(!i){for(i=!0;s.length>0;){var c=s.shift();r=t.transition(r,c,o),n.forEach(function(l){return l.next(r)})}i=!1}},f=ki({id:e.id,send:function(c){s.push(c),a()},getSnapshot:function(){return r},subscribe:function(c,l,y){var d=gt(c,l,y);return n.add(d),d.next(r),{unsubscribe:function(){n.delete(d)}}}}),o={parent:e.parent,self:f,id:e.id||"anonymous",observers:n};return r=t.start?t.start(o):r,f}var Vi={sync:!1,autoForward:!1},ie;(function(t){t[t.NotStarted=0]="NotStarted",t[t.Running=1]="Running",t[t.Stopped=2]="Stopped"})(ie||(ie={}));var $i=function(){function t(e,r){r===void 0&&(r=t.defaultOptions);var n=this;this.machine=e,this.delayedEventsMap={},this.listeners=new Set,this.contextListeners=new Set,this.stopListeners=new Set,this.doneListeners=new Set,this.eventListeners=new Set,this.sendListeners=new Set,this.initialized=!1,this.status=ie.NotStarted,this.children=new Map,this.forwardTo=new Set,this._outgoingQueue=[],this.init=this.start,this.send=function(l,y){if($e(l))return n.batch(l),n.state;var d=oe(Mt(l,y));if(n.status===ie.Stopped)return n.state;if(n.status!==ie.Running&&!n.options.deferEvents)throw new Error('Event "'.concat(d.name,'" was sent to uninitialized service "').concat(n.machine.id,`". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.
Event: `).concat(JSON.stringify(d.data)));return n.scheduler.schedule(function(){n.forward(d);var u=n._nextState(d);n.update(u,d)}),n._state},this.sendTo=function(l,y,d){var u=n.parent&&(y===Be.Parent||n.parent.id===y),p=u?n.parent:q(y)?y===Be.Internal?n:n.children.get(y)||ze.get(y):di(y)?y:void 0;if(!p){if(!u)throw new Error("Unable to send event to child '".concat(y,"' from service '").concat(n.id,"'."));return}if("machine"in p){if(n.status!==ie.Stopped||n.parent!==p||n.state.done){var g=D(D({},l),{name:l.name===ei?"".concat(Ge(n.id)):l.name,origin:n.sessionId});!d&&n.machine.config.predictableActionArguments?n._outgoingQueue.push([p,g]):p.send(g)}}else!d&&n.machine.config.predictableActionArguments?n._outgoingQueue.push([p,l.data]):p.send(l.data)},this._exec=function(l,y,d,u){u===void 0&&(u=n.machine.options.actions);var p=l.exec||rr(l.type,u),g=J(p)?p:p?p.exec:l.exec;if(g)try{return g(y,d.data,n.machine.config.predictableActionArguments?{action:l,_event:d}:{action:l,state:n.state,_event:d})}catch(R){throw n.parent&&n.parent.send({type:"xstate.error",data:R}),R}switch(l.type){case it:{var w=l;n.defer(w);break}case Dt:var S=l;if(typeof S.delay=="number"){n.defer(S);return}else S.to?n.sendTo(S._event,S.to,d===Ce):n.send(S._event);break;case Zr:n.cancel(l.sendId);break;case Yt:{if(n.status!==ie.Running)return;var A=l.activity;if(!n.machine.config.predictableActionArguments&&!n.state.activities[A.id||A.type])break;if(A.type===Q.Invoke){var x=un(A.src),M=n.machine.options.services?n.machine.options.services[x.type]:void 0,L=A.id,m=A.data,U="autoForward"in A?A.autoForward:!!A.forward;if(!M)return;var I=m?At(m,y,d):void 0;if(typeof M=="string")return;var k=J(M)?M(y,d.data,{data:I,src:x,meta:A.meta}):M;if(!k)return;var j=void 0;Fe(k)&&(k=I?k.withContext(I):k,j={autoForward:U}),n.spawn(k,L,j)}else n.spawnActivity(A);break}case dr:{n.stopChild(l.activity.id);break}case en:var P=l,V=P.label,v=P.value;V?n.logger(V,v):n.logger(v);break}};var s=D(D({},t.defaultOptions),r),i=s.clock,a=s.logger,f=s.parent,o=s.id,c=o!==void 0?o:e.id;this.id=c,this.logger=a,this.clock=i,this.parent=f,this.options=s,this.scheduler=new Mr({deferEvents:this.options.deferEvents}),this.sessionId=ze.bookId()}return Object.defineProperty(t.prototype,"initialState",{get:function(){var e=this;return this._initialState?this._initialState:Ne(this,function(){return e._initialState=e.machine.initialState,e._initialState})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),t.prototype.execute=function(e,r){var n,s;try{for(var i=W(e.actions),a=i.next();!a.done;a=i.next()){var f=a.value;this.exec(f,e,r)}}catch(o){n={error:o}}finally{try{a&&!a.done&&(s=i.return)&&s.call(i)}finally{if(n)throw n.error}}},t.prototype.update=function(e,r){var n,s,i,a,f,o,c,l,y=this;if(e._sessionid=this.sessionId,this._state=e,(!this.machine.config.predictableActionArguments||r===Ce)&&this.options.execute)this.execute(this.state);else for(var d=void 0;d=this._outgoingQueue.shift();)d[0].send(d[1]);if(this.children.forEach(function(k){y.state.children[k.id]=k}),this.devTools&&this.devTools.send(r.data,e),e.event)try{for(var u=W(this.eventListeners),p=u.next();!p.done;p=u.next()){var g=p.value;g(e.event)}}catch(k){n={error:k}}finally{try{p&&!p.done&&(s=u.return)&&s.call(u)}finally{if(n)throw n.error}}try{for(var w=W(this.listeners),S=w.next();!S.done;S=w.next()){var g=S.value;g(e,e.event)}}catch(k){i={error:k}}finally{try{S&&!S.done&&(a=w.return)&&a.call(w)}finally{if(i)throw i.error}}try{for(var A=W(this.contextListeners),x=A.next();!x.done;x=A.next()){var M=x.value;M(this.state.context,this.state.history?this.state.history.context:void 0)}}catch(k){f={error:k}}finally{try{x&&!x.done&&(o=A.return)&&o.call(A)}finally{if(f)throw f.error}}if(this.state.done){var L=e.configuration.find(function(k){return k.type==="final"&&k.parent===y.machine}),m=L&&L.doneData?At(L.doneData,e.context,r):void 0;this._doneEvent=xt(this.id,m);try{for(var U=W(this.doneListeners),I=U.next();!I.done;I=U.next()){var g=I.value;g(this._doneEvent)}}catch(k){c={error:k}}finally{try{I&&!I.done&&(l=U.return)&&l.call(U)}finally{if(c)throw c.error}}this._stop(),this._stopChildren(),ze.free(this.sessionId)}},t.prototype.onTransition=function(e){return this.listeners.add(e),this.status===ie.Running&&e(this.state,this.state.event),this},t.prototype.subscribe=function(e,r,n){var s=this,i=gt(e,r,n);this.listeners.add(i.next),this.status!==ie.NotStarted&&i.next(this.state);var a=function(){s.doneListeners.delete(a),s.stopListeners.delete(a),i.complete()};return this.status===ie.Stopped?i.complete():(this.onDone(a),this.onStop(a)),{unsubscribe:function(){s.listeners.delete(i.next),s.doneListeners.delete(a),s.stopListeners.delete(a)}}},t.prototype.onEvent=function(e){return this.eventListeners.add(e),this},t.prototype.onSend=function(e){return this.sendListeners.add(e),this},t.prototype.onChange=function(e){return this.contextListeners.add(e),this},t.prototype.onStop=function(e){return this.stopListeners.add(e),this},t.prototype.onDone=function(e){return this.status===ie.Stopped&&this._doneEvent?e(this._doneEvent):this.doneListeners.add(e),this},t.prototype.off=function(e){return this.listeners.delete(e),this.eventListeners.delete(e),this.sendListeners.delete(e),this.stopListeners.delete(e),this.doneListeners.delete(e),this.contextListeners.delete(e),this},t.prototype.start=function(e){var r=this;if(this.status===ie.Running)return this;this.machine._init(),ze.register(this.sessionId,this),this.initialized=!0,this.status=ie.Running;var n=e===void 0?this.initialState:Ne(this,function(){return Li(e)?r.machine.resolveState(e):r.machine.resolveState(xe.from(e,r.machine.context))});return this.options.devTools&&this.attachDev(),this.scheduler.initialize(function(){r.update(n,Ce)}),this},t.prototype._stopChildren=function(){this.children.forEach(function(e){J(e.stop)&&e.stop()}),this.children.clear()},t.prototype._stop=function(){var e,r,n,s,i,a,f,o,c,l;try{for(var y=W(this.listeners),d=y.next();!d.done;d=y.next()){var u=d.value;this.listeners.delete(u)}}catch(U){e={error:U}}finally{try{d&&!d.done&&(r=y.return)&&r.call(y)}finally{if(e)throw e.error}}try{for(var p=W(this.stopListeners),g=p.next();!g.done;g=p.next()){var u=g.value;u(),this.stopListeners.delete(u)}}catch(U){n={error:U}}finally{try{g&&!g.done&&(s=p.return)&&s.call(p)}finally{if(n)throw n.error}}try{for(var w=W(this.contextListeners),S=w.next();!S.done;S=w.next()){var u=S.value;this.contextListeners.delete(u)}}catch(U){i={error:U}}finally{try{S&&!S.done&&(a=w.return)&&a.call(w)}finally{if(i)throw i.error}}try{for(var A=W(this.doneListeners),x=A.next();!x.done;x=A.next()){var u=x.value;this.doneListeners.delete(u)}}catch(U){f={error:U}}finally{try{x&&!x.done&&(o=A.return)&&o.call(A)}finally{if(f)throw f.error}}if(!this.initialized)return this;this.initialized=!1,this.status=ie.Stopped,this._initialState=void 0;try{for(var M=W(Object.keys(this.delayedEventsMap)),L=M.next();!L.done;L=M.next()){var m=L.value;this.clock.clearTimeout(this.delayedEventsMap[m])}}catch(U){c={error:U}}finally{try{L&&!L.done&&(l=M.return)&&l.call(M)}finally{if(c)throw c.error}}this.scheduler.clear(),this.scheduler=new Mr({deferEvents:this.options.deferEvents})},t.prototype.stop=function(){var e=this,r=this.scheduler;return this._stop(),r.schedule(function(){var n=oe({type:"xstate.stop"}),s=Ne(e,function(){var i=Z(Y([],G(e.state.configuration),!1).sort(function(l,y){return y.order-l.order}).map(function(l){return Oe(l.onExit,e.machine.options.actions)})),a=G(Ot(e.machine,e.state,e.state.context,n,[{type:"exit",actions:i}],e.machine.config.predictableActionArguments?e._exec:void 0,e.machine.config.predictableActionArguments||e.machine.config.preserveActionOrder),2),f=a[0],o=a[1],c=new xe({value:e.state.value,context:o,_event:n,_sessionid:e.sessionId,historyValue:void 0,history:e.state,actions:f.filter(function(l){return!tr(l)}),activities:{},events:[],configuration:[],transitions:[],children:{},done:e.state.done,tags:e.state.tags,machine:e.machine});return c.changed=!0,c});e.update(s,n),e._stopChildren(),ze.free(e.sessionId)}),this},t.prototype.batch=function(e){var r=this;if(!(this.status===ie.NotStarted&&this.options.deferEvents)){if(this.status!==ie.Running)throw new Error("".concat(e.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.'))}if(e.length){var n=!!this.machine.config.predictableActionArguments&&this._exec;this.scheduler.schedule(function(){var s,i,a=r.state,f=!1,o=[],c=function(u){var p=oe(u);r.forward(p),a=Ne(r,function(){return r.machine.transition(a,p,void 0,n||void 0)}),o.push.apply(o,Y([],G(r.machine.config.predictableActionArguments?a.actions:a.actions.map(function(g){return Ni(g,a)})),!1)),f=f||!!a.changed};try{for(var l=W(e),y=l.next();!y.done;y=l.next()){var d=y.value;c(d)}}catch(u){s={error:u}}finally{try{y&&!y.done&&(i=l.return)&&i.call(l)}finally{if(s)throw s.error}}a.changed=f,a.actions=o,r.update(a,oe(e[e.length-1]))})}},t.prototype.sender=function(e){return this.send.bind(this,e)},t.prototype._nextState=function(e,r){var n=this;r===void 0&&(r=!!this.machine.config.predictableActionArguments&&this._exec);var s=oe(e);if(s.name.indexOf(Tr)===0&&!this.state.nextEvents.some(function(a){return a.indexOf(Tr)===0}))throw s.data.data;var i=Ne(this,function(){return n.machine.transition(n.state,s,void 0,r||void 0)});return i},t.prototype.nextState=function(e){return this._nextState(e,!1)},t.prototype.forward=function(e){var r,n;try{for(var s=W(this.forwardTo),i=s.next();!i.done;i=s.next()){var a=i.value,f=this.children.get(a);if(!f)throw new Error("Unable to forward event '".concat(e,"' from interpreter '").concat(this.id,"' to nonexistant child '").concat(a,"'."));f.send(e)}}catch(o){r={error:o}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}},t.prototype.defer=function(e){var r=this,n=this.clock.setTimeout(function(){"to"in e&&e.to?r.sendTo(e._event,e.to,!0):r.send(e._event)},e.delay);e.id&&(this.delayedEventsMap[e.id]=n)},t.prototype.cancel=function(e){this.clock.clearTimeout(this.delayedEventsMap[e]),delete this.delayedEventsMap[e]},t.prototype.exec=function(e,r,n){n===void 0&&(n=this.machine.options.actions),this._exec(e,r.context,r._event,n)},t.prototype.removeChild=function(e){var r;this.children.delete(e),this.forwardTo.delete(e),(r=this.state)===null||r===void 0||delete r.children[e]},t.prototype.stopChild=function(e){var r=this.children.get(e);r&&(this.removeChild(e),J(r.stop)&&r.stop())},t.prototype.spawn=function(e,r,n){if(this.status!==ie.Running)return ln(e,r);if(Ir(e))return this.spawnPromise(Promise.resolve(e),r);if(J(e))return this.spawnCallback(e,r);if(Ii(e))return this.spawnActor(e,r);if(hi(e))return this.spawnObservable(e,r);if(Fe(e))return this.spawnMachine(e,D(D({},n),{id:r}));if(fi(e))return this.spawnBehavior(e,r);throw new Error('Unable to spawn entity "'.concat(r,'" of type "').concat(typeof e,'".'))},t.prototype.spawnMachine=function(e,r){var n=this;r===void 0&&(r={});var s=new t(e,D(D({},this.options),{parent:this,id:r.id||e.id})),i=D(D({},Vi),r);i.sync&&s.onTransition(function(f){n.send(tn,{state:f,id:s.id})});var a=s;return this.children.set(s.id,a),i.autoForward&&this.forwardTo.add(s.id),s.onDone(function(f){n.removeChild(s.id),n.send(oe(f,{origin:s.id}))}).start(),a},t.prototype.spawnBehavior=function(e,r){var n=Fi(e,{id:r,parent:this});return this.children.set(r,n),n},t.prototype.spawnPromise=function(e,r){var n,s=this,i=!1,a;e.then(function(o){i||(a=o,s.removeChild(r),s.send(oe(xt(r,o),{origin:r})))},function(o){if(!i){s.removeChild(r);var c=Ge(r,o);try{s.send(oe(c,{origin:r}))}catch{s.devTools&&s.devTools.send(c,s.state),s.machine.strict&&s.stop()}}});var f=(n={id:r,send:function(){},subscribe:function(o,c,l){var y=gt(o,c,l),d=!1;return e.then(function(u){d||(y.next(u),!d&&y.complete())},function(u){d||y.error(u)}),{unsubscribe:function(){return d=!0}}},stop:function(){i=!0},toJSON:function(){return{id:r}},getSnapshot:function(){return a}},n[Ae]=function(){return this},n);return this.children.set(r,f),f},t.prototype.spawnCallback=function(e,r){var n,s=this,i=!1,a=new Set,f=new Set,o,c=function(d){o=d,f.forEach(function(u){return u(d)}),!i&&s.send(oe(d,{origin:r}))},l;try{l=e(c,function(d){a.add(d)})}catch(d){this.send(Ge(r,d))}if(Ir(l))return this.spawnPromise(l,r);var y=(n={id:r,send:function(d){return a.forEach(function(u){return u(d)})},subscribe:function(d){var u=gt(d);return f.add(u.next),{unsubscribe:function(){f.delete(u.next)}}},stop:function(){i=!0,J(l)&&l()},toJSON:function(){return{id:r}},getSnapshot:function(){return o}},n[Ae]=function(){return this},n);return this.children.set(r,y),y},t.prototype.spawnObservable=function(e,r){var n,s=this,i,a=e.subscribe(function(o){i=o,s.send(oe(o,{origin:r}))},function(o){s.removeChild(r),s.send(oe(Ge(r,o),{origin:r}))},function(){s.removeChild(r),s.send(oe(xt(r),{origin:r}))}),f=(n={id:r,send:function(){},subscribe:function(o,c,l){return e.subscribe(o,c,l)},stop:function(){return a.unsubscribe()},getSnapshot:function(){return i},toJSON:function(){return{id:r}}},n[Ae]=function(){return this},n);return this.children.set(r,f),f},t.prototype.spawnActor=function(e,r){return this.children.set(r,e),e},t.prototype.spawnActivity=function(e){var r=this.machine.options&&this.machine.options.activities?this.machine.options.activities[e.type]:void 0;if(r){var n=r(this.state.context,e);this.spawnEffect(e.id,n)}},t.prototype.spawnEffect=function(e,r){var n;this.children.set(e,(n={id:e,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},stop:r||void 0,getSnapshot:function(){},toJSON:function(){return{id:e}}},n[Ae]=function(){return this},n))},t.prototype.attachDev=function(){var e=gr();if(this.options.devTools&&e){if(e.__REDUX_DEVTOOLS_EXTENSION__){var r=typeof this.options.devTools=="object"?this.options.devTools:void 0;this.devTools=e.__REDUX_DEVTOOLS_EXTENSION__.connect(D(D({name:this.id,autoPause:!0,stateSanitizer:function(n){return{value:n.value,context:n.context,actions:n.actions}}},r),{features:D({jump:!1,skip:!1},r?r.features:void 0)}),this.machine),this.devTools.init(this.state)}Bi(this)}},t.prototype.toJSON=function(){return{id:this.id}},t.prototype[Ae]=function(){return this},t.prototype.getSnapshot=function(){return this.status===ie.NotStarted?this.initialState:this._state},t.defaultOptions={execute:!0,deferEvents:!0,clock:{setTimeout:function(e,r){return setTimeout(e,r)},clearTimeout:function(e){return clearTimeout(e)}},logger:console.log.bind(console),devTools:!1},t.interpret=vn,t}();function vn(t,e){var r=new $i(t,e);return r}function zi(t){if(typeof t=="string"){var e={type:t};return e.toString=function(){return t},e}return t}function lt(t){return D(D({type:Xt},t),{toJSON:function(){t.onDone,t.onError;var e=hr(t,["onDone","onError"]);return D(D({},e),{type:Xt,src:zi(t.src)})}})}var ht="",ir="#",Bt="*",Re={},De=function(t){return t[0]===ir},Hi=function(){return{actions:{},guards:{},services:{},activities:{},delays:{}}},Ki=function(){function t(e,r,n,s){n===void 0&&(n="context"in e?e.context:void 0);var i=this,a;this.config=e,this._context=n,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign(Hi(),r),this.parent=s?.parent,this.key=this.config.key||s?.key||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:rn),this.id=this.config.id||Y([this.machine.key],G(this.path),!1).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:(a=this.config.schema)!==null&&a!==void 0?a:{},this.description=this.config.description,this.initial=this.config.initial,this.states=this.config.states?We(this.config.states,function(c,l){var y,d=new t(c,{},void 0,{parent:i,key:l});return Object.assign(i.idMap,D((y={},y[d.id]=d,y),d.idMap)),d}):Re;var f=0;function o(c){var l,y;c.order=f++;try{for(var d=W(hn(c)),u=d.next();!u.done;u=d.next()){var p=u.value;o(p)}}catch(g){l={error:g}}finally{try{u&&!u.done&&(y=d.return)&&y.call(d)}finally{if(l)throw l.error}}}o(this),this.history=this.config.history===!0?"shallow":this.config.history||!1,this._transient=!!this.config.always||(this.config.on?Array.isArray(this.config.on)?this.config.on.some(function(c){var l=c.event;return l===ht}):ht in this.config.on:!1),this.strict=!!this.config.strict,this.onEntry=pe(this.config.entry||this.config.onEntry).map(function(c){return Ze(c)}),this.onExit=pe(this.config.exit||this.config.onExit).map(function(c){return Ze(c)}),this.meta=this.config.meta,this.doneData=this.type==="final"?this.config.data:void 0,this.invoke=pe(this.config.invoke).map(function(c,l){var y,d;if(Fe(c)){var u=ut(i.id,l);return i.machine.options.services=D((y={},y[u]=c,y),i.machine.options.services),lt({src:u,id:u})}else if(q(c.src)){var u=c.id||ut(i.id,l);return lt(D(D({},c),{id:u,src:c.src}))}else if(Fe(c.src)||J(c.src)){var u=c.id||ut(i.id,l);return i.machine.options.services=D((d={},d[u]=c.src,d),i.machine.options.services),lt(D(D({id:u},c),{src:u}))}else{var p=c.src;return lt(D(D({id:ut(i.id,l)},c),{src:p}))}}),this.activities=pe(this.config.activities).concat(this.invoke).map(function(c){return vr(c)}),this.transition=this.transition.bind(this),this.tags=pe(this.config.tags)}return t.prototype._init=function(){this.__cache.transitions||dn(this).forEach(function(e){return e.on})},t.prototype.withConfig=function(e,r){var n=this.options,s=n.actions,i=n.activities,a=n.guards,f=n.services,o=n.delays;return new t(this.config,{actions:D(D({},s),e.actions),activities:D(D({},i),e.activities),guards:D(D({},a),e.guards),services:D(D({},f),e.services),delays:D(D({},o),e.delays)},r??this.context)},t.prototype.withContext=function(e){return new t(this.config,this.options,e)},Object.defineProperty(t.prototype,"context",{get:function(){return J(this._context)?this._context():this._context},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:We(this.states,function(e){return e.definition}),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return this.definition},Object.defineProperty(t.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var e=this.transitions;return this.__cache.on=e.reduce(function(r,n){return r[n.eventType]=r[n.eventType]||[],r[n.eventType].push(n),r},{})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),t.prototype.getCandidates=function(e){if(this.__cache.candidates[e])return this.__cache.candidates[e];var r=e===ht,n=this.transitions.filter(function(s){var i=s.eventType===e;return r?i:i||s.eventType===Bt});return this.__cache.candidates[e]=n,n},t.prototype.getDelayedTransitions=function(){var e=this,r=this.config.after;if(!r)return[];var n=function(i,a){var f=J(i)?"".concat(e.id,":delay[").concat(a,"]"):i,o=Oi(f,e.id);return e.onEntry.push(gi(o,{delay:i})),e.onExit.push(wi(o)),o},s=$e(r)?r.map(function(i,a){var f=n(i.delay,a);return D(D({},i),{event:f})}):Z(Object.keys(r).map(function(i,a){var f=r[i],o=q(f)?{target:f}:f,c=isNaN(+i)?i:+i,l=n(c,a);return pe(o).map(function(y){return D(D({},y),{event:l,delay:c})})}));return s.map(function(i){var a=i.delay;return D(D({},e.formatTransition(i)),{delay:a})})},t.prototype.getStateNodes=function(e){var r,n=this;if(!e)return[];var s=e instanceof xe?e.value:Xe(e,this.delimiter);if(q(s)){var i=this.getStateNode(s).initial;return i!==void 0?this.getStateNodes((r={},r[s]=i,r)):[this,this.states[s]]}var a=Object.keys(s),f=[this];return f.push.apply(f,Y([],G(Z(a.map(function(o){return n.getStateNode(o).getStateNodes(s[o])}))),!1)),f},t.prototype.handles=function(e){var r=nn(e);return this.events.includes(r)},t.prototype.resolveState=function(e){var r=e instanceof xe?e:xe.create(e),n=Array.from(Je([],this.getStateNodes(r.value)));return new xe(D(D({},r),{value:this.resolve(r.value),configuration:n,done:bt(n,this),tags:Dr(n),machine:this.machine}))},t.prototype.transitionLeafNode=function(e,r,n){var s=this.getStateNode(e),i=s.next(r,n);return!i||!i.transitions.length?this.next(r,n):i},t.prototype.transitionCompoundNode=function(e,r,n){var s=Object.keys(e),i=this.getStateNode(s[0]),a=i._transition(e[s[0]],r,n);return!a||!a.transitions.length?this.next(r,n):a},t.prototype.transitionParallelNode=function(e,r,n){var s,i,a={};try{for(var f=W(Object.keys(e)),o=f.next();!o.done;o=f.next()){var c=o.value,l=e[c];if(l){var y=this.getStateNode(c),d=y._transition(l,r,n);d&&(a[c]=d)}}}catch(S){s={error:S}}finally{try{o&&!o.done&&(i=f.return)&&i.call(f)}finally{if(s)throw s.error}}var u=Object.keys(a).map(function(S){return a[S]}),p=Z(u.map(function(S){return S.transitions})),g=u.some(function(S){return S.transitions.length>0});if(!g)return this.next(r,n);var w=Z(Object.keys(a).map(function(S){return a[S].configuration}));return{transitions:p,exitSet:Z(u.map(function(S){return S.exitSet})),configuration:w,source:r,actions:Z(Object.keys(a).map(function(S){return a[S].actions}))}},t.prototype._transition=function(e,r,n){return q(e)?this.transitionLeafNode(e,r,n):Object.keys(e).length===1?this.transitionCompoundNode(e,r,n):this.transitionParallelNode(e,r,n)},t.prototype.getTransitionData=function(e,r){return this._transition(e.value,e,oe(r))},t.prototype.next=function(e,r){var n,s,i=this,a=r.name,f=[],o=[],c;try{for(var l=W(this.getCandidates(a)),y=l.next();!y.done;y=l.next()){var d=y.value,u=d.cond,p=d.in,g=e.context,w=p?q(p)&&De(p)?e.matches(Xe(this.getStateNodeById(p).path,this.delimiter)):pr(Xe(p,this.delimiter),si(this.path.slice(0,-2))(e.value)):!0,S=!1;try{S=!u||fn(this.machine,u,g,r,e)}catch(M){throw new Error("Unable to evaluate guard '".concat(u.name||u.type,"' in transition for event '").concat(a,"' in state node '").concat(this.id,`':
`).concat(M.message))}if(S&&w){d.target!==void 0&&(o=d.target),f.push.apply(f,Y([],G(d.actions),!1)),c=d;break}}}catch(M){n={error:M}}finally{try{y&&!y.done&&(s=l.return)&&s.call(l)}finally{if(n)throw n.error}}if(c){if(!o.length)return{transitions:[c],exitSet:[],configuration:e.value?[this]:[],source:e,actions:f};var A=Z(o.map(function(M){return i.getRelativeStateNodes(M,e.historyValue)})),x=!!c.internal;return{transitions:[c],exitSet:x?[]:Z(o.map(function(M){return i.getPotentiallyReenteringNodes(M)})),configuration:A,source:e,actions:f}}},t.prototype.getPotentiallyReenteringNodes=function(e){if(this.order<e.order)return[this];for(var r=[],n=this,s=e;n&&n!==s;)r.push(n),n=n.parent;return n!==s?[]:(r.push(s),r)},t.prototype.getActions=function(e,r,n,s,i,a,f){var o,c,l,y,d=this,u=a?Je([],this.getStateNodes(a.value)):[],p=new Set;try{for(var g=W(Array.from(e).sort(function(P,V){return P.order-V.order})),w=g.next();!w.done;w=g.next()){var S=w.value;(!qe(u,S)||qe(n.exitSet,S)||S.parent&&p.has(S.parent))&&p.add(S)}}catch(P){o={error:P}}finally{try{w&&!w.done&&(c=g.return)&&c.call(g)}finally{if(o)throw o.error}}try{for(var A=W(u),x=A.next();!x.done;x=A.next()){var S=x.value;(!qe(e,S)||qe(n.exitSet,S.parent))&&n.exitSet.push(S)}}catch(P){l={error:P}}finally{try{x&&!x.done&&(y=A.return)&&y.call(A)}finally{if(l)throw l.error}}n.exitSet.sort(function(P,V){return V.order-P.order});var M=Array.from(p).sort(function(P,V){return P.order-V.order}),L=new Set(n.exitSet),m=Z(M.map(function(P){var V=[];if(P.type!=="final")return V;var v=P.parent;if(!v.parent)return V;V.push(ct(P.id,P.doneData),ct(v.id,P.doneData?At(P.doneData,s,i):void 0));var R=v.parent;return R.type==="parallel"&&et(R).every(function(T){return bt(n.configuration,T)})&&V.push(ct(R.id)),V})),U=M.map(function(P){var V=P.onEntry,v=P.activities.map(function(R){return mi(R)});return{type:"entry",actions:Oe(f?Y(Y([],G(V),!1),G(v),!1):Y(Y([],G(v),!1),G(V),!1),d.machine.options.actions)}}).concat({type:"state_done",actions:m.map(function(P){return pi(P)})}),I=Array.from(L).map(function(P){return{type:"exit",actions:Oe(Y(Y([],G(P.onExit),!1),G(P.activities.map(function(V){return Si(V)})),!1),d.machine.options.actions)}}),k=I.concat({type:"transition",actions:Oe(n.actions,this.machine.options.actions)}).concat(U);if(r){var j=Oe(Z(Y([],G(e),!1).sort(function(P,V){return V.order-P.order}).map(function(P){return P.onExit})),this.machine.options.actions).filter(function(P){return!tr(P)});return k.concat({type:"stop",actions:j})}return k},t.prototype.transition=function(e,r,n,s){e===void 0&&(e=this.initialState);var i=oe(r),a;if(e instanceof xe)a=n===void 0?e:this.resolveState(xe.from(e,n));else{var f=q(e)?this.resolve(Et(this.getResolvedPath(e))):this.resolve(e),o=n??this.machine.context;a=this.resolveState(xe.from(f,o))}if(this.strict&&!this.events.includes(i.name)&&!oi(i.name))throw new Error("Machine '".concat(this.id,"' does not accept event '").concat(i.name,"'"));var c=this._transition(a.value,a,i)||{transitions:[],configuration:[],exitSet:[],source:a,actions:[]},l=Je([],this.getStateNodes(a.value)),y=c.configuration.length?Je(l,c.configuration):l;return c.configuration=Y([],G(y),!1),this.resolveTransition(c,a,a.context,s,i)},t.prototype.resolveRaisedTransition=function(e,r,n,s){var i,a=e.actions;return e=this.transition(e,r,void 0,s),e._event=n,e.event=n.data,(i=e.actions).unshift.apply(i,Y([],G(a),!1)),e},t.prototype.resolveTransition=function(e,r,n,s,i){var a,f,o,c,l=this;i===void 0&&(i=Ce);var y=e.configuration,d=!r||e.transitions.length>0,u=d?e.configuration:r?r.configuration:[],p=bt(u,this),g=d?Ri(this.machine,y):void 0,w=r?r.historyValue?r.historyValue:e.source?this.machine.historyValue(r.value):void 0:void 0,S=this.getActions(new Set(u),p,e,n,i,r,s),A=r?D({},r.activities):{};try{for(var x=W(S),M=x.next();!M.done;M=x.next()){var L=M.value;try{for(var m=(o=void 0,W(L.actions)),U=m.next();!U.done;U=m.next()){var I=U.value;I.type===Yt?A[I.activity.id||I.activity.type]=I:I.type===dr&&(A[I.activity.id||I.activity.type]=!1)}}catch(ye){o={error:ye}}finally{try{U&&!U.done&&(c=m.return)&&c.call(m)}finally{if(o)throw o.error}}}}catch(ye){a={error:ye}}finally{try{M&&!M.done&&(f=x.return)&&f.call(x)}finally{if(a)throw a.error}}var k=G(Ot(this,r,n,i,S,s,this.machine.config.predictableActionArguments||this.machine.config.preserveActionOrder),2),j=k[0],P=k[1],V=G(ui(j,tr),2),v=V[0],R=V[1],T=j.filter(function(ye){var Ie;return ye.type===Yt&&((Ie=ye.activity)===null||Ie===void 0?void 0:Ie.type)===Xt}),_=T.reduce(function(ye,Ie){return ye[Ie.activity.id]=Ui(Ie.activity,l.machine,P,i),ye},r?D({},r.children):{}),O=new xe({value:g||r.value,context:P,_event:i,_sessionid:r?r._sessionid:null,historyValue:g?w?ci(w,g):void 0:r?r.historyValue:void 0,history:!g||e.source?r:void 0,actions:g?R:[],activities:g?A:r?r.activities:{},events:[],configuration:u,transitions:e.transitions,children:_,done:p,tags:Dr(u),machine:this}),C=n!==P;O.changed=i.name===tn||C;var B=O.history;B&&delete B.history;var $=!p&&(this._transient||y.some(function(ye){return ye._transient}));if(!d&&(!$||i.name===ht))return O;var F=O;if(!p)for($&&(F=this.resolveRaisedTransition(F,{type:Xn},i,s));v.length;){var z=v.shift();F=this.resolveRaisedTransition(F,z._event,i,s)}var at=F.changed||(B?!!F.actions.length||C||typeof B.value!=typeof F.value||!pn(F.value,B.value):void 0);return F.changed=at,F.history=B,F},t.prototype.getStateNode=function(e){if(De(e))return this.machine.getStateNodeById(e);if(!this.states)throw new Error("Unable to retrieve child state '".concat(e,"' from '").concat(this.id,"'; no child states exist."));var r=this.states[e];if(!r)throw new Error("Child state '".concat(e,"' does not exist on '").concat(this.id,"'"));return r},t.prototype.getStateNodeById=function(e){var r=De(e)?e.slice(ir.length):e;if(r===this.id)return this;var n=this.machine.idMap[r];if(!n)throw new Error("Child state node '#".concat(r,"' does not exist on machine '").concat(this.id,"'"));return n},t.prototype.getStateNodeByPath=function(e){if(typeof e=="string"&&De(e))try{return this.getStateNodeById(e.slice(1))}catch{}for(var r=er(e,this.delimiter).slice(),n=this;r.length;){var s=r.shift();if(!s.length)break;n=n.getStateNode(s)}return n},t.prototype.resolve=function(e){var r,n=this;if(!e)return this.initialStateValue||Re;switch(this.type){case"parallel":return We(this.initialStateValue,function(i,a){return i?n.getStateNode(a).resolve(e[a]||i):Re});case"compound":if(q(e)){var s=this.getStateNode(e);return s.type==="parallel"||s.type==="compound"?(r={},r[e]=s.initialStateValue,r):e}return Object.keys(e).length?We(e,function(i,a){return i?n.getStateNode(a).resolve(i):Re}):this.initialStateValue||{};default:return e||Re}},t.prototype.getResolvedPath=function(e){if(De(e)){var r=this.machine.idMap[e.slice(ir.length)];if(!r)throw new Error("Unable to find state node '".concat(e,"'"));return r.path}return er(e,this.delimiter)},Object.defineProperty(t.prototype,"initialStateValue",{get:function(){var e;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;var r;if(this.type==="parallel")r=_r(this.states,function(n){return n.initialStateValue||Re},function(n){return n.type!=="history"});else if(this.initial!==void 0){if(!this.states[this.initial])throw new Error("Initial state '".concat(this.initial,"' not found on '").concat(this.key,"'"));r=Tt(this.states[this.initial])?this.initial:(e={},e[this.initial]=this.states[this.initial].initialStateValue,e)}else r={};return this.__cache.initialStateValue=r,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),t.prototype.getInitialState=function(e,r){this._init();var n=this.getStateNodes(e);return this.resolveTransition({configuration:n,exitSet:[],transitions:[],source:void 0,actions:[]},void 0,r??this.machine.context,void 0)},Object.defineProperty(t.prototype,"initialState",{get:function(){var e=this.initialStateValue;if(!e)throw new Error("Cannot retrieve initial state from simple state '".concat(this.id,"'."));return this.getInitialState(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){var e;if(this.type==="history"){var r=this.config;q(r.target)?e=De(r.target)?Et(this.machine.getStateNodeById(r.target).path.slice(this.path.length-1)):r.target:e=r.target}return e},enumerable:!1,configurable:!0}),t.prototype.getRelativeStateNodes=function(e,r,n){return n===void 0&&(n=!0),n?e.type==="history"?e.resolveHistory(r):e.initialStateNodes:[e]},Object.defineProperty(t.prototype,"initialStateNodes",{get:function(){var e=this;if(Tt(this))return[this];if(this.type==="compound"&&!this.initial)return[this];var r=vt(this.initialStateValue);return Z(r.map(function(n){return e.getFromRelativePath(n)}))},enumerable:!1,configurable:!0}),t.prototype.getFromRelativePath=function(e){if(!e.length)return[this];var r=G(e),n=r[0],s=r.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '".concat(n,"' from node with no states"));var i=this.getStateNode(n);if(i.type==="history")return i.resolveHistory();if(!this.states[n])throw new Error("Child state '".concat(n,"' does not exist on '").concat(this.id,"'"));return this.states[n].getFromRelativePath(s)},t.prototype.historyValue=function(e){if(Object.keys(this.states).length)return{current:e||this.initialStateValue,states:_r(this.states,function(r,n){if(!e)return r.historyValue();var s=q(e)?void 0:e[n];return r.historyValue(s||r.initialStateValue)},function(r){return!r.history})}},t.prototype.resolveHistory=function(e){var r=this;if(this.type!=="history")return[this];var n=this.parent;if(!e){var s=this.target;return s?Z(vt(s).map(function(a){return n.getFromRelativePath(a)})):n.initialStateNodes}var i=ai(n.path,"states")(e).current;return q(i)?[n.getStateNode(i)]:Z(vt(i).map(function(a){return r.history==="deep"?n.getFromRelativePath(a):[n.states[a[0]]]}))},Object.defineProperty(t.prototype,"stateIds",{get:function(){var e=this,r=Z(Object.keys(this.states).map(function(n){return e.states[n].stateIds}));return[this.id].concat(r)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"events",{get:function(){var e,r,n,s;if(this.__cache.events)return this.__cache.events;var i=this.states,a=new Set(this.ownEvents);if(i)try{for(var f=W(Object.keys(i)),o=f.next();!o.done;o=f.next()){var c=o.value,l=i[c];if(l.states)try{for(var y=(n=void 0,W(l.events)),d=y.next();!d.done;d=y.next()){var u=d.value;a.add("".concat(u))}}catch(p){n={error:p}}finally{try{d&&!d.done&&(s=y.return)&&s.call(y)}finally{if(n)throw n.error}}}}catch(p){e={error:p}}finally{try{o&&!o.done&&(r=f.return)&&r.call(f)}finally{if(e)throw e.error}}return this.__cache.events=Array.from(a)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ownEvents",{get:function(){var e=new Set(this.transitions.filter(function(r){return!(!r.target&&!r.actions.length&&r.internal)}).map(function(r){return r.eventType}));return Array.from(e)},enumerable:!1,configurable:!0}),t.prototype.resolveTarget=function(e){var r=this;if(e!==void 0)return e.map(function(n){if(!q(n))return n;var s=n[0]===r.delimiter;if(s&&!r.parent)return r.getStateNodeByPath(n.slice(1));var i=s?r.key+n:n;if(r.parent)try{var a=r.parent.getStateNodeByPath(i);return a}catch(f){throw new Error("Invalid transition definition for state node '".concat(r.id,`':
`).concat(f.message))}else return r.getStateNodeByPath(i)})},t.prototype.formatTransition=function(e){var r=this,n=yi(e.target),s="internal"in e?e.internal:n?n.some(function(o){return q(o)&&o[0]===r.delimiter}):!0,i=this.machine.options.guards,a=this.resolveTarget(n),f=D(D({},e),{actions:Oe(pe(e.actions)),cond:on(e.cond,i),target:a,source:this,internal:s,eventType:e.event,toJSON:function(){return D(D({},f),{target:f.target?f.target.map(function(o){return"#".concat(o.id)}):void 0,source:"#".concat(r.id)})}});return f},t.prototype.formatTransitions=function(){var e,r,n=this,s;if(!this.config.on)s=[];else if(Array.isArray(this.config.on))s=this.config.on;else{var i=this.config.on,a=Bt,f=i[a],o=f===void 0?[]:f,c=hr(i,[typeof a=="symbol"?a:a+""]);s=Z(Object.keys(c).map(function(A){var x=ke(A,c[A]);return x}).concat(ke(Bt,o)))}var l=this.config.always?ke("",this.config.always):[],y=this.config.onDone?ke(String(ct(this.id)),this.config.onDone):[],d=Z(this.invoke.map(function(A){var x=[];return A.onDone&&x.push.apply(x,Y([],G(ke(String(xt(A.id)),A.onDone)),!1)),A.onError&&x.push.apply(x,Y([],G(ke(String(Ge(A.id)),A.onError)),!1)),x})),u=this.after,p=Z(Y(Y(Y(Y([],G(y),!1),G(d),!1),G(s),!1),G(l),!1).map(function(A){return pe(A).map(function(x){return n.formatTransition(x)})}));try{for(var g=W(u),w=g.next();!w.done;w=g.next()){var S=w.value;p.push(S)}}catch(A){e={error:A}}finally{try{w&&!w.done&&(r=g.return)&&r.call(g)}finally{if(e)throw e.error}}return p},t}();function Wi(t,e){return new Ki(t,e)}var Ft=Ai,gn={},xn={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */t.__assign=function(){return t.__assign=Object.assign||function(a){for(var f,o=1,c=arguments.length;o<c;o++){f=arguments[o];for(var l in f)Object.prototype.hasOwnProperty.call(f,l)&&(a[l]=f[l])}return a},t.__assign.apply(this,arguments)};function e(i,a){var f={};for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&a.indexOf(o)<0&&(f[o]=i[o]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,o=Object.getOwnPropertySymbols(i);c<o.length;c++)a.indexOf(o[c])<0&&Object.prototype.propertyIsEnumerable.call(i,o[c])&&(f[o[c]]=i[o[c]]);return f}function r(i){var a=typeof Symbol=="function"&&Symbol.iterator,f=a&&i[a],o=0;if(f)return f.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&o>=i.length&&(i=void 0),{value:i&&i[o++],done:!i}}};throw new TypeError(a?"Object is not iterable.":"Symbol.iterator is not defined.")}function n(i,a){var f=typeof Symbol=="function"&&i[Symbol.iterator];if(!f)return i;var o=f.call(i),c,l=[],y;try{for(;(a===void 0||a-- >0)&&!(c=o.next()).done;)l.push(c.value)}catch(d){y={error:d}}finally{try{c&&!c.done&&(f=o.return)&&f.call(o)}finally{if(y)throw y.error}}return l}function s(i,a,f){if(f||arguments.length===2)for(var o=0,c=a.length,l;o<c;o++)(l||!(o in a))&&(l||(l=Array.prototype.slice.call(a,0,o)),l[o]=a[o]);return i.concat(l||Array.prototype.slice.call(a))}t.__read=n,t.__rest=e,t.__spreadArray=s,t.__values=r})(xn);Object.defineProperty(gn,"__esModule",{value:!0});var Lr=xn,Gi={timeout:1e4};function Ji(t,e,r){var n=Lr.__assign(Lr.__assign({},Gi),r);return new Promise(function(s,i){var a=!1,f=n.timeout===1/0?void 0:setTimeout(function(){c.unsubscribe(),i(new Error("Timeout of ".concat(n.timeout," ms exceeded")))},n.timeout),o=function(){clearTimeout(f),a=!0,c?.unsubscribe()},c=t.subscribe({next:function(l){e(l)&&(o(),s(l))},error:function(l){o(),i(l)},complete:function(){o(),i(new Error("Actor terminated without satisfying predicate"))}});a&&c.unsubscribe()})}var qi=gn.waitFor=Ji;const Qi=(t,e)=>t.length===e.length&&t.every((r,n)=>r===e[n]),Yi=(t,e)=>Qi(t,e),Xi=(t=0)=>new Promise(e=>setTimeout(()=>e(),t)),Zi=async(t,e)=>{let r;const n=new Promise((s,i)=>{r=setTimeout(()=>i(new bn(`withTimeout: timed out after ${e}ms`)),e)});try{return await Promise.race([t,n])}finally{clearTimeout(r)}};class bn extends Error{constructor(e){super(e),this.name="TimeoutError"}}var dt,es=new Uint8Array(16);function ts(){if(!dt&&(dt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!dt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return dt(es)}const rs=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function xr(t){return typeof t=="string"&&rs.test(t)}var ae=[];for(var Vt=0;Vt<256;++Vt)ae.push((Vt+256).toString(16).substr(1));function ns(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(ae[t[e+0]]+ae[t[e+1]]+ae[t[e+2]]+ae[t[e+3]]+"-"+ae[t[e+4]]+ae[t[e+5]]+"-"+ae[t[e+6]]+ae[t[e+7]]+"-"+ae[t[e+8]]+ae[t[e+9]]+"-"+ae[t[e+10]]+ae[t[e+11]]+ae[t[e+12]]+ae[t[e+13]]+ae[t[e+14]]+ae[t[e+15]]).toLowerCase();if(!xr(r))throw TypeError("Stringified UUID is invalid");return r}function is(t){if(!xr(t))throw TypeError("Invalid UUID");var e,r=new Uint8Array(16);return r[0]=(e=parseInt(t.slice(0,8),16))>>>24,r[1]=e>>>16&255,r[2]=e>>>8&255,r[3]=e&255,r[4]=(e=parseInt(t.slice(9,13),16))>>>8,r[5]=e&255,r[6]=(e=parseInt(t.slice(14,18),16))>>>8,r[7]=e&255,r[8]=(e=parseInt(t.slice(19,23),16))>>>8,r[9]=e&255,r[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,r[11]=e/4294967296&255,r[12]=e>>>24&255,r[13]=e>>>16&255,r[14]=e>>>8&255,r[15]=e&255,r}function ss(t,e,r){t=t||{};var n=t.random||(t.rng||ts)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){r=r||0;for(var s=0;s<16;++s)e[r+s]=n[s];return e}return ns(n)}var Ve={},Lt={},ue={};Object.defineProperty(ue,"__esModule",{value:!0});ue.output=ue.exists=ue.hash=ue.bytes=ue.bool=ue.number=void 0;function Ut(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}ue.number=Ut;function wn(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)}ue.bool=wn;function br(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}ue.bytes=br;function mn(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Ut(t.outputLen),Ut(t.blockLen)}ue.hash=mn;function Sn(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}ue.exists=Sn;function En(t,e){br(t);const r=e.outputLen;if(t.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}ue.output=En;const as={number:Ut,bool:wn,bytes:br,hash:mn,exists:Sn,output:En};ue.default=as;var wr={},Nt={};Object.defineProperty(Nt,"__esModule",{value:!0});Nt.crypto=void 0;Nt.crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;(function(t){/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(t,"__esModule",{value:!0}),t.randomBytes=t.wrapXOFConstructorWithOpts=t.wrapConstructorWithOpts=t.wrapConstructor=t.checkOpts=t.Hash=t.concatBytes=t.toBytes=t.utf8ToBytes=t.asyncLoop=t.nextTick=t.hexToBytes=t.bytesToHex=t.isLE=t.rotr=t.createView=t.u32=t.u8=void 0;const e=Nt,r=m=>m instanceof Uint8Array,n=m=>new Uint8Array(m.buffer,m.byteOffset,m.byteLength);t.u8=n;const s=m=>new Uint32Array(m.buffer,m.byteOffset,Math.floor(m.byteLength/4));t.u32=s;const i=m=>new DataView(m.buffer,m.byteOffset,m.byteLength);t.createView=i;const a=(m,U)=>m<<32-U|m>>>U;if(t.rotr=a,t.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68,!t.isLE)throw new Error("Non little-endian hardware is not supported");const f=Array.from({length:256},(m,U)=>U.toString(16).padStart(2,"0"));function o(m){if(!r(m))throw new Error("Uint8Array expected");let U="";for(let I=0;I<m.length;I++)U+=f[m[I]];return U}t.bytesToHex=o;function c(m){if(typeof m!="string")throw new Error("hex string expected, got "+typeof m);const U=m.length;if(U%2)throw new Error("padded hex string expected, got unpadded hex of length "+U);const I=new Uint8Array(U/2);for(let k=0;k<I.length;k++){const j=k*2,P=m.slice(j,j+2),V=Number.parseInt(P,16);if(Number.isNaN(V)||V<0)throw new Error("Invalid byte sequence");I[k]=V}return I}t.hexToBytes=c;const l=async()=>{};t.nextTick=l;async function y(m,U,I){let k=Date.now();for(let j=0;j<m;j++){I(j);const P=Date.now()-k;P>=0&&P<U||(await(0,t.nextTick)(),k+=P)}}t.asyncLoop=y;function d(m){if(typeof m!="string")throw new Error(`utf8ToBytes expected string, got ${typeof m}`);return new Uint8Array(new TextEncoder().encode(m))}t.utf8ToBytes=d;function u(m){if(typeof m=="string"&&(m=d(m)),!r(m))throw new Error(`expected Uint8Array, got ${typeof m}`);return m}t.toBytes=u;function p(...m){const U=new Uint8Array(m.reduce((k,j)=>k+j.length,0));let I=0;return m.forEach(k=>{if(!r(k))throw new Error("Uint8Array expected");U.set(k,I),I+=k.length}),U}t.concatBytes=p;class g{clone(){return this._cloneInto()}}t.Hash=g;const w={}.toString;function S(m,U){if(U!==void 0&&w.call(U)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign(m,U)}t.checkOpts=S;function A(m){const U=k=>m().update(u(k)).digest(),I=m();return U.outputLen=I.outputLen,U.blockLen=I.blockLen,U.create=()=>m(),U}t.wrapConstructor=A;function x(m){const U=(k,j)=>m(j).update(u(k)).digest(),I=m({});return U.outputLen=I.outputLen,U.blockLen=I.blockLen,U.create=k=>m(k),U}t.wrapConstructorWithOpts=x;function M(m){const U=(k,j)=>m(j).update(u(k)).digest(),I=m({});return U.outputLen=I.outputLen,U.blockLen=I.blockLen,U.create=k=>m(k),U}t.wrapXOFConstructorWithOpts=M;function L(m=32){if(e.crypto&&typeof e.crypto.getRandomValues=="function")return e.crypto.getRandomValues(new Uint8Array(m));throw new Error("crypto.getRandomValues must be defined")}t.randomBytes=L})(wr);Object.defineProperty(Lt,"__esModule",{value:!0});Lt.SHA2=void 0;const $t=ue,He=wr;function os(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const s=BigInt(32),i=BigInt(4294967295),a=Number(r>>s&i),f=Number(r&i),o=n?4:0,c=n?0:4;t.setUint32(e+o,a,n),t.setUint32(e+c,f,n)}class fs extends He.Hash{constructor(e,r,n,s){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=(0,He.createView)(this.buffer)}update(e){(0,$t.exists)(this);const{view:r,buffer:n,blockLen:s}=this;e=(0,He.toBytes)(e);const i=e.length;for(let a=0;a<i;){const f=Math.min(s-this.pos,i-a);if(f===s){const o=(0,He.createView)(e);for(;s<=i-a;a+=s)this.process(o,a);continue}n.set(e.subarray(a,a+f),this.pos),this.pos+=f,a+=f,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){(0,$t.exists)(this),(0,$t.output)(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:s,isLE:i}=this;let{pos:a}=this;r[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>s-a&&(this.process(n,0),a=0);for(let y=a;y<s;y++)r[y]=0;os(n,s-8,BigInt(this.length*8),i),this.process(n,0);const f=(0,He.createView)(e),o=this.outputLen;if(o%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=o/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let y=0;y<c;y++)f.setUint32(4*y,l[y],i)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:s,finished:i,destroyed:a,pos:f}=this;return e.length=s,e.pos=f,e.finished=i,e.destroyed=a,s%r&&e.buffer.set(n),e}}Lt.SHA2=fs;Object.defineProperty(Ve,"__esModule",{value:!0});Ve.sha224=Ve.sha256=void 0;const us=Lt,he=wr,cs=(t,e,r)=>t&e^~t&r,ls=(t,e,r)=>t&e^t&r^e&r,hs=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),me=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Se=new Uint32Array(64);class An extends us.SHA2{constructor(){super(64,32,8,!1),this.A=me[0]|0,this.B=me[1]|0,this.C=me[2]|0,this.D=me[3]|0,this.E=me[4]|0,this.F=me[5]|0,this.G=me[6]|0,this.H=me[7]|0}get(){const{A:e,B:r,C:n,D:s,E:i,F:a,G:f,H:o}=this;return[e,r,n,s,i,a,f,o]}set(e,r,n,s,i,a,f,o){this.A=e|0,this.B=r|0,this.C=n|0,this.D=s|0,this.E=i|0,this.F=a|0,this.G=f|0,this.H=o|0}process(e,r){for(let y=0;y<16;y++,r+=4)Se[y]=e.getUint32(r,!1);for(let y=16;y<64;y++){const d=Se[y-15],u=Se[y-2],p=(0,he.rotr)(d,7)^(0,he.rotr)(d,18)^d>>>3,g=(0,he.rotr)(u,17)^(0,he.rotr)(u,19)^u>>>10;Se[y]=g+Se[y-7]+p+Se[y-16]|0}let{A:n,B:s,C:i,D:a,E:f,F:o,G:c,H:l}=this;for(let y=0;y<64;y++){const d=(0,he.rotr)(f,6)^(0,he.rotr)(f,11)^(0,he.rotr)(f,25),u=l+d+cs(f,o,c)+hs[y]+Se[y]|0,g=((0,he.rotr)(n,2)^(0,he.rotr)(n,13)^(0,he.rotr)(n,22))+ls(n,s,i)|0;l=c,c=o,o=f,f=a+u|0,a=i,i=s,s=n,n=u+g|0}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,a=a+this.D|0,f=f+this.E|0,o=o+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,s,i,a,f,o,c,l)}roundClean(){Se.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class ds extends An{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}Ve.sha256=(0,he.wrapConstructor)(()=>new An);Ve.sha224=(0,he.wrapConstructor)(()=>new ds);function ys(t){if(t.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),r=0;r<e.length;r++)e[r]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),i=s.charCodeAt(0);if(e[i]!==255)throw new TypeError(s+" is ambiguous");e[i]=n}var a=t.length,f=t.charAt(0),o=Math.log(a)/Math.log(256),c=Math.log(256)/Math.log(a);function l(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(u.length===0)return"";for(var p=0,g=0,w=0,S=u.length;w!==S&&u[w]===0;)w++,p++;for(var A=(S-w)*c+1>>>0,x=new Uint8Array(A);w!==S;){for(var M=u[w],L=0,m=A-1;(M!==0||L<g)&&m!==-1;m--,L++)M+=256*x[m]>>>0,x[m]=M%a>>>0,M=M/a>>>0;if(M!==0)throw new Error("Non-zero carry");g=L,w++}for(var U=A-g;U!==A&&x[U]===0;)U++;for(var I=f.repeat(p);U<A;++U)I+=t.charAt(x[U]);return I}function y(u){if(typeof u!="string")throw new TypeError("Expected String");if(u.length===0)return new Uint8Array;for(var p=0,g=0,w=0;u[p]===f;)g++,p++;for(var S=(u.length-p)*o+1>>>0,A=new Uint8Array(S);u[p];){var x=e[u.charCodeAt(p)];if(x===255)return;for(var M=0,L=S-1;(x!==0||M<w)&&L!==-1;L--,M++)x+=a*A[L]>>>0,A[L]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");w=M,p++}for(var m=S-w;m!==S&&A[m]===0;)m++;for(var U=new Uint8Array(g+(S-m)),I=g;m!==S;)U[I++]=A[m++];return U}function d(u){var p=y(u);if(p)return p;throw new Error("Non-base"+a+" character")}return{encode:l,decodeUnsafe:y,decode:d}}var ps=ys;const vs=ps,gs="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";var xs=vs(gs),zt=xs,bs=function(t){function e(i){var a=Uint8Array.from(i),f=t(a),o=a.length+4,c=new Uint8Array(o);return c.set(a,0),c.set(f.subarray(0,4),a.length),zt.encode(c,o)}function r(i){var a=i.slice(0,-4),f=i.slice(-4),o=t(a);if(!(f[0]^o[0]|f[1]^o[1]|f[2]^o[2]|f[3]^o[3]))return a}function n(i){var a=zt.decodeUnsafe(i);if(a)return r(a)}function s(i){var a=zt.decode(i),f=r(a);if(!f)throw new Error("Invalid checksum");return f}return{encode:e,decode:s,decodeUnsafe:n}},{sha256:Nr}=Ve,ws=bs;function ms(t){return Nr(Nr(t))}var Ss=ws(ms);const On=Qr(Ss),_t="automerge:",fa=t=>{const{binaryDocumentId:e,documentId:r}=Tn(t);if(!e)throw new Error("Invalid document URL: "+t);return{binaryDocumentId:e,documentId:r}},jt=({documentId:t})=>{if(t instanceof Uint8Array)return _t+As(t);if(typeof t=="string")return _t+t;throw new Error("Invalid documentId: "+t)},ua=t=>{if(!t.startsWith(_t))return!1;const{binaryDocumentId:e}=Tn(t);return!!e},ca=()=>jt({documentId:ss(null,new Uint8Array(16))}),Es=t=>On.decodeUnsafe(t),As=t=>On.encode(t),la=t=>{if(xr(t)){const e=is(t);return jt({documentId:e})}},Tn=t=>{const e=new RegExp(`^${_t}(\\w+)$`),[r,n]=t.match(e)||[],s=n;return{binaryDocumentId:Es(s),documentId:s}};let sr;try{sr=new TextDecoder}catch{}let N,Ue,E=0;const Os=105,Ts=57342,Us=57343,jr=57337,Pr=6,Me={};let K={},ee,It,kt=0,tt=0,ne,ve,te=[],ar=[],ce,fe,Qe,Cr={useRecords:!1,mapsAsObjects:!0},rt=!1,Un=2;try{new Function("")}catch{Un=1/0}class nt{constructor(e){if(e&&((e.keyMap||e._keyMap)&&!e.useRecords&&(e.useRecords=!1,e.mapsAsObjects=!0),e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.getStructures&&(e.getShared=e.getStructures),e.getShared&&!e.structures&&((e.structures=[]).uninitialized=!0),e.keyMap)){this.mapKey=new Map;for(let[r,n]of Object.entries(e.keyMap))this.mapKey.set(n,r)}Object.assign(this,e)}decodeKey(e){return this.keyMap&&this.mapKey.get(e)||e}encodeKey(e){return this.keyMap&&this.keyMap.hasOwnProperty(e)?this.keyMap[e]:e}encodeKeys(e){if(!this._keyMap)return e;let r=new Map;for(let[n,s]of Object.entries(e))r.set(this._keyMap.hasOwnProperty(n)?this._keyMap[n]:n,s);return r}decodeKeys(e){if(!this._keyMap||e.constructor.name!="Map")return e;if(!this._mapKey){this._mapKey=new Map;for(let[n,s]of Object.entries(this._keyMap))this._mapKey.set(s,n)}let r={};return e.forEach((n,s)=>r[de(this._mapKey.has(s)?this._mapKey.get(s):s)]=n),r}mapDecode(e,r){let n=this.decode(e);if(this._keyMap)switch(n.constructor.name){case"Array":return n.map(s=>this.decodeKeys(s))}return n}decode(e,r){if(N)return Rn(()=>(cr(),this?this.decode(e,r):nt.prototype.decode.call(Cr,e,r)));Ue=r>-1?r:e.length,E=0,tt=0,It=null,ne=null,N=e;try{fe=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(n){throw N=null,e instanceof Uint8Array?n:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof nt){if(K=this,ce=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return ee=this.structures,yt();(!ee||ee.length>0)&&(ee=[])}else K=Cr,(!ee||ee.length>0)&&(ee=[]),ce=null;return yt()}decodeMultiple(e,r){let n,s=0;try{let i=e.length;rt=!0;let a=this?this.decode(e,i):Er.decode(e,i);if(r){if(r(a)===!1)return;for(;E<i;)if(s=E,r(yt())===!1)return}else{for(n=[a];E<i;)s=E,n.push(yt());return n}}catch(i){throw i.lastPosition=s,i.values=n,i}finally{rt=!1,cr()}}}function yt(){try{let t=H();if(ne){if(E>=ne.postBundlePosition){let e=new Error("Unexpected bundle position");throw e.incomplete=!0,e}E=ne.postBundlePosition,ne=null}if(E==Ue)ee=null,N=null,ve&&(ve=null);else if(E>Ue){let e=new Error("Unexpected end of CBOR data");throw e.incomplete=!0,e}else if(!rt)throw new Error("Data read, but end of buffer not reached");return t}catch(t){throw cr(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer"))&&(t.incomplete=!0),t}}function H(){let t=N[E++],e=t>>5;if(t=t&31,t>23)switch(t){case 24:t=N[E++];break;case 25:if(e==7)return Rs();t=fe.getUint16(E),E+=2;break;case 26:if(e==7){let r=fe.getFloat32(E);if(K.useFloat32>2){let n=Sr[(N[E]&127)<<1|N[E+1]>>7];return E+=4,(n*r+(r>0?.5:-.5)>>0)/n}return E+=4,r}t=fe.getUint32(E),E+=4;break;case 27:if(e==7){let r=fe.getFloat64(E);return E+=8,r}if(e>1){if(fe.getUint32(E)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");t=fe.getUint32(E+4)}else K.int64AsNumber?(t=fe.getUint32(E)*4294967296,t+=fe.getUint32(E+4)):t=fe.getBigUint64(E);E+=8;break;case 31:switch(e){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let r=[],n,s=0;for(;(n=H())!=Me;)r[s++]=n;return e==4?r:e==3?r.join(""):Buffer.concat(r);case 5:let i;if(K.mapsAsObjects){let a={};if(K.keyMap)for(;(i=H())!=Me;)a[de(K.decodeKey(i))]=H();else for(;(i=H())!=Me;)a[de(i)]=H();return a}else{Qe&&(K.mapsAsObjects=!0,Qe=!1);let a=new Map;if(K.keyMap)for(;(i=H())!=Me;)a.set(K.decodeKey(i),H());else for(;(i=H())!=Me;)a.set(i,H());return a}case 7:return Me;default:throw new Error("Invalid major type for indefinite length "+e)}default:throw new Error("Unknown token "+t)}switch(e){case 0:return t;case 1:return~t;case 2:return ks(t);case 3:if(tt>=E)return It.slice(E-kt,(E+=t)-kt);if(tt==0&&Ue<140&&t<32){let s=t<16?_n(t):Is(t);if(s!=null)return s}return _s(t);case 4:let r=new Array(t);for(let s=0;s<t;s++)r[s]=H();return r;case 5:if(K.mapsAsObjects){let s={};if(K.keyMap)for(let i=0;i<t;i++)s[de(K.decodeKey(H()))]=H();else for(let i=0;i<t;i++)s[de(H())]=H();return s}else{Qe&&(K.mapsAsObjects=!0,Qe=!1);let s=new Map;if(K.keyMap)for(let i=0;i<t;i++)s.set(K.decodeKey(H()),H());else for(let i=0;i<t;i++)s.set(H(),H());return s}case 6:if(t>=jr){let s=ee[t&8191];if(s)return s.read||(s.read=or(s)),s.read();if(t<65536){if(t==Us){let i=je(),a=H(),f=H();ur(a,f);let o={};if(K.keyMap)for(let c=2;c<i;c++){let l=K.decodeKey(f[c-2]);o[de(l)]=H()}else for(let c=2;c<i;c++){let l=f[c-2];o[de(l)]=H()}return o}else if(t==Ts){let i=je(),a=H();for(let f=2;f<i;f++)ur(a++,H());return H()}else if(t==jr)return Ps();if(K.getShared&&(mr(),s=ee[t&8191],s))return s.read||(s.read=or(s)),s.read()}}let n=te[t];if(n)return n.handlesRead?n(H):n(H());{let s=H();for(let i=0;i<ar.length;i++){let a=ar[i](t,s);if(a!==void 0)return a}return new _e(s,t)}case 7:switch(t){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 31:default:let s=(ce||Te())[t];if(s!==void 0)return s;throw new Error("Unknown token "+t)}default:if(isNaN(t)){let s=new Error("Unexpected end of CBOR data");throw s.incomplete=!0,s}throw new Error("Unknown CBOR token "+t)}}const Br=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function or(t){function e(){let r=N[E++];if(r=r&31,r>23)switch(r){case 24:r=N[E++];break;case 25:r=fe.getUint16(E),E+=2;break;case 26:r=fe.getUint32(E),E+=4;break;default:throw new Error("Expected array header, but got "+N[E-1])}let n=this.compiledReader;for(;n;){if(n.propertyCount===r)return n(H);n=n.next}if(this.slowReads++>=Un){let i=this.length==r?this:this.slice(0,r);return n=K.keyMap?new Function("r","return {"+i.map(a=>K.decodeKey(a)).map(a=>Br.test(a)?de(a)+":r()":"["+JSON.stringify(a)+"]:r()").join(",")+"}"):new Function("r","return {"+i.map(a=>Br.test(a)?de(a)+":r()":"["+JSON.stringify(a)+"]:r()").join(",")+"}"),this.compiledReader&&(n.next=this.compiledReader),n.propertyCount=r,this.compiledReader=n,n(H)}let s={};if(K.keyMap)for(let i=0;i<r;i++)s[de(K.decodeKey(this[i]))]=H();else for(let i=0;i<r;i++)s[de(this[i])]=H();return s}return t.slowReads=0,e}function de(t){return t==="__proto__"?"__proto_":t}let _s=fr;function fr(t){let e;if(t<16&&(e=_n(t)))return e;if(t>64&&sr)return sr.decode(N.subarray(E,E+=t));const r=E+t,n=[];for(e="";E<r;){const s=N[E++];if(!(s&128))n.push(s);else if((s&224)===192){const i=N[E++]&63;n.push((s&31)<<6|i)}else if((s&240)===224){const i=N[E++]&63,a=N[E++]&63;n.push((s&31)<<12|i<<6|a)}else if((s&248)===240){const i=N[E++]&63,a=N[E++]&63,f=N[E++]&63;let o=(s&7)<<18|i<<12|a<<6|f;o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|o&1023),n.push(o)}else n.push(s);n.length>=4096&&(e+=se.apply(String,n),n.length=0)}return n.length>0&&(e+=se.apply(String,n)),e}let se=String.fromCharCode;function Is(t){let e=E,r=new Array(t);for(let n=0;n<t;n++){const s=N[E++];if((s&128)>0){E=e;return}r[n]=s}return se.apply(String,r)}function _n(t){if(t<4)if(t<2){if(t===0)return"";{let e=N[E++];if((e&128)>1){E-=1;return}return se(e)}}else{let e=N[E++],r=N[E++];if((e&128)>0||(r&128)>0){E-=2;return}if(t<3)return se(e,r);let n=N[E++];if((n&128)>0){E-=3;return}return se(e,r,n)}else{let e=N[E++],r=N[E++],n=N[E++],s=N[E++];if((e&128)>0||(r&128)>0||(n&128)>0||(s&128)>0){E-=4;return}if(t<6){if(t===4)return se(e,r,n,s);{let i=N[E++];if((i&128)>0){E-=5;return}return se(e,r,n,s,i)}}else if(t<8){let i=N[E++],a=N[E++];if((i&128)>0||(a&128)>0){E-=6;return}if(t<7)return se(e,r,n,s,i,a);let f=N[E++];if((f&128)>0){E-=7;return}return se(e,r,n,s,i,a,f)}else{let i=N[E++],a=N[E++],f=N[E++],o=N[E++];if((i&128)>0||(a&128)>0||(f&128)>0||(o&128)>0){E-=8;return}if(t<10){if(t===8)return se(e,r,n,s,i,a,f,o);{let c=N[E++];if((c&128)>0){E-=9;return}return se(e,r,n,s,i,a,f,o,c)}}else if(t<12){let c=N[E++],l=N[E++];if((c&128)>0||(l&128)>0){E-=10;return}if(t<11)return se(e,r,n,s,i,a,f,o,c,l);let y=N[E++];if((y&128)>0){E-=11;return}return se(e,r,n,s,i,a,f,o,c,l,y)}else{let c=N[E++],l=N[E++],y=N[E++],d=N[E++];if((c&128)>0||(l&128)>0||(y&128)>0||(d&128)>0){E-=12;return}if(t<14){if(t===12)return se(e,r,n,s,i,a,f,o,c,l,y,d);{let u=N[E++];if((u&128)>0){E-=13;return}return se(e,r,n,s,i,a,f,o,c,l,y,d,u)}}else{let u=N[E++],p=N[E++];if((u&128)>0||(p&128)>0){E-=14;return}if(t<15)return se(e,r,n,s,i,a,f,o,c,l,y,d,u,p);let g=N[E++];if((g&128)>0){E-=15;return}return se(e,r,n,s,i,a,f,o,c,l,y,d,u,p,g)}}}}}function ks(t){return K.copyBuffers?Uint8Array.prototype.slice.call(N,E,E+=t):N.subarray(E,E+=t)}let In=new Float32Array(1),pt=new Uint8Array(In.buffer,0,4);function Rs(){let t=N[E++],e=N[E++],r=(t&127)>>2;if(r===31)return e||t&3?NaN:t&128?-1/0:1/0;if(r===0){let n=((t&3)<<8|e)/16777216;return t&128?-n:n}return pt[3]=t&128|(r>>1)+56,pt[2]=(t&7)<<5|e>>3,pt[1]=e<<5,pt[0]=0,In[0]}new Array(4096);class _e{constructor(e,r){this.value=e,this.tag=r}}te[0]=t=>new Date(t);te[1]=t=>new Date(Math.round(t*1e3));te[2]=t=>{let e=BigInt(0);for(let r=0,n=t.byteLength;r<n;r++)e=BigInt(t[r])+e<<BigInt(8);return e};te[3]=t=>BigInt(-1)-te[2](t);te[4]=t=>+(t[1]+"e"+t[0]);te[5]=t=>t[1]*Math.exp(t[0]*Math.log(2));const ur=(t,e)=>{t=t-57344;let r=ee[t];r&&r.isShared&&((ee.restoreStructures||(ee.restoreStructures=[]))[t]=r),ee[t]=e,e.read=or(e)};te[Os]=t=>{let e=t.length,r=t[1];ur(t[0],r);let n={};for(let s=2;s<e;s++){let i=r[s-2];n[de(i)]=t[s]}return n};te[14]=t=>ne?ne[0].slice(ne.position0,ne.position0+=t):new _e(t,14);te[15]=t=>ne?ne[1].slice(ne.position1,ne.position1+=t):new _e(t,15);let Ds={Error,RegExp};te[27]=t=>(Ds[t[0]]||Error)(t[1],t[2]);const kn=t=>{if(N[E++]!=132)throw new Error("Packed values structure must be followed by a 4 element array");let e=t();return ce=ce?e.concat(ce.slice(e.length)):e,ce.prefixes=t(),ce.suffixes=t(),t()};kn.handlesRead=!0;te[51]=kn;te[Pr]=t=>{if(!ce)if(K.getShared)mr();else return new _e(t,Pr);if(typeof t=="number")return ce[16+(t>=0?2*t:-2*t-1)];throw new Error("No support for non-integer packed references yet")};te[28]=t=>{ve||(ve=new Map,ve.id=0);let e=ve.id++,r=N[E],n;r>>5==4?n=[]:n={};let s={target:n};ve.set(e,s);let i=t();return s.used?Object.assign(n,i):(s.target=i,i)};te[28].handlesRead=!0;te[29]=t=>{let e=ve.get(t);return e.used=!0,e.target};te[258]=t=>new Set(t);(te[259]=t=>(K.mapsAsObjects&&(K.mapsAsObjects=!1,Qe=!0),t())).handlesRead=!0;function Le(t,e){return typeof t=="string"?t+e:t instanceof Array?t.concat(e):Object.assign({},t,e)}function Te(){if(!ce)if(K.getShared)mr();else throw new Error("No packed values available");return ce}const Ms=1399353956;ar.push((t,e)=>{if(t>=225&&t<=255)return Le(Te().prefixes[t-224],e);if(t>=28704&&t<=32767)return Le(Te().prefixes[t-28672],e);if(t>=1879052288&&t<=2147483647)return Le(Te().prefixes[t-1879048192],e);if(t>=216&&t<=223)return Le(e,Te().suffixes[t-216]);if(t>=27647&&t<=28671)return Le(e,Te().suffixes[t-27639]);if(t>=1811940352&&t<=1879048191)return Le(e,Te().suffixes[t-1811939328]);if(t==Ms)return{packedValues:ce,structures:ee.slice(0),version:e};if(t==55799)return e});const Ls=new Uint8Array(new Uint16Array([1]).buffer)[0]==1,Fr=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array>"u"?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array>"u"?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],Ns=[64,68,69,70,71,72,77,78,79,85,86];for(let t=0;t<Fr.length;t++)js(Fr[t],Ns[t]);function js(t,e){let r="get"+t.name.slice(0,-5),n;typeof t=="function"?n=t.BYTES_PER_ELEMENT:t=null;for(let s=0;s<2;s++){if(!s&&n==1)continue;let i=n==2?1:n==4?2:3;te[s?e:e-4]=n==1||s==Ls?a=>{if(!t)throw new Error("Could not find typed array for code "+e);return new t(Uint8Array.prototype.slice.call(a,0).buffer)}:a=>{if(!t)throw new Error("Could not find typed array for code "+e);let f=new DataView(a.buffer,a.byteOffset,a.byteLength),o=a.length>>i,c=new t(o),l=f[r];for(let y=0;y<o;y++)c[y]=l.call(f,y<<i,s);return c}}}function Ps(){let t=je(),e=E+H();for(let n=2;n<t;n++){let s=je();E+=s}let r=E;return E=e,ne=[fr(je()),fr(je())],ne.position0=0,ne.position1=0,ne.postBundlePosition=E,E=r,H()}function je(){let t=N[E++]&31;if(t>23)switch(t){case 24:t=N[E++];break;case 25:t=fe.getUint16(E),E+=2;break;case 26:t=fe.getUint32(E),E+=4;break}return t}function mr(){if(K.getShared){let t=Rn(()=>(N=null,K.getShared()))||{},e=t.structures||[];K.sharedVersion=t.version,ce=K.sharedValues=t.packedValues,ee===!0?K.structures=ee=e:ee.splice.apply(ee,[0,e.length].concat(e))}}function Rn(t){let e=Ue,r=E,n=kt,s=tt,i=It,a=ve,f=ne,o=new Uint8Array(N.slice(0,Ue)),c=ee,l=K,y=rt,d=t();return Ue=e,E=r,kt=n,tt=s,It=i,ve=a,ne=f,N=o,rt=y,ee=c,K=l,fe=new DataView(N.buffer,N.byteOffset,N.byteLength),d}function cr(){N=null,ve=null,ee=null}const Sr=new Array(147);for(let t=0;t<256;t++)Sr[t]=+("1e"+Math.floor(45.15-t*.30103));let Er=new nt({useRecords:!1});const Dn=Er.decode;Er.decodeMultiple;let wt;try{wt=new TextEncoder}catch{}let lr,Mn;const Pt=typeof globalThis=="object"&&globalThis.Buffer,st=typeof Pt<"u",Ht=st?Pt.allocUnsafeSlow:Uint8Array,Vr=st?Pt:Uint8Array,$r=256,zr=st?4294967296:2144337920;let Kt,b,X,h=0,Ee,re=null;const Cs=61440,Bs=/[\u0080-\uFFFF]/,le=Symbol("record-id");class Ln extends nt{constructor(e){super(e),this.offset=0;let r,n,s,i,a;e=e||{};let f=Vr.prototype.utf8Write?function(v,R,T){return b.utf8Write(v,R,T)}:wt&&wt.encodeInto?function(v,R){return wt.encodeInto(v,b.subarray(R)).written}:!1,o=this,c=e.structures||e.saveStructures,l=e.maxSharedStructures;if(l==null&&(l=c?128:0),l>8190)throw new Error("Maximum maxSharedStructure is 8190");let y=e.sequential;y&&(l=0),this.structures||(this.structures=[]),this.saveStructures&&(this.saveShared=this.saveStructures);let d,u,p=e.sharedValues,g;if(p){g=Object.create(null);for(let v=0,R=p.length;v<R;v++)g[p[v]]=v}let w=[],S=0,A=0;this.mapEncode=function(v,R){if(this._keyMap&&!this._mapped)switch(v.constructor.name){case"Array":v=v.map(T=>this.encodeKeys(T));break}return this.encode(v,R)},this.encode=function(v,R){if(b||(b=new Ht(8192),X=new DataView(b.buffer,0,8192),h=0),Ee=b.length-10,Ee-h<2048?(b=new Ht(b.length),X=new DataView(b.buffer,0,b.length),Ee=b.length-10,h=0):R===Gr&&(h=h+7&2147483640),r=h,o.useSelfDescribedHeader&&(X.setUint32(h,3654940416),h+=3),a=o.structuredClone?new Map:null,o.bundleStrings&&typeof v!="string"?(re=[],re.size=1/0):re=null,n=o.structures,n){if(n.uninitialized){let _=o.getShared()||{};o.structures=n=_.structures||[],o.sharedVersion=_.version;let O=o.sharedValues=_.packedValues;if(O){g={};for(let C=0,B=O.length;C<B;C++)g[O[C]]=C}}let T=n.length;if(T>l&&!y&&(T=l),!n.transitions){n.transitions=Object.create(null);for(let _=0;_<T;_++){let O=n[_];if(!O)continue;let C,B=n.transitions;for(let $=0,F=O.length;$<F;$++){B[le]===void 0&&(B[le]=_);let z=O[$];C=B[z],C||(C=B[z]=Object.create(null)),B=C}B[le]=_|1048576}}y||(n.nextId=T)}if(s&&(s=!1),i=n||[],u=g,e.pack){let T=new Map;if(T.values=[],T.encoder=o,T.maxValues=e.maxPrivatePackedValues||(g?16:1/0),T.objectMap=g||!1,T.samplingPackedValues=d,mt(v,T),T.values.length>0){b[h++]=216,b[h++]=51,be(4);let _=T.values;x(_),be(0),be(0),u=Object.create(g||null);for(let O=0,C=_.length;O<C;O++)u[_[O]]=O}}Kt=R&Gt;try{if(Kt)return;if(x(v),re&&Wr(r,x),o.offset=h,a&&a.idsToInsert){h+=a.idsToInsert.length*2,h>Ee&&L(h),o.offset=h;let T=$s(b.subarray(r,h),a.idsToInsert);return a=null,T}return R&Gr?(b.start=r,b.end=h,b):b.subarray(r,h)}finally{if(n){if(A<10&&A++,n.length>l&&(n.length=l),S>1e4)n.transitions=null,A=0,S=0,w.length>0&&(w=[]);else if(w.length>0&&!y){for(let T=0,_=w.length;T<_;T++)w[T][le]=void 0;w=[]}}if(s&&o.saveShared){o.structures.length>l&&(o.structures=o.structures.slice(0,l));let T=b.subarray(r,h);return o.updateSharedData()===!1?o.encode(v):T}R&zs&&(h=r)}},this.findCommonStringsToPack=()=>(d=new Map,g||(g=Object.create(null)),v=>{let R=v&&v.threshold||4,T=this.pack?v.maxPrivatePackedValues||16:0;p||(p=this.sharedValues=[]);for(let[_,O]of d)O.count>R&&(g[_]=T++,p.push(_),s=!0);for(;this.saveShared&&this.updateSharedData()===!1;);d=null});const x=v=>{h>Ee&&(b=L(h));var R=typeof v,T;if(R==="string"){if(u){let B=u[v];if(B>=0){B<16?b[h++]=B+224:(b[h++]=198,B&1?x(15-B>>1):x(B-16>>1));return}else if(d&&!e.pack){let $=d.get(v);$?$.count++:d.set(v,{count:1})}}let _=v.length;if(re&&_>=4&&_<1024){if((re.size+=_)>Cs){let $,F=(re[0]?re[0].length*3+re[1].length:0)+10;h+F>Ee&&(b=L(h+F)),b[h++]=217,b[h++]=223,b[h++]=249,b[h++]=re.position?132:130,b[h++]=26,$=h-r,h+=4,re.position&&Wr(r,x),re=["",""],re.size=0,re.position=$}let B=Bs.test(v);re[B?0:1]+=v,b[h++]=B?206:207,x(_);return}let O;_<32?O=1:_<256?O=2:_<65536?O=3:O=5;let C=_*3;if(h+C>Ee&&(b=L(h+C)),_<64||!f){let B,$,F,z=h+O;for(B=0;B<_;B++)$=v.charCodeAt(B),$<128?b[z++]=$:$<2048?(b[z++]=$>>6|192,b[z++]=$&63|128):($&64512)===55296&&((F=v.charCodeAt(B+1))&64512)===56320?($=65536+(($&1023)<<10)+(F&1023),B++,b[z++]=$>>18|240,b[z++]=$>>12&63|128,b[z++]=$>>6&63|128,b[z++]=$&63|128):(b[z++]=$>>12|224,b[z++]=$>>6&63|128,b[z++]=$&63|128);T=z-h-O}else T=f(v,h+O,C);T<24?b[h++]=96|T:T<256?(O<2&&b.copyWithin(h+2,h+1,h+1+T),b[h++]=120,b[h++]=T):T<65536?(O<3&&b.copyWithin(h+3,h+2,h+2+T),b[h++]=121,b[h++]=T>>8,b[h++]=T&255):(O<5&&b.copyWithin(h+5,h+3,h+3+T),b[h++]=122,X.setUint32(h,T),h+=4),h+=T}else if(R==="number")if(!this.alwaysUseFloat&&v>>>0===v)v<24?b[h++]=v:v<256?(b[h++]=24,b[h++]=v):v<65536?(b[h++]=25,b[h++]=v>>8,b[h++]=v&255):(b[h++]=26,X.setUint32(h,v),h+=4);else if(!this.alwaysUseFloat&&v>>0===v)v>=-24?b[h++]=31-v:v>=-256?(b[h++]=56,b[h++]=~v):v>=-65536?(b[h++]=57,X.setUint16(h,~v),h+=2):(b[h++]=58,X.setUint32(h,~v),h+=4);else{let _;if((_=this.useFloat32)>0&&v<4294967296&&v>=-2147483648){b[h++]=250,X.setFloat32(h,v);let O;if(_<4||(O=v*Sr[(b[h]&127)<<1|b[h+1]>>7])>>0===O){h+=4;return}else h--}b[h++]=251,X.setFloat64(h,v),h+=8}else if(R==="object")if(!v)b[h++]=246;else{if(a){let O=a.get(v);if(O){if(b[h++]=216,b[h++]=29,b[h++]=25,!O.references){let C=a.idsToInsert||(a.idsToInsert=[]);O.references=[],C.push(O)}O.references.push(h-r),h+=2;return}else a.set(v,{offset:h-r})}let _=v.constructor;if(_===Object)M(v,!0);else if(_===Array){T=v.length,T<24?b[h++]=128|T:be(T);for(let O=0;O<T;O++)x(v[O])}else if(_===Map)if((this.mapsAsObjects?this.useTag259ForMaps!==!1:this.useTag259ForMaps)&&(b[h++]=217,b[h++]=1,b[h++]=3),T=v.size,T<24?b[h++]=160|T:T<256?(b[h++]=184,b[h++]=T):T<65536?(b[h++]=185,b[h++]=T>>8,b[h++]=T&255):(b[h++]=186,X.setUint32(h,T),h+=4),o.keyMap)for(let[O,C]of v)x(o.encodeKey(O)),x(C);else for(let[O,C]of v)x(O),x(C);else{for(let O=0,C=lr.length;O<C;O++){let B=Mn[O];if(v instanceof B){let $=lr[O],F=$.tag;F==null&&(F=$.getTag&&$.getTag.call(this,v)),F<24?b[h++]=192|F:F<256?(b[h++]=216,b[h++]=F):F<65536?(b[h++]=217,b[h++]=F>>8,b[h++]=F&255):F>-1&&(b[h++]=218,X.setUint32(h,F),h+=4),$.encode.call(this,v,x,L);return}}if(v[Symbol.iterator]){if(Kt){let O=new Error("Iterable should be serialized as iterator");throw O.iteratorNotHandled=!0,O}b[h++]=159;for(let O of v)x(O);b[h++]=255;return}if(v[Symbol.asyncIterator]||Wt(v)){let O=new Error("Iterable/blob should be serialized as iterator");throw O.iteratorNotHandled=!0,O}if(this.useToJSON&&v.toJSON){const O=v.toJSON();if(O!==v)return x(O)}M(v,!v.hasOwnProperty)}}else if(R==="boolean")b[h++]=v?245:244;else if(R==="bigint"){if(v<BigInt(1)<<BigInt(64)&&v>=0)b[h++]=27,X.setBigUint64(h,v);else if(v>-(BigInt(1)<<BigInt(64))&&v<0)b[h++]=59,X.setBigUint64(h,-v-BigInt(1));else if(this.largeBigIntToFloat)b[h++]=251,X.setFloat64(h,Number(v));else throw new RangeError(v+" was too large to fit in CBOR 64-bit integer format, set largeBigIntToFloat to convert to float-64");h+=8}else if(R==="undefined")b[h++]=247;else throw new Error("Unknown type: "+R)},M=this.useRecords===!1?this.variableMapSize?v=>{let R=Object.keys(v),T=Object.values(v),_=R.length;if(_<24?b[h++]=160|_:_<256?(b[h++]=184,b[h++]=_):_<65536?(b[h++]=185,b[h++]=_>>8,b[h++]=_&255):(b[h++]=186,X.setUint32(h,_),h+=4),o.keyMap)for(let O=0;O<_;O++)x(o.encodeKey(R[O])),x(T[O]);else for(let O=0;O<_;O++)x(R[O]),x(T[O])}:(v,R)=>{b[h++]=185;let T=h-r;h+=2;let _=0;if(o.keyMap)for(let O in v)(R||v.hasOwnProperty(O))&&(x(o.encodeKey(O)),x(v[O]),_++);else for(let O in v)(R||v.hasOwnProperty(O))&&(x(O),x(v[O]),_++);b[T+++r]=_>>8,b[T+r]=_&255}:(v,R)=>{let T,_=i.transitions||(i.transitions=Object.create(null)),O=0,C=0,B,$;if(this.keyMap){$=Object.keys(v).map(z=>this.encodeKey(z)),C=$.length;for(let z=0;z<C;z++){let at=$[z];T=_[at],T||(T=_[at]=Object.create(null),O++),_=T}}else for(let z in v)(R||v.hasOwnProperty(z))&&(T=_[z],T||(_[le]&1048576&&(B=_[le]&65535),T=_[z]=Object.create(null),O++),_=T,C++);let F=_[le];if(F!==void 0)F&=65535,b[h++]=217,b[h++]=F>>8|224,b[h++]=F&255;else if($||($=_.__keys__||(_.__keys__=Object.keys(v))),B===void 0?(F=i.nextId++,F||(F=0,i.nextId=1),F>=$r&&(i.nextId=(F=l)+1)):F=B,i[F]=$,F<l){b[h++]=217,b[h++]=F>>8|224,b[h++]=F&255,_=i.transitions;for(let z=0;z<C;z++)(_[le]===void 0||_[le]&1048576)&&(_[le]=F),_=_[$[z]];_[le]=F|1048576,s=!0}else{if(_[le]=F,X.setUint32(h,3655335680),h+=3,O&&(S+=A*O),w.length>=$r-l&&(w.shift()[le]=void 0),w.push(_),be(C+2),x(57344+F),x($),R===null)return;for(let z in v)(R||v.hasOwnProperty(z))&&x(v[z]);return}if(C<24?b[h++]=128|C:be(C),R!==null)for(let z in v)(R||v.hasOwnProperty(z))&&x(v[z])},L=v=>{let R;if(v>16777216){if(v-r>zr)throw new Error("Encoded buffer would be larger than maximum buffer size");R=Math.min(zr,Math.round(Math.max((v-r)*(v>67108864?1.25:2),4194304)/4096)*4096)}else R=(Math.max(v-r<<2,b.length-1)>>12)+1<<12;let T=new Ht(R);return X=new DataView(T.buffer,0,R),b.copy?b.copy(T,0,r,v):T.set(b.slice(r,v)),h-=r,r=0,Ee=T.length-10,b=T};let m=100,U=1e3;this.encodeAsIterable=function(v,R){return P(v,R,I)},this.encodeAsAsyncIterable=function(v,R){return P(v,R,V)};function*I(v,R,T){let _=v.constructor;if(_===Object){let O=o.useRecords!==!1;O?M(v,null):Hr(Object.keys(v).length,160);for(let C in v){let B=v[C];O||x(C),B&&typeof B=="object"?R[C]?yield*I(B,R[C]):yield*k(B,R,C):x(B)}}else if(_===Array){let O=v.length;be(O);for(let C=0;C<O;C++){let B=v[C];B&&(typeof B=="object"||h-r>m)?R.element?yield*I(B,R.element):yield*k(B,R,"element"):x(B)}}else if(v[Symbol.iterator]){b[h++]=159;for(let O of v)O&&(typeof O=="object"||h-r>m)?R.element?yield*I(O,R.element):yield*k(O,R,"element"):x(O);b[h++]=255}else Wt(v)?(Hr(v.size,64),yield b.subarray(r,h),yield v,j()):v[Symbol.asyncIterator]?(b[h++]=159,yield b.subarray(r,h),yield v,j(),b[h++]=255):x(v);T&&h>r?yield b.subarray(r,h):h-r>m&&(yield b.subarray(r,h),j())}function*k(v,R,T){let _=h-r;try{x(v),h-r>m&&(yield b.subarray(r,h),j())}catch(O){if(O.iteratorNotHandled)R[T]={},h=r+_,yield*I.call(this,v,R[T]);else throw O}}function j(){m=U,o.encode(null,Gt)}function P(v,R,T){return R&&R.chunkThreshold?m=U=R.chunkThreshold:m=100,v&&typeof v=="object"?(o.encode(null,Gt),T(v,o.iterateProperties||(o.iterateProperties={}),!0)):[o.encode(v)]}async function*V(v,R){for(let T of I(v,R,!0)){let _=T.constructor;if(_===Vr||_===Uint8Array)yield T;else if(Wt(T)){let O=T.stream().getReader(),C;for(;!(C=await O.read()).done;)yield C.value}else if(T[Symbol.asyncIterator])for await(let O of T)j(),O?yield*V(O,R.async||(R.async={})):yield o.encode(O);else yield T}}}useBuffer(e){b=e,X=new DataView(b.buffer,b.byteOffset,b.byteLength),h=0}clearSharedData(){this.structures&&(this.structures=[]),this.sharedValues&&(this.sharedValues=void 0)}updateSharedData(){let e=this.sharedVersion||0;this.sharedVersion=e+1;let r=this.structures.slice(0),n=new Nn(r,this.sharedValues,this.sharedVersion),s=this.saveShared(n,i=>(i&&i.version||0)==e);return s===!1?(n=this.getShared()||{},this.structures=n.structures||[],this.sharedValues=n.packedValues,this.sharedVersion=n.version,this.structures.nextId=this.structures.length):r.forEach((i,a)=>this.structures[a]=i),s}}function Hr(t,e){t<24?b[h++]=e|t:t<256?(b[h++]=e|24,b[h++]=t):t<65536?(b[h++]=e|25,b[h++]=t>>8,b[h++]=t&255):(b[h++]=e|26,X.setUint32(h,t),h+=4)}class Nn{constructor(e,r,n){this.structures=e,this.packedValues=r,this.version=n}}function be(t){t<24?b[h++]=128|t:t<256?(b[h++]=152,b[h++]=t):t<65536?(b[h++]=153,b[h++]=t>>8,b[h++]=t&255):(b[h++]=154,X.setUint32(h,t),h+=4)}const Fs=typeof Blob>"u"?function(){}:Blob;function Wt(t){if(t instanceof Fs)return!0;let e=t[Symbol.toStringTag];return e==="Blob"||e==="File"}function mt(t,e){switch(typeof t){case"string":if(t.length>3){if(e.objectMap[t]>-1||e.values.length>=e.maxValues)return;let n=e.get(t);if(n)++n.count==2&&e.values.push(t);else if(e.set(t,{count:1}),e.samplingPackedValues){let s=e.samplingPackedValues.get(t);s?s.count++:e.samplingPackedValues.set(t,{count:1})}}break;case"object":if(t)if(t instanceof Array)for(let n=0,s=t.length;n<s;n++)mt(t[n],e);else{let n=!e.encoder.useRecords;for(var r in t)t.hasOwnProperty(r)&&(n&&mt(r,e),mt(t[r],e))}break;case"function":console.log(t)}}const Vs=new Uint8Array(new Uint16Array([1]).buffer)[0]==1;Mn=[Date,Set,Error,RegExp,_e,ArrayBuffer,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,typeof BigUint64Array>"u"?function(){}:BigUint64Array,Int8Array,Int16Array,Int32Array,typeof BigInt64Array>"u"?function(){}:BigInt64Array,Float32Array,Float64Array,Nn];lr=[{tag:1,encode(t,e){let r=t.getTime()/1e3;(this.useTimestamp32||t.getMilliseconds()===0)&&r>=0&&r<4294967296?(b[h++]=26,X.setUint32(h,r),h+=4):(b[h++]=251,X.setFloat64(h,r),h+=8)}},{tag:258,encode(t,e){let r=Array.from(t);e(r)}},{tag:27,encode(t,e){e([t.name,t.message])}},{tag:27,encode(t,e){e(["RegExp",t.source,t.flags])}},{getTag(t){return t.tag},encode(t,e){e(t.value)}},{encode(t,e,r){Kr(t,r)}},{getTag(t){if(t.constructor===Uint8Array&&(this.tagUint8Array||st&&this.tagUint8Array!==!1))return 64},encode(t,e,r){Kr(t,r)}},ge(68,1),ge(69,2),ge(70,4),ge(71,8),ge(72,1),ge(77,2),ge(78,4),ge(79,8),ge(85,4),ge(86,8),{encode(t,e){let r=t.packedValues||[],n=t.structures||[];if(r.values.length>0){b[h++]=216,b[h++]=51,be(4);let s=r.values;e(s),be(0),be(0),packedObjectMap=Object.create(sharedPackedObjectMap||null);for(let i=0,a=s.length;i<a;i++)packedObjectMap[s[i]]=i}if(n){X.setUint32(h,3655335424),h+=3;let s=n.slice(0);s.unshift(57344),s.push(new _e(t.version,1399353956)),e(s)}else e(new _e(t.version,1399353956))}}];function ge(t,e){return!Vs&&e>1&&(t-=4),{tag:t,encode:function(n,s){let i=n.byteLength,a=n.byteOffset||0,f=n.buffer||n;s(st?Pt.from(f,a,i):new Uint8Array(f,a,i))}}}function Kr(t,e){let r=t.byteLength;r<24?b[h++]=64+r:r<256?(b[h++]=88,b[h++]=r):r<65536?(b[h++]=89,b[h++]=r>>8,b[h++]=r&255):(b[h++]=90,X.setUint32(h,r),h+=4),h+r>=b.length&&e(h+r),b.set(t.buffer?t:new Uint8Array(t),h),h+=r}function $s(t,e){let r,n=e.length*2,s=t.length-n;e.sort((i,a)=>i.offset>a.offset?1:-1);for(let i=0;i<e.length;i++){let a=e[i];a.id=i;for(let f of a.references)t[f++]=i>>8,t[f]=i&255}for(;r=e.pop();){let i=r.offset;t.copyWithin(i+n,i,s),n-=2;let a=i+n;t[a++]=216,t[a++]=28,s=i}return t}function Wr(t,e){X.setUint32(re.position+t,h-re.position-t+1);let r=re;re=null,e(r[0]),e(r[1])}let Ar=new Ln({useRecords:!1});Ar.encode;Ar.encodeAsIterable;Ar.encodeAsAsyncIterable;const Gr=512,zs=1024,Gt=2048;function jn(t){return new Ln({tagUint8Array:!1}).encode(t)}function Hs(t){return Dn(t)}const ha=Object.freeze(Object.defineProperty({__proto__:null,decode:Hs,encode:jn},Symbol.toStringTag,{value:"Module"}));class da extends Xr{documentId;#n;#e;#i;get url(){return jt({documentId:this.documentId})}constructor(e,{isNew:r=!1,timeoutDelay:n=6e4}={}){super(),this.documentId=e,this.#i=n,this.#n=Ye(`automerge-repo:dochandle:${this.documentId.slice(0,5)}`);let s=Vn();r&&(s=$n(s,{})),this.#e=vn(Wi({predictableActionArguments:!0,id:"docHandle",initial:Ws,context:{documentId:this.documentId,doc:s},states:{idle:{on:{CREATE:{target:we},FIND:{target:Jt},DELETE:{actions:"onDelete",target:Ke}}},loading:{on:{UPDATE:{actions:"onUpdate",target:we},REQUEST:{target:Pe},AWAIT_NETWORK:{target:Jr},DELETE:{actions:"onDelete",target:Ke}},after:[{delay:this.#i,target:qr}]},awaitingNetwork:{on:{NETWORK_READY:{target:Pe}}},requesting:{on:{MARK_UNAVAILABLE:{target:Rt,actions:"onUnavailable"},UPDATE:{actions:"onUpdate"},REQUEST_COMPLETE:{target:we},DELETE:{actions:"onDelete",target:Ke}},after:[{delay:this.#i,target:qr}]},ready:{on:{UPDATE:{actions:"onUpdate",target:we},DELETE:{actions:"onDelete",target:Ke}}},failed:{type:"final"},deleted:{type:"final"},unavailable:{on:{UPDATE:{actions:"onUpdate"},REQUEST_COMPLETE:{target:we},DELETE:{actions:"onDelete",target:Ke}}}}},{actions:{onUpdate:Ft((i,{payload:a})=>{const{doc:f}=i,{callback:o}=a;return{doc:o(f)}}),onDelete:Ft(()=>(this.emit("delete",{handle:this}),{doc:void 0})),onUnavailable:Ft(i=>{const{doc:a}=i;return this.emit("unavailable",{handle:this}),{doc:a}})}})).onTransition(({value:i,history:a,context:f},o)=>{const c=a?.context?.doc,l=f.doc;if(this.#n(`${a?.value}: ${o.type} → ${i}`,l),l&&c&&!Yi(ot(l),ot(c))){this.emit("heads-changed",{handle:this,doc:l});const d=zn(l,ot(c),ot(l));if(d.length>0){const u="change";this.emit("change",{handle:this,doc:l,patches:d,patchInfo:{before:c,after:l,source:u}})}this.isReady()||this.#e.send(Ys)}}).start(),this.#e.send(r?Gs:Js)}get#r(){return this.#e?.getSnapshot().context.doc}get#t(){return this.#e?.getSnapshot().value}#s(e){return Array.isArray(e)||(e=[e]),Promise.any(e.map(r=>qi(this.#e,n=>n.matches(r),{timeout:this.#i*2e3})))}isReady=()=>this.inState([St.READY]);isDeleted=()=>this.inState([St.DELETED]);isUnavailable=()=>this.inState([St.UNAVAILABLE]);inState=e=>e.some(this.#e?.getSnapshot().matches);get state(){return this.#e?.getSnapshot().value}async whenReady(e=[we]){await Zi(this.#s(e),this.#i)}async doc(e=[we,Rt]){await Xi();try{await this.#s(e)}catch(r){throw r instanceof bn?new Error(`DocHandle: timed out loading ${this.documentId}`):r}return this.isUnavailable()?void 0:this.#r}docSync(){if(this.isReady())return this.#r}update(e){this.#e.send(qt,{payload:{callback:e}})}change(e,r={}){if(!this.isReady())throw new Error(`DocHandle#${this.documentId} is not ready. Check \`handle.isReady()\` before accessing the document.`);this.#e.send(qt,{payload:{callback:n=>Hn(n,r,e)}})}changeAt(e,r,n={}){if(!this.isReady())throw new Error(`DocHandle#${this.documentId} is not ready. Check \`handle.isReady()\` before accessing the document.`);let s;return this.#e.send(qt,{payload:{callback:i=>{const a=Kn(i,e,n,r);return s=a.newHeads,a.newDoc}}}),s}unavailable(){this.#e.send(Xs)}request(){this.#t===Jt&&this.#e.send(qs)}awaitNetwork(){this.#t===Jt&&this.#e.send(Zs)}networkReady(){this.#t===Jr&&this.#e.send(ea)}delete(){this.#e.send(Qs)}broadcast(e){this.emit("ephemeral-message-outbound",{handle:this,data:jn(e)})}}const St={IDLE:"idle",LOADING:"loading",AWAITING_NETWORK:"awaitingNetwork",REQUESTING:"requesting",READY:"ready",FAILED:"failed",DELETED:"deleted",UNAVAILABLE:"unavailable"},Ks={CREATE:"CREATE",FIND:"FIND",REQUEST:"REQUEST",REQUEST_COMPLETE:"REQUEST_COMPLETE",AWAIT_NETWORK:"AWAIT_NETWORK",NETWORK_READY:"NETWORK_READY",UPDATE:"UPDATE",TIMEOUT:"TIMEOUT",DELETE:"DELETE",MARK_UNAVAILABLE:"MARK_UNAVAILABLE"},{IDLE:Ws,LOADING:Jt,AWAITING_NETWORK:Jr,REQUESTING:Pe,READY:we,FAILED:qr,DELETED:Ke,UNAVAILABLE:Rt}=St,{CREATE:Gs,FIND:Js,REQUEST:qs,UPDATE:qt,TIMEOUT:ya,DELETE:Qs,REQUEST_COMPLETE:Ys,MARK_UNAVAILABLE:Xs,AWAIT_NETWORK:Zs,NETWORK_READY:ea}=Ks;function pa(t){return typeof t=="object"&&typeof t.type=="string"&&typeof t.senderId=="string"&&(ra(t)||na(t)||Pn(t)||ta(t))}function ta(t){return t.type==="doc-unavailable"}function Pn(t){return t.type==="request"}function ra(t){return t.type==="sync"}function na(t){return t.type==="ephemeral"}var Cn={exports:{}};(function(t){(function(e,r){var n={};r(n);var s=n.default;for(var i in n)s[i]=n[i];t.exports=s})(Fn,function(e){e.__esModule=!0,e.digestLength=32,e.blockSize=64;var r=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function n(d,u,p,g,w){for(var S,A,x,M,L,m,U,I,k,j,P,V,v;w>=64;){for(S=u[0],A=u[1],x=u[2],M=u[3],L=u[4],m=u[5],U=u[6],I=u[7],j=0;j<16;j++)P=g+j*4,d[j]=(p[P]&255)<<24|(p[P+1]&255)<<16|(p[P+2]&255)<<8|p[P+3]&255;for(j=16;j<64;j++)k=d[j-2],V=(k>>>17|k<<32-17)^(k>>>19|k<<32-19)^k>>>10,k=d[j-15],v=(k>>>7|k<<32-7)^(k>>>18|k<<32-18)^k>>>3,d[j]=(V+d[j-7]|0)+(v+d[j-16]|0);for(j=0;j<64;j++)V=(((L>>>6|L<<32-6)^(L>>>11|L<<32-11)^(L>>>25|L<<32-25))+(L&m^~L&U)|0)+(I+(r[j]+d[j]|0)|0)|0,v=((S>>>2|S<<32-2)^(S>>>13|S<<32-13)^(S>>>22|S<<32-22))+(S&A^S&x^A&x)|0,I=U,U=m,m=L,L=M+V|0,M=x,x=A,A=S,S=V+v|0;u[0]+=S,u[1]+=A,u[2]+=x,u[3]+=M,u[4]+=L,u[5]+=m,u[6]+=U,u[7]+=I,g+=64,w-=64}return g}var s=function(){function d(){this.digestLength=e.digestLength,this.blockSize=e.blockSize,this.state=new Int32Array(8),this.temp=new Int32Array(64),this.buffer=new Uint8Array(128),this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this.reset()}return d.prototype.reset=function(){return this.state[0]=1779033703,this.state[1]=3144134277,this.state[2]=1013904242,this.state[3]=2773480762,this.state[4]=1359893119,this.state[5]=2600822924,this.state[6]=528734635,this.state[7]=1541459225,this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this},d.prototype.clean=function(){for(var u=0;u<this.buffer.length;u++)this.buffer[u]=0;for(var u=0;u<this.temp.length;u++)this.temp[u]=0;this.reset()},d.prototype.update=function(u,p){if(p===void 0&&(p=u.length),this.finished)throw new Error("SHA256: can't update because hash was finished.");var g=0;if(this.bytesHashed+=p,this.bufferLength>0){for(;this.bufferLength<64&&p>0;)this.buffer[this.bufferLength++]=u[g++],p--;this.bufferLength===64&&(n(this.temp,this.state,this.buffer,0,64),this.bufferLength=0)}for(p>=64&&(g=n(this.temp,this.state,u,g,p),p%=64);p>0;)this.buffer[this.bufferLength++]=u[g++],p--;return this},d.prototype.finish=function(u){if(!this.finished){var p=this.bytesHashed,g=this.bufferLength,w=p/536870912|0,S=p<<3,A=p%64<56?64:128;this.buffer[g]=128;for(var x=g+1;x<A-8;x++)this.buffer[x]=0;this.buffer[A-8]=w>>>24&255,this.buffer[A-7]=w>>>16&255,this.buffer[A-6]=w>>>8&255,this.buffer[A-5]=w>>>0&255,this.buffer[A-4]=S>>>24&255,this.buffer[A-3]=S>>>16&255,this.buffer[A-2]=S>>>8&255,this.buffer[A-1]=S>>>0&255,n(this.temp,this.state,this.buffer,0,A),this.finished=!0}for(var x=0;x<8;x++)u[x*4+0]=this.state[x]>>>24&255,u[x*4+1]=this.state[x]>>>16&255,u[x*4+2]=this.state[x]>>>8&255,u[x*4+3]=this.state[x]>>>0&255;return this},d.prototype.digest=function(){var u=new Uint8Array(this.digestLength);return this.finish(u),u},d.prototype._saveState=function(u){for(var p=0;p<this.state.length;p++)u[p]=this.state[p]},d.prototype._restoreState=function(u,p){for(var g=0;g<this.state.length;g++)this.state[g]=u[g];this.bytesHashed=p,this.finished=!1,this.bufferLength=0},d}();e.Hash=s;var i=function(){function d(u){this.inner=new s,this.outer=new s,this.blockSize=this.inner.blockSize,this.digestLength=this.inner.digestLength;var p=new Uint8Array(this.blockSize);if(u.length>this.blockSize)new s().update(u).finish(p).clean();else for(var g=0;g<u.length;g++)p[g]=u[g];for(var g=0;g<p.length;g++)p[g]^=54;this.inner.update(p);for(var g=0;g<p.length;g++)p[g]^=106;this.outer.update(p),this.istate=new Uint32Array(8),this.ostate=new Uint32Array(8),this.inner._saveState(this.istate),this.outer._saveState(this.ostate);for(var g=0;g<p.length;g++)p[g]=0}return d.prototype.reset=function(){return this.inner._restoreState(this.istate,this.inner.blockSize),this.outer._restoreState(this.ostate,this.outer.blockSize),this},d.prototype.clean=function(){for(var u=0;u<this.istate.length;u++)this.ostate[u]=this.istate[u]=0;this.inner.clean(),this.outer.clean()},d.prototype.update=function(u){return this.inner.update(u),this},d.prototype.finish=function(u){return this.outer.finished?this.outer.finish(u):(this.inner.finish(u),this.outer.update(u,this.digestLength).finish(u)),this},d.prototype.digest=function(){var u=new Uint8Array(this.digestLength);return this.finish(u),u},d}();e.HMAC=i;function a(d){var u=new s().update(d),p=u.digest();return u.clean(),p}e.hash=a,e.default=a;function f(d,u){var p=new i(d).update(u),g=p.digest();return p.clean(),g}e.hmac=f;function o(d,u,p,g){var w=g[0];if(w===0)throw new Error("hkdf: cannot expand more");u.reset(),w>1&&u.update(d),p&&u.update(p),u.update(g),u.finish(d),g[0]++}var c=new Uint8Array(e.digestLength);function l(d,u,p,g){u===void 0&&(u=c),g===void 0&&(g=32);for(var w=new Uint8Array([1]),S=f(u,d),A=new i(S),x=new Uint8Array(A.digestLength),M=x.length,L=new Uint8Array(g),m=0;m<g;m++)M===x.length&&(o(x,A,p,w),M=0),L[m]=x[M++];return A.clean(),x.fill(0),w.fill(0),L}e.hkdf=l;function y(d,u,p,g){for(var w=new i(d),S=w.digestLength,A=new Uint8Array(4),x=new Uint8Array(S),M=new Uint8Array(S),L=new Uint8Array(g),m=0;m*S<g;m++){var U=m+1;A[0]=U>>>24&255,A[1]=U>>>16&255,A[2]=U>>>8&255,A[3]=U>>>0&255,w.reset(),w.update(u),w.update(A),w.finish(M);for(var I=0;I<S;I++)x[I]=M[I];for(var I=2;I<=p;I++){w.reset(),w.update(M).finish(M);for(var k=0;k<S;k++)x[k]^=M[k]}for(var I=0;I<S&&m*S+I<g;I++)L[m*S+I]=x[I]}for(var m=0;m<S;m++)x[m]=M[m]=0;for(var m=0;m<4;m++)A[m]=0;return w.clean(),L}e.pbkdf2=y})})(Cn);var va=Cn.exports;class Bn extends Xr{}class ia extends Bn{handle;#n;#e;#i;#r=[];#t={};#s={};#o=[];#l=!1;constructor(e){super(),this.handle=e;const r=e.documentId.slice(0,5);this.#e=Ye(`automerge-repo:concise:docsync:${r}`),this.#n=Ye(`automerge-repo:docsync:${r}`),this.#i=Ye(`automerge-repo:ops:docsync:${r}`),e.on("change",()=>this.#y()),e.on("ephemeral-message-outbound",n=>this.#p(n)),(async()=>(await e.doc([we,Pe]),this.#d()))()}get peerStates(){return this.#t}get documentId(){return this.handle.documentId}async#y(){this.#n("syncWithPeers");const e=await this.handle.doc();e!==void 0&&this.#r.forEach(r=>this.#c(r,e))}async#p({data:e}){this.#n("broadcastToPeers",this.#r),this.#r.forEach(r=>this.#v(r,e))}#v(e,r){this.#n(`sendEphemeralMessage ->${e}`),this.emit("message",{type:"ephemeral",targetId:e,documentId:this.handle.documentId,data:r})}#f(e){return this.#r.includes(e)||(this.#n("adding a new peer",e),this.#r.push(e)),e in this.#t||(this.#t[e]="unknown"),this.#s[e]??Wn()}#u(e,r){this.#s[e]=r}#c(e,r){this.#n(`sendSyncMessage ->${e}`);const n=this.#f(e),[s,i]=Gn(r,n);if(this.#u(e,s),i){this.#g(`sendSyncMessage 🡒 ${e}`,i);const a=Or(i);!this.handle.isReady()&&a.heads.length===0&&s.sharedHeads.length===0&&!Object.values(this.#t).includes("has")&&this.#t[e]==="unknown"?this.emit("message",{type:"request",targetId:e,documentId:this.handle.documentId,data:i}):this.emit("message",{type:"sync",targetId:e,data:i,documentId:this.handle.documentId}),a.heads.length>0&&(this.#t[e]="has")}}#g=(e,r)=>{};hasPeer(e){return this.#r.includes(e)}beginSync(e){this.#n(`beginSync: ${e.join(", ")}`),e.forEach(r=>{const n=this.#f(r),s=Jn(qn(n));this.#u(r,s)}),this.handle.doc([we,Pe,Rt]).then(r=>{this.#l=!0,this.#a(),r!==void 0&&e.forEach(n=>{this.#c(n,r)})})}endSync(e){this.#n(`removing peer ${e}`),this.#r=this.#r.filter(r=>r!==e)}receiveMessage(e){switch(e.type){case"sync":case"request":this.receiveSyncMessage(e);break;case"ephemeral":this.receiveEphemeralMessage(e);break;case"doc-unavailable":this.#t[e.senderId]="unavailable",this.#a();break;default:throw new Error(`unknown message type: ${e}`)}}receiveEphemeralMessage(e){if(e.documentId!==this.handle.documentId)throw new Error("channelId doesn't match documentId");const{senderId:r,data:n}=e,s=Dn(n);this.handle.emit("ephemeral-message",{handle:this.handle,senderId:r,message:s}),this.#r.forEach(i=>{i!==r&&this.emit("message",{...e,targetId:i})})}receiveSyncMessage(e){if(e.documentId!==this.handle.documentId)throw new Error("channelId doesn't match documentId");if(!this.handle.inState([we,Pe,Rt])){this.#o.push(e);return}this.#d(),this.#h(e)}#h(e){Pn(e)&&(this.#t[e.senderId]="wants"),this.#a(),Or(e.data).heads.length>0&&(this.#t[e.senderId]="has"),this.handle.update(r=>{const[n,s]=Qn(r,this.#f(e.senderId),e.data);return this.#u(e.senderId,s),this.#c(e.senderId,r),n}),this.#a()}#a(){this.#l&&this.handle.inState([Pe])&&this.#r.every(e=>this.#t[e]==="unavailable"||this.#t[e]==="wants")&&(this.#r.filter(e=>this.#t[e]==="wants").forEach(e=>{this.emit("message",{type:"doc-unavailable",documentId:this.handle.documentId,targetId:e})}),this.handle.unavailable())}#d(){for(const e of this.#o)this.#h(e);this.#o=[]}}const Qt=Ye("automerge-repo:collectionsync");class ga extends Bn{repo;#n=new Set;#e={};#i={};constructor(e){super(),this.repo=e}#r(e){if(!this.#e[e]){const r=this.repo.find(jt({documentId:e}));this.#e[e]=this.#t(r)}return this.#e[e]}#t(e){const r=new ia(e);return r.on("message",n=>this.emit("message",n)),r}async#s(e){const r=Array.from(this.#n),n=[];for(const s of r)await this.repo.sharePolicy(s,e)&&n.push(s);return n}async receiveMessage(e){Qt(`onSyncMessage: ${e.senderId}, ${e.documentId}, ${"data"in e?e.data.byteLength+"bytes":""}`);const r=e.documentId;if(!r)throw new Error("received a message with an invalid documentId");this.#i[r]=!0;const n=this.#r(r);n.receiveMessage(e);const s=await this.#s(r);n.beginSync(s.filter(i=>!n.hasPeer(i)))}addDocument(e){if(this.#i[e])return;const r=this.#r(e);this.#s(e).then(n=>{r.beginSync(n)})}removeDocument(e){throw new Error("not implemented")}addPeer(e){if(Qt(`adding ${e} & synchronizing with them`),!this.#n.has(e)){this.#n.add(e);for(const r of Object.values(this.#e)){const{documentId:n}=r;this.repo.sharePolicy(e,n).then(s=>{s&&r.beginSync([e])})}}}removePeer(e){Qt(`removing peer ${e}`),this.#n.delete(e);for(const r of Object.values(this.#e))r.endSync(e)}}export{ga as C,da as D,Xr as E,St as H,na as a,ua as b,la as c,jt as d,ha as e,jn as f,ca as g,Yi as h,pa as i,Hs as j,fa as p,va as s};
